import{r as i,j as e,s as n}from"./index-BvDo0rdQ.js";import{a as A}from"./api-_AOULUoD.js";import{A as L}from"./arrow-left-D5_T9bTh.js";import{A as E}from"./alert-circle-Da_Orva5.js";import{M as D}from"./mail-COyL00Av.js";import{L as T}from"./lock-DTJvx-Oe.js";function $({onAuthSuccess:v}){const[d,g]=i.useState("login"),[k,b]=i.useState("email"),[l,j]=i.useState(""),[h,S]=i.useState(""),[f,w]=i.useState(""),[y,P]=i.useState(""),[N,q]=i.useState(""),[u,r]=i.useState(!1),[C,s]=i.useState(""),[p,m]=i.useState(""),I=()=>{if(!l||!l.includes("@")){s("Por favor ingresa tu email primero para validar el cÃ³digo.");return}s(""),m(""),b("otp")},M=async t=>{t.preventDefault(),s(""),m(""),r(!0);try{const{error:a}=await n.auth.signInWithOtp({email:l,options:{shouldCreateUser:!1}});if(a)if(a.message.includes("security purposes")){const o=a.message.match(/after (\d+) seconds/),x=o?o[1]:"unos";s(`â³ Por seguridad, debes esperar ${x} segundos antes de solicitar otro cÃ³digo.`)}else s(a.message);else m("âœ… CÃ³digo enviado. Por favor revisa tu correo e ingresa el cÃ³digo numÃ©rico."),b("otp")}catch(a){s(a.message||"Error al enviar cÃ³digo")}finally{r(!1)}},O=async t=>{t.preventDefault(),s(""),r(!0);try{const{data:a,error:o}=await n.auth.verifyOtp({email:l,token:f,type:"email"});if(o){s("El cÃ³digo ingresado es invÃ¡lido o ha expirado."),r(!1);return}a.session&&(sessionStorage.setItem("auth_reset_mode","true"),window.location.reload())}catch(a){s(a.message||"Error al verificar cÃ³digo"),r(!1)}},V=async t=>{t.preventDefault(),s(""),r(!0);try{const{data:a,error:o}=await n.auth.signInWithPassword({email:l,password:h});if(o){s(o.message),r(!1);return}if(a.session&&a.session.user.user_metadata?.role!=="client"){s("Acceso denegado. Esta cuenta no estÃ¡ registrada como cliente."),await n.auth.signOut(),r(!1);return}if(a.user){const{data:x,error:c}=await n.from("btl_usuarios").select("estado_aprobacion").eq("email",a.user.email).single();if(c){console.error("Error checking user approval status:",c),s("Error al verificar el estado de la cuenta. Por favor contacta al administrador."),await n.auth.signOut(),r(!1);return}if(x?.estado_aprobacion==="pending"){s("â³ Tu cuenta estÃ¡ pendiente de aprobaciÃ³n. Un administrador debe aprobar tu solicitud antes de que puedas acceder."),await n.auth.signOut(),r(!1);return}if(x?.estado_aprobacion==="rejected"){s("âŒ Tu solicitud de cuenta fue rechazada. Por favor contacta al administrador para mÃ¡s informaciÃ³n."),await n.auth.signOut(),r(!1);return}}a.session&&v(a.session)}catch(a){s(a.message||"Error durante el login"),r(!1)}},_=async t=>{t.preventDefault(),s(""),r(!0);try{const a=await A.signup(l,h,y,"client",N);if(!a.success){const c=a.error||"Error durante el registro";c.includes("already registered")||c.includes("already exists")?(s("Este email ya estÃ¡ registrado. Por favor, intenta iniciar sesiÃ³n."),g("login")):c.includes("invalid")||c.includes("credentials")?s("Error al crear la cuenta. Verifica que el email sea vÃ¡lido y la contraseÃ±a tenga al menos 6 caracteres."):s(c),r(!1);return}const{data:o,error:x}=await n.auth.signInWithPassword({email:l,password:h});if(x){m("âœ… Cuenta creada exitosamente. Ahora puedes iniciar sesiÃ³n."),g("login"),r(!1);return}o.session&&v(o.session)}catch(a){const o=a.message||"Error inesperado durante el registro";o.includes("already registered")||o.includes("already exists")?(s("Este email ya estÃ¡ registrado. Por favor, intenta iniciar sesiÃ³n."),g("login")):o.includes("invalid")||o.includes("credentials")?s("Error al crear la cuenta. Verifica que el email sea vÃ¡lido y la contraseÃ±a tenga al menos 6 caracteres."):s(o),r(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("a",{href:"/",className:"inline-flex items-center gap-2 text-slate-400 hover:text-white transition-colors mb-6",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Volver al Inicio"})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-4xl",children:"ðŸ“Š"})}),e.jsx("h1",{className:"text-3xl text-white font-bold mb-2",children:"Client Login"}),e.jsx("p",{className:"text-slate-400",children:"Acceso al Dashboard Ejecutivo"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-8 shadow-2xl",children:[C&&e.jsxs("div",{className:"mb-6 p-4 bg-red-500/10 border border-red-500/50 rounded-lg flex items-start gap-3",children:[e.jsx(E,{className:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-red-400",children:C})})]}),p&&e.jsxs("div",{className:"mb-6 p-4 bg-green-500/10 border border-green-500/50 rounded-lg flex items-start gap-3",children:[e.jsx(E,{className:"w-5 h-5 text-green-400 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-green-400",children:p})})]}),d==="forgot_password"?e.jsxs("div",{className:"space-y-4",children:[k==="email"?e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:l,onChange:t=>j(t.target.value),placeholder:"tu@empresa.com",required:!0,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50"})]}),e.jsxs("button",{type:"submit",disabled:u,className:"w-full bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-500 hover:to-amber-400 disabled:from-slate-700 disabled:to-slate-700 disabled:text-slate-500 text-white px-6 py-3 rounded-lg font-semibold transition-all shadow-lg shadow-amber-500/20 disabled:shadow-none flex items-center justify-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),e.jsx("span",{children:u?"Enviando...":"Enviar CÃ³digo de RecuperaciÃ³n"})]}),e.jsx("button",{type:"button",onClick:I,className:"w-full text-sm text-slate-400 hover:text-white transition-colors py-2 mt-2",children:"Â¿Ya tienes un cÃ³digo? IngrÃ©salo aquÃ­"})]}):e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-amber-500/10 border border-amber-500/30 rounded-lg mb-4",children:e.jsx("p",{className:"text-sm text-amber-300 text-center",children:p||e.jsxs(e.Fragment,{children:["Ingresa el cÃ³digo enviado a ",e.jsx("strong",{children:l})]})})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"CÃ³digo de VerificaciÃ³n"}),e.jsx("input",{type:"text",value:f,onChange:t=>w(t.target.value.replace(/\D/g,"").slice(0,8)),placeholder:"123456",required:!0,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 text-center text-2xl tracking-widest font-mono"})]}),e.jsxs("button",{type:"submit",disabled:u||f.length<6,className:"w-full bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 disabled:from-slate-700 disabled:to-slate-700 disabled:text-slate-500 text-white px-6 py-3 rounded-lg font-semibold transition-all shadow-lg shadow-green-500/20 disabled:shadow-none flex items-center justify-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),e.jsx("span",{children:u?"Verificando...":"Verificar y Cambiar Password"})]}),e.jsx("button",{type:"button",onClick:()=>{b("email"),w(""),s("")},className:"w-full text-sm text-slate-400 hover:text-white transition-colors py-2",children:"Volver a ingresar email"})]}),e.jsx("button",{type:"button",onClick:()=>{g("login"),b("email"),s(""),m("")},className:"w-full text-sm text-slate-400 hover:text-white transition-colors py-2 border-t border-slate-700/50 mt-4",children:"Volver al Login"})]}):e.jsxs("form",{onSubmit:d==="login"?V:_,className:"space-y-4",children:[d==="signup"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Nombre Completo"}),e.jsx("input",{type:"text",value:y,onChange:t=>P(t.target.value),placeholder:"Tu nombre",required:d==="signup",className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Empresa"}),e.jsx("input",{type:"text",value:N,onChange:t=>q(t.target.value),placeholder:"Nombre de tu empresa",required:d==="signup",className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:l,onChange:t=>j(t.target.value),placeholder:"tu@empresa.com",required:!0,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"ContraseÃ±a"}),e.jsx("input",{type:"password",value:h,onChange:t=>S(t.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,minLength:6,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50"}),d==="signup"&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"MÃ­nimo 6 caracteres"}),d==="login"&&e.jsx("div",{className:"flex justify-end mt-1",children:e.jsx("button",{type:"button",onClick:()=>{g("forgot_password"),s(""),m("")},className:"text-xs text-amber-400 hover:text-amber-300 transition-colors",children:"Â¿Olvidaste tu contraseÃ±a?"})})]}),e.jsx("button",{type:"submit",disabled:u,className:"w-full bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-500 hover:to-amber-400 disabled:from-slate-700 disabled:to-slate-700 disabled:text-slate-500 text-white px-6 py-3 rounded-lg font-semibold transition-all shadow-lg shadow-amber-500/20 disabled:shadow-none",children:u?"Procesando...":d==="login"?"Iniciar SesiÃ³n":"Crear Cuenta"})]})]})]})})}export{$ as ClientAuth};
