import{r as i,j as e,s as n}from"./index-icditDDW.js";import{A as _}from"./arrow-left-BCIHwPkL.js";import{A as k}from"./alert-circle-BHTX8deH.js";import{M as O}from"./mail-BwE_W4zE.js";import{L as R}from"./lock-DzvO0FhG.js";import{c as V}from"./createLucideIcon-B_1fxKTs.js";const M=V("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);function F({onAuthSuccess:v}){const[l,j]=i.useState(""),[h,C]=i.useState(""),[w,E]=i.useState(""),[c,r]=i.useState(!1),[u,s]=i.useState(""),[f,m]=i.useState(""),[d,p]=i.useState("login"),[S,g]=i.useState("email"),[b,y]=i.useState(""),A=()=>{if(!l||!l.includes("@")){s("Por favor ingresa tu email primero para validar el código.");return}s(""),m(""),g("otp")},P=async a=>{a.preventDefault(),s(""),m(""),r(!0);try{const{error:t}=await n.auth.signInWithOtp({email:l,options:{shouldCreateUser:!1}});if(t)if(t.message.includes("security purposes")){const o=t.message.match(/after (\d+) seconds/),x=o?o[1]:"unos";s(`⏳ Por seguridad, debes esperar ${x} segundos antes de solicitar otro código.`)}else s(t.message);else m("✅ Código enviado. Por favor revisa tu correo e ingresa el código numérico."),g("otp")}catch(t){s(t.message||"Error al enviar código")}finally{r(!1)}},L=async a=>{a.preventDefault(),s(""),r(!0);try{const{data:t,error:o}=await n.auth.verifyOtp({email:l,token:b,type:"email"});if(o){s("El código ingresado es inválido o ha expirado."),r(!1);return}t.session&&(sessionStorage.setItem("auth_reset_mode","true"),window.location.reload())}catch(t){s(t.message||"Error al verificar código"),r(!1)}},q=async a=>{a.preventDefault(),s(""),r(!0);try{const{data:t,error:o}=await n.auth.signInWithPassword({email:l,password:h});if(o){s(o.message),r(!1);return}if(t.session&&t.session.user.user_metadata?.role!=="admin"){s("Acceso denegado. Esta cuenta no tiene permisos de administrador."),await n.auth.signOut(),r(!1);return}if(t.user){const{data:x,error:N}=await n.from("btl_usuarios").select("estado_aprobacion").eq("email",t.user.email).single();if(N){console.error("Error checking user approval status:",N),s("Error al verificar el estado de la cuenta. Por favor contacta al administrador."),await n.auth.signOut(),r(!1);return}if(x?.estado_aprobacion==="pending"){s("⏳ Tu cuenta está pendiente de aprobación. Un administrador debe aprobar tu solicitud antes de que puedas acceder."),await n.auth.signOut(),r(!1);return}if(x?.estado_aprobacion==="rejected"){s("❌ Tu solicitud de cuenta fue rechazada. Por favor contacta al administrador para más información."),await n.auth.signOut(),r(!1);return}}t.session&&v(t.session)}catch(t){s(t.message||"Error durante el login"),r(!1)}},I=async a=>{a.preventDefault(),s(""),r(!0);try{const{data:t,error:o}=await n.auth.signUp({email:l,password:h,options:{data:{role:"admin",name:w}}});if(o){o.message.includes("already registered")?(s("Este email ya está registrado. Por favor, intenta iniciar sesión."),p("login")):o.message.includes("invalid")||o.message.includes("credentials")?s("Error al crear la cuenta. Verifica que el email sea válido y la contraseña tenga al menos 6 caracteres."):s(o.message),r(!1);return}t.session?v(t.session):t.user?(s("✅ Cuenta creada exitosamente. Revisa tu email para confirmar tu cuenta antes de iniciar sesión."),p("login"),r(!1)):(s("Cuenta creada pero requiere configuración adicional. Contacta al administrador del sistema."),r(!1))}catch(t){s(t.message||"Error inesperado durante el registro. Por favor, intenta nuevamente."),r(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("a",{href:"/",className:"inline-flex items-center gap-2 text-slate-400 hover:text-white transition-colors mb-6",children:[e.jsx(_,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Volver al Inicio"})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-4xl",children:"⚙️"})}),e.jsx("h1",{className:"text-3xl text-white font-bold mb-2",children:d==="login"?"Admin Login":d==="register"?"Registrar Admin":"Recuperar Acceso"}),e.jsx("p",{className:"text-slate-400",children:"Panel de Administración del Sistema"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-8 shadow-2xl",children:[u&&e.jsxs("div",{className:`mb-6 p-4 rounded-lg flex items-start gap-3 ${u.includes("✅")?"bg-green-500/10 border border-green-500/50":"bg-red-500/10 border border-red-500/50"}`,children:[e.jsx(k,{className:`w-5 h-5 flex-shrink-0 mt-0.5 ${u.includes("✅")?"text-green-400":"text-red-400"}`}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:`text-sm ${u.includes("✅")?"text-green-400":"text-red-400"}`,children:u})})]}),f&&e.jsxs("div",{className:"mb-6 p-4 bg-green-500/10 border border-green-500/50 rounded-lg flex items-start gap-3",children:[e.jsx(k,{className:"w-5 h-5 text-green-400 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-green-400",children:f})})]}),d==="forgot_password"?e.jsxs("div",{className:"space-y-4",children:[S==="email"?e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Email de Administrador"}),e.jsx("input",{type:"email",value:l,onChange:a=>j(a.target.value),placeholder:"admin@empresa.com",required:!0,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50"})]}),e.jsxs("button",{type:"submit",disabled:c,className:"w-full bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-500 hover:to-purple-400 disabled:from-slate-700 disabled:to-slate-700 disabled:text-slate-500 text-white px-6 py-3 rounded-lg font-semibold transition-all shadow-lg shadow-purple-500/20 disabled:shadow-none flex items-center justify-center gap-2",children:[e.jsx(O,{className:"w-5 h-5"}),e.jsx("span",{children:c?"Enviando...":"Enviar Código de Recuperación"})]}),e.jsx("button",{type:"button",onClick:A,className:"w-full text-sm text-slate-400 hover:text-white transition-colors py-2 mt-2",children:"¿Ya tienes un código? Ingrésalo aquí"})]}):e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-purple-500/10 border border-purple-500/30 rounded-lg mb-4",children:e.jsx("p",{className:"text-sm text-purple-300 text-center",children:f||e.jsxs(e.Fragment,{children:["Ingresa el código enviado a ",e.jsx("strong",{children:l})]})})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Código de Verificación"}),e.jsx("input",{type:"text",value:b,onChange:a=>y(a.target.value.replace(/\D/g,"").slice(0,8)),placeholder:"123456",required:!0,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50 text-center text-2xl tracking-widest font-mono"})]}),e.jsxs("button",{type:"submit",disabled:c||b.length<6,className:"w-full bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 disabled:from-slate-700 disabled:to-slate-700 disabled:text-slate-500 text-white px-6 py-3 rounded-lg font-semibold transition-all shadow-lg shadow-green-500/20 disabled:shadow-none flex items-center justify-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),e.jsx("span",{children:c?"Verificando...":"Verificar y Cambiar Password"})]}),e.jsx("button",{type:"button",onClick:()=>{g("email"),y(""),s("")},className:"w-full text-sm text-slate-400 hover:text-white transition-colors py-2",children:"Volver a ingresar email"})]}),e.jsx("button",{type:"button",onClick:()=>{p("login"),g("email"),s(""),m("")},className:"w-full text-sm text-slate-400 hover:text-white transition-colors py-2 border-t border-slate-700/50 mt-4",children:"Volver al Login"})]}):e.jsxs("form",{onSubmit:d==="login"?q:I,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Email de Administrador"}),e.jsx("input",{type:"email",value:l,onChange:a=>j(a.target.value),placeholder:"admin@empresa.com",required:!0,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Contraseña"}),e.jsx("input",{type:"password",value:h,onChange:a=>C(a.target.value),placeholder:"••••••••",required:!0,minLength:6,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50"}),d==="login"&&e.jsx("div",{className:"flex justify-end mt-1",children:e.jsx("button",{type:"button",onClick:()=>{p("forgot_password"),s("")},className:"text-xs text-purple-400 hover:text-purple-300 transition-colors",children:"¿Olvidaste tu contraseña?"})})]}),d==="register"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Nombre"}),e.jsx("input",{type:"text",value:w,onChange:a=>E(a.target.value),placeholder:"Nombre del Administrador",required:!0,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50"})]}),e.jsxs("button",{type:"submit",disabled:c,className:"w-full bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-500 hover:to-purple-400 disabled:from-slate-700 disabled:to-slate-700 disabled:text-slate-500 text-white px-6 py-3 rounded-lg font-semibold transition-all shadow-lg shadow-purple-500/20 disabled:shadow-none flex items-center justify-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),e.jsx("span",{children:c?"Procesando...":d==="login"?"Iniciar Sesión":"Registrarse"})]})]}),d!=="forgot_password"&&e.jsx("div",{className:"mt-6 pt-6 border-t border-slate-700/50",children:e.jsx("div",{className:"bg-amber-900/20 border border-amber-600/30 rounded-lg p-4",children:e.jsx("p",{className:"text-xs text-amber-400 text-center",children:"⚠️ Acceso restringido solo para administradores del sistema"})})})]})]})})}export{F as AdminAuth};
