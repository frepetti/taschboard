import{c as O,u as q,j as e,s as j,r as d,L as $,a as R}from"./index-BvDo0rdQ.js";import{C as U,a as L,R as F,E as H}from"./refresh-cw-DpBEuket.js";import{S as Y,P as V,M as B,a as _,C as G,X as T,b as I}from"./x-DVLb9y0z.js";import{A as E}from"./arrow-left-D5_T9bTh.js";import{C as D}from"./check-circle-mVUCCQYL.js";import{M as Q}from"./minus-BEQdUJGj.js";const M=O("Bug",[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]]);const W=O("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const K=O("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);function J({currentView:t,onViewChange:s}){const{t:o}=q();return e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>s("new"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg transition-all ${t==="new"?"bg-amber-600 text-white":"bg-slate-800/50 text-slate-400 hover:bg-slate-800"}`,children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:o("inspector.new_inspection")})]}),e.jsxs("button",{onClick:()=>s("history"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg transition-all ${t==="history"?"bg-amber-600 text-white":"bg-slate-800/50 text-slate-400 hover:bg-slate-800"}`,children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:o("inspector.history")})]})]})})}async function z(){const{data:{user:t},error:s}=await j.auth.getUser();if(s||!t){console.warn("‚ö†Ô∏è [API Direct] getUser failed, trying to refresh session...",s);const{data:{session:o},error:r}=await j.auth.refreshSession();if(r||!o?.user)throw console.error("‚ùå [API Direct] Auth error after refresh:",r),typeof window<"u"&&(console.log("üì¢ Dispatching auth:unauthorized event from API Direct"),window.dispatchEvent(new Event("auth:unauthorized"))),new Error("No est√°s autenticado. Por favor inicia sesi√≥n nuevamente.");return console.log("‚úÖ [API Direct] Session refreshed, user authenticated:",o.user.email),o.user}return console.log("‚úÖ [API Direct] User authenticated:",t.email),t}async function k(t){const{data:s,error:o}=await t();if(!o)return s;if(o.code==="401"||o.code==="PGRST301"||o.message&&(o.message.includes("JWT")||o.message.includes("unauthorized")||o.message.includes("session"))){console.warn("‚ö†Ô∏è [API Direct] Auth error detected, attempting to refresh session...",o);const{data:c,error:u}=await j.auth.refreshSession();if(u||!c.session)throw console.error("‚ùå [API Direct] Session refresh failed:",u),new Error("Unauthorized: Invalid JWT. Please try logging out and logging in again.");console.log("‚úÖ [API Direct] Session refreshed successfully, retrying query...");const{data:n,error:g}=await t();if(g)throw console.error("‚ùå [API Direct] Query failed after refresh:",g),g;return n}throw o}async function X(){console.log("üì° [API Direct] Fetching inspections from Supabase...");try{const t=await z(),s=await k(async()=>j.from("btl_usuarios").select("id, rol").eq("auth_user_id",t.id).single());if(!s)return console.log("‚ö†Ô∏è [API Direct] Usuario no encontrado en btl_usuarios"),[];console.log("‚úÖ [API Direct] Usuario BTL ID:",s.id,"Rol:",s.rol);const o=await k(()=>j.from("btl_inspecciones").select("*").eq("usuario_id",s.id).order("fecha_inspeccion",{ascending:!1}));return console.log(`‚úÖ [API Direct] Loaded ${o?.length||0} inspections`),o||[]}catch(t){throw console.error("‚ùå [API Direct] Error:",t),t}}async function Z(t){console.log("üì° [API Direct] Creating inspection...");try{const s=await z();let o;try{o=await k(()=>j.from("btl_usuarios").select("id, nombre, rol").eq("auth_user_id",s.id).single())}catch(c){if(c.code==="PGRST116")o=null;else throw c}if(!o){if(console.log("‚ö†Ô∏è [API Direct] Usuario no existe en btl_usuarios, creando..."),o=await k(()=>j.from("btl_usuarios").insert({auth_user_id:s.id,email:s.email,nombre:s.email?.split("@")[0]||"Inspector",rol:"inspector",activo:!0}).select("id, nombre, rol").single()),!o)throw new Error("No se pudo crear el usuario. Por favor contacta al administrador.");console.log("‚úÖ [API Direct] Usuario creado:",o.id)}console.log("‚úÖ [API Direct] Usuario BTL:",{id:o.id,nombre:o.nombre,rol:o.rol});const r=await k(()=>j.from("btl_inspecciones").insert({...t,usuario_id:o.id}).select().single());return console.log("‚úÖ [API Direct] Inspection created:",r.id),r}catch(s){throw console.error("‚ùå [API Direct] Error:",s),s}}async function ee(){console.log("üì° [API Direct] Fetching venues from Supabase...");try{const t=await k(()=>j.from("btl_puntos_venta").select("*").order("nombre"));return console.log(`‚úÖ [API Direct] Loaded ${t?.length||0} venues`),t||[]}catch(t){throw console.error("‚ùå [API Direct] Error:",t),t}}async function se(t){console.log("üì° [API Direct] Creating venue...");try{const s=await k(()=>j.from("btl_puntos_venta").insert([{nombre:t.nombre,direccion:t.direccion,tipo:t.tipo,ciudad:t.ciudad||"Sin especificar",region:t.region||"Sin especificar"}]).select().single());return console.log("‚úÖ [API Direct] Venue created:",s.id),s}catch(s){throw console.error("‚ùå [API Direct] Error:",s),s}}async function te(){try{const{data:{session:t},error:s}=await j.auth.getSession();return s?(console.error("‚ùå [API Direct] Session error:",s),{authenticated:!1,error:s.message}):t?(console.log("‚úÖ [API Direct] Session active:",t.user.email),{authenticated:!0,user:{id:t.user.id,email:t.user.email,role:t.user.user_metadata?.role||"inspector"},session:t}):(console.log("‚ö†Ô∏è [API Direct] No active session"),{authenticated:!1,error:"No hay sesi√≥n activa"})}catch(t){return console.error("‚ùå [API Direct] Auth check error:",t),{authenticated:!1,error:t.message}}}function ae({onVenueSelect:t}){const{t:s}=q(),[o,r]=d.useState(""),[c,u]=d.useState(!1),[n,g]=d.useState(""),[h,l]=d.useState(""),[p,f]=d.useState("Bar"),[a,b]=d.useState([]),[N,v]=d.useState(!0),[C,i]=d.useState(!1);d.useEffect(()=>{w()},[]);const w=async()=>{v(!0);try{console.log("üîÑ [Venue Selection] Loading venues via Direct API...");const m=await ee();console.log("‚úÖ [Venue Selection] Loaded",m.length,"venues");const y=m.map(P=>({id:P.id,name:P.nombre,address:P.direccion,channel:P.tipo,city:P.ciudad,zone:P.region}));b(y)}catch(m){console.error("‚ùå [Venue Selection] Error loading venues:",m),console.log("‚ö†Ô∏è Using default venues as fallback"),b(A())}finally{v(!1)}},A=()=>[{id:1,name:"The Dead Rabbit",address:"30 Water St, New York",channel:"Bar",city:"New York"},{id:2,name:"Employees Only",address:"510 Hudson St, New York",channel:"Bar",city:"New York"},{id:3,name:"Attaboy",address:"134 Eldridge St, New York",channel:"Bar",city:"New York"},{id:4,name:"Dante NYC",address:"79-81 MacDougal St, New York",channel:"Bar",city:"New York"},{id:5,name:"Please Don't Tell",address:"113 St Marks Pl, New York",channel:"Bar",city:"New York"},{id:6,name:"Death & Co",address:"433 E 6th St, New York",channel:"Bar",city:"New York"},{id:7,name:"Eleven Madison Park",address:"11 Madison Ave, New York",channel:"Restaurant",city:"New York"},{id:8,name:"The Up & Up",address:"116 MacDougal St, New York",channel:"Club",city:"New York"}],x=a.filter(m=>m.name.toLowerCase().includes(o.toLowerCase())||m.address.toLowerCase().includes(o.toLowerCase())||m.zone&&m.zone.toLowerCase().includes(o.toLowerCase())),S=async()=>{if(n&&h){i(!0);try{const y=await se({nombre:n,direccion:h,tipo:p,ciudad:"New York"});t({id:y.id,name:y.nombre,address:y.direccion,channel:y.tipo,city:y.ciudad,isNew:!0})}catch(m){console.error("‚ùå [Venue Selection] Error creating venue:",m)}finally{i(!1)}}};return c?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6 shadow-xl",children:[e.jsx("h2",{className:"text-xl text-white font-semibold mb-6",children:s("inspector.add_venue")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-slate-300 mb-2",children:[s("inspector.venue_name")," *"]}),e.jsx("input",{type:"text",value:n,onChange:m=>g(m.target.value),placeholder:s("inspector.enter_venue_name"),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-slate-300 mb-2",children:[s("map.address")," *"]}),e.jsx("input",{type:"text",value:h,onChange:m=>l(m.target.value),placeholder:s("inspector.enter_address"),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-slate-300 mb-2",children:[s("inspector.channel_type")," *"]}),e.jsxs("select",{value:p,onChange:m=>f(m.target.value),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50",children:[e.jsx("option",{children:"Bar"}),e.jsx("option",{children:"Club"}),e.jsx("option",{children:"Restaurante"})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>u(!1),className:"flex-1 bg-slate-700/50 hover:bg-slate-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors",children:s("common.cancel")}),e.jsx("button",{onClick:S,disabled:!n||!h||C,className:"flex-1 bg-amber-600 hover:bg-amber-500 disabled:bg-slate-700 disabled:text-slate-500 text-white px-6 py-3 rounded-lg font-semibold transition-colors",children:s(C?"inspector.creating":"inspector.continue_inspection")})]})]})}):e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl text-white font-semibold",children:s("inspector.select_venue")}),!N&&a.length>0&&e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs bg-green-600/20 text-green-400 border border-green-600/30 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),a.length," ",s("inspector.venues_available")]})]}),N&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-amber-500/30 border-t-amber-500 rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-slate-400",children:s("common.loading")})]}),!N&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:s("inspector.search_placeholder"),value:o,onChange:m=>r(m.target.value),className:"w-full bg-slate-900/50 border border-slate-700 text-white pl-10 pr-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50"})]}),e.jsxs("button",{onClick:()=>u(!0),className:"w-full flex items-center justify-center gap-2 bg-amber-600/20 hover:bg-amber-600/30 border border-amber-600/50 text-amber-400 px-4 py-3 rounded-lg font-medium transition-colors mb-4",children:[e.jsx(V,{className:"w-5 h-5"}),e.jsx("span",{children:s("inspector.add_venue")})]}),a.length===0&&!o&&e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-slate-700 rounded-lg",children:[e.jsx(B,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg text-white font-semibold mb-2",children:s("common.no_data")}),e.jsx("p",{className:"text-slate-400 mb-4",children:s("inspector.start_adding_venue")}),e.jsxs("button",{onClick:()=>u(!0),className:"inline-flex items-center gap-2 bg-amber-600 hover:bg-amber-500 text-white px-6 py-2 rounded-lg font-medium transition-colors",children:[e.jsx(V,{className:"w-5 h-5"}),s("inspector.add_venue")]})]}),a.length>0&&e.jsx("div",{className:"space-y-2 max-h-[500px] overflow-y-auto",children:x.map(m=>e.jsx("button",{onClick:()=>t(m),className:"w-full text-left p-4 bg-slate-800/30 hover:bg-slate-800/50 border border-slate-700/30 hover:border-slate-600/50 rounded-lg transition-all group",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-semibold mb-1 group-hover:text-amber-400 transition-colors",children:m.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[e.jsx(B,{className:"w-3 h-3"}),e.jsx("span",{children:m.address})]}),m.zone&&e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[m.city," ‚Ä¢ ",m.zone]})]}),e.jsx("span",{className:"px-3 py-1 rounded-full text-xs bg-slate-700/50 text-slate-300 border border-slate-600/30",children:m.channel})]})},m.id))}),x.length===0&&o&&a.length>0&&e.jsxs("div",{className:"text-center py-8 text-slate-400",children:[e.jsx("p",{children:s("inspector.no_venues_found_query").replace("{query}",o)}),e.jsx("button",{onClick:()=>u(!0),className:"mt-4 text-amber-400 hover:text-amber-300 font-medium",children:s("inspector.add_as_new")})]})]})]})})}function re({venue:t,onBack:s,onProductSelect:o}){const[r,c]=d.useState([]),[u,n]=d.useState(!0),[g,h]=d.useState(null),[l,p]=d.useState(""),[f,a]=d.useState("all");d.useEffect(()=>{b()},[]);const b=async()=>{n(!0),h(null);try{console.log("üîç Loading products from btl_productos...");const{data:i,error:w}=await j.from("btl_productos").select("*").eq("activo",!0).order("orden_visualizacion",{ascending:!0});if(w)throw console.error("‚ùå Error loading products:",w),w;console.log("‚úÖ Loaded products:",i?.length||0),c(i||[]),(!i||i.length===0)&&h("No hay productos disponibles en el sistema. Por favor contacta al administrador para que cargue productos.")}catch(i){console.error("‚ùå Error loading products:",i),h(i.message||"Error al cargar los productos. Por favor intenta nuevamente.")}finally{n(!1)}},N=["all",...new Set(r.map(i=>i.categoria).filter(Boolean))],v=r.filter(i=>{const w=i.nombre.toLowerCase().includes(l.toLowerCase())||i.marca.toLowerCase().includes(l.toLowerCase()),A=f==="all"||i.categoria===f;return w&&A}),C=i=>{switch(i){case"Cerveza":return"bg-amber-500/20 text-amber-300 border-amber-500/30";case"Whisky":return"bg-orange-500/20 text-orange-300 border-orange-500/30";case"Vodka":return"bg-blue-500/20 text-blue-300 border-blue-500/30";case"Ron":return"bg-red-500/20 text-red-300 border-red-500/30";case"Tequila":return"bg-green-500/20 text-green-300 border-green-500/30";default:return"bg-slate-500/20 text-slate-300 border-slate-500/30"}};return u?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):g?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-4 shadow-xl",children:[e.jsxs("button",{onClick:s,className:"flex items-center gap-2 text-slate-400 hover:text-white transition-colors mb-3",children:[e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Cambiar Venue"})]}),e.jsx("h2",{className:"text-xl text-white font-semibold",children:t.name}),e.jsx("p",{className:"text-sm text-slate-400",children:t.address})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-8 text-center shadow-xl",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-red-500/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(_,{className:"w-8 h-8 text-red-400"})}),e.jsx("h3",{className:"text-xl text-white font-semibold mb-2",children:"No hay productos disponibles"}),e.jsx("p",{className:"text-slate-400 mb-6 max-w-md mx-auto",children:g}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:b,className:"bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded-lg transition-colors",children:"Reintentar"}),e.jsx("button",{onClick:s,className:"bg-slate-700 hover:bg-slate-600 text-white px-6 py-3 rounded-lg transition-colors",children:"Volver"})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-4 shadow-xl",children:[e.jsxs("button",{onClick:s,className:"flex items-center gap-2 text-slate-400 hover:text-white transition-colors mb-3",children:[e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Cambiar Venue"})]}),e.jsx("h2",{className:"text-xl text-white font-semibold",children:t.name}),e.jsx("p",{className:"text-sm text-slate-400",children:t.address})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6 shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center",children:e.jsx(_,{className:"w-5 h-5 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg text-white font-semibold",children:"Selecciona el Producto"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Elige el producto que vas a inspeccionar"})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por nombre o marca...",value:l,onChange:i=>p(i.target.value),className:"w-full bg-slate-900/50 border border-slate-700 text-white pl-10 pr-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]})}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:N.map(i=>e.jsx("button",{onClick:()=>a(i),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${f===i?"bg-blue-600 text-white":"bg-slate-800/50 text-slate-400 hover:bg-slate-800"}`,children:i==="all"?"Todos":i},i))}),v.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_,{className:"w-12 h-12 text-slate-600 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-400",children:"No se encontraron productos"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 max-h-[500px] overflow-y-auto pr-2",children:v.map(i=>e.jsx("button",{onClick:()=>o(i),className:"group relative bg-slate-800/30 hover:bg-slate-800/50 border border-slate-700/50 hover:border-blue-500/50 rounded-xl p-4 transition-all text-left",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:i.color_primario?`${i.color_primario}20`:"rgba(100, 116, 139, 0.2)"},children:i.logo_url?e.jsx("img",{src:i.logo_url,alt:i.marca,className:"w-10 h-10 object-contain"}):e.jsx(_,{className:"w-6 h-6",style:{color:i.color_primario||"#94a3b8"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsx("h4",{className:"text-white font-semibold text-sm leading-tight",children:i.marca}),e.jsx(D,{className:"w-5 h-5 text-blue-500 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0"})]}),e.jsx("p",{className:"text-slate-400 text-xs mb-2 line-clamp-2",children:i.nombre}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs border ${C(i.categoria)}`,children:i.categoria}),i.presentacion&&e.jsx("span",{className:"text-xs text-slate-500",children:i.presentacion})]})]})]})},i.id))})]})]})}function le({venue:t,product:s,onBack:o,onSubmit:r}){const[c,u]=d.useState(0),[n,g]=d.useState({brandOnMenu:!0,numberOfCocktails:3,backBarVisibility:"prominent",shelfPosition:"top",properGlassware:!0,iceQuality:!0,correctGarnish:!0,premiumTonic:!0,serveRitual:!0,backBarSignage:"good",menuInserts:"present",coasters:"present",tableCards:"missing",outdoorSignage:"not-applicable",staffKnowledge:8,certifiedBartenders:2,totalBartenders:4,brandAdvocacy:"high",mainCompetitor:"Tanqueray",competitorVisibility:"medium",priceComparison:"premium",estimatedMonthlyRotation:120,stockLevel:"adequate",outOfStock:!1,trainingNeeded:!0,materialRefresh:!0,activationPotential:"high",photos:[],notes:"",recommendedActions:""}),h=[{id:0,title:"Brand Presence",icon:"üè∑Ô∏è"},{id:1,title:"Perfect Serve",icon:"üç∏"},{id:2,title:"Materials & Signage",icon:"üìã"},{id:3,title:"Staff & Training",icon:"üë•"},{id:4,title:"Competition",icon:"‚öîÔ∏è"},{id:5,title:"Sales Data",icon:"üìä"},{id:6,title:"Photos & Notes",icon:"üì∏"}],l=(a,b)=>{g({...n,[a]:b})},p=a=>{if(a.target.files){const N=Array.from(a.target.files).map(v=>URL.createObjectURL(v));l("photos",[...n.photos,...N])}},f=()=>{r(n)};return s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-4 shadow-xl",children:[e.jsxs("button",{onClick:o,className:"flex items-center gap-2 text-slate-400 hover:text-white transition-colors mb-3",children:[e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Cambiar Producto"})]}),e.jsx("h2",{className:"text-xl text-white font-semibold mb-1",children:t.name}),e.jsx("p",{className:"text-sm text-slate-400 mb-3",children:t.address}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-900/50 border border-slate-700/50 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:s.color_primario?`${s.color_primario}20`:"rgba(100, 116, 139, 0.2)"},children:s.logo_url?e.jsx("img",{src:s.logo_url,alt:s.marca,className:"w-8 h-8 object-contain"}):e.jsx(_,{className:"w-5 h-5",style:{color:s.color_primario||"#94a3b8"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-semibold text-sm",children:s.marca}),e.jsx("div",{className:"text-slate-400 text-xs",children:s.nombre})]}),e.jsx("div",{className:"text-xs text-slate-500 px-2 py-1 bg-slate-800/50 rounded",children:s.categoria})]})]}),e.jsx("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-4 shadow-xl",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-7 gap-2",children:h.map(a=>e.jsxs("button",{onClick:()=>u(a.id),className:`flex flex-col sm:flex-row items-center justify-center gap-1.5 sm:gap-2 px-3 py-3 sm:py-2 rounded-lg text-sm font-medium transition-all ${c===a.id?"bg-amber-600 text-white shadow-lg shadow-amber-600/20":"bg-slate-800/50 text-slate-400 hover:bg-slate-800 hover:text-slate-300"}`,children:[e.jsx("span",{className:"text-lg sm:text-base",children:a.icon}),e.jsx("span",{className:"text-xs sm:text-sm text-center sm:text-left leading-tight",children:a.title})]},a.id))})}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6 shadow-xl",children:[c===0&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg text-white font-semibold",children:"Brand Presence"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Brand on Menu"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>l("brandOnMenu",!0),className:`flex-1 px-4 py-3 rounded-lg font-medium transition-all ${n.brandOnMenu?"bg-green-600 text-white":"bg-slate-800/50 text-slate-400"}`,children:"Yes"}),e.jsx("button",{onClick:()=>l("brandOnMenu",!1),className:`flex-1 px-4 py-3 rounded-lg font-medium transition-all ${n.brandOnMenu?"bg-slate-800/50 text-slate-400":"bg-red-600 text-white"}`,children:"No"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Number of Cocktails Featuring Brand"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>l("numberOfCocktails",Math.max(0,n.numberOfCocktails-1)),className:"w-10 h-10 rounded-lg bg-slate-800/50 hover:bg-slate-800 text-white flex items-center justify-center",children:e.jsx(Q,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex-1 text-center",children:e.jsx("div",{className:"text-3xl text-white font-bold",children:n.numberOfCocktails})}),e.jsx("button",{onClick:()=>l("numberOfCocktails",n.numberOfCocktails+1),className:"w-10 h-10 rounded-lg bg-slate-800/50 hover:bg-slate-800 text-white flex items-center justify-center",children:e.jsx(V,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Back Bar Visibility"}),e.jsxs("select",{value:n.backBarVisibility,onChange:a=>l("backBarVisibility",a.target.value),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50",children:[e.jsx("option",{value:"prominent",children:"Prominent"}),e.jsx("option",{value:"visible",children:"Visible"}),e.jsx("option",{value:"hidden",children:"Hidden"}),e.jsx("option",{value:"not-present",children:"Not Present"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Shelf Position"}),e.jsxs("select",{value:n.shelfPosition,onChange:a=>l("shelfPosition",a.target.value),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50",children:[e.jsx("option",{value:"top",children:"Top Shelf"}),e.jsx("option",{value:"middle",children:"Middle Shelf"}),e.jsx("option",{value:"bottom",children:"Bottom Shelf"}),e.jsx("option",{value:"not-present",children:"Not Present"})]})]})]}),c===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg text-white font-semibold mb-4",children:"Perfect Serve Checklist"}),[{key:"properGlassware",label:"Proper Glassware (Copa/Balloon)"},{key:"iceQuality",label:"Ice Quality & Size"},{key:"correctGarnish",label:"Correct Garnish (Cucumber)"},{key:"premiumTonic",label:"Premium Tonic Pairing"},{key:"serveRitual",label:"Serve Ritual Execution"}].map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-800/30 rounded-lg border border-slate-700/30",children:[e.jsx("span",{className:"text-slate-300",children:a.label}),e.jsx("button",{onClick:()=>l(a.key,!n[a.key]),className:`w-12 h-12 rounded-lg flex items-center justify-center transition-all ${n[a.key]?"bg-green-600 text-white":"bg-slate-700/50 text-slate-500"}`,children:n[a.key]?e.jsx(G,{className:"w-6 h-6"}):e.jsx(T,{className:"w-6 h-6"})})]},a.key))]}),c===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg text-white font-semibold",children:"Materials & Signage"}),[{key:"backBarSignage",label:"Back Bar Signage"},{key:"menuInserts",label:"Menu Inserts"},{key:"coasters",label:"Coasters"},{key:"tableCards",label:"Table Cards"},{key:"outdoorSignage",label:"Outdoor Signage"}].map(a=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:a.label}),e.jsxs("select",{value:n[a.key],onChange:b=>l(a.key,b.target.value),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50",children:[e.jsx("option",{value:"good",children:"Good Condition"}),e.jsx("option",{value:"present",children:"Present"}),e.jsx("option",{value:"worn",children:"Worn/Needs Refresh"}),e.jsx("option",{value:"missing",children:"Missing"}),e.jsx("option",{value:"not-applicable",children:"Not Applicable"})]})]},a.key))]}),c===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg text-white font-semibold",children:"Staff & Training"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Staff Knowledge (1-10)"}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"range",min:"1",max:"10",value:n.staffKnowledge,onChange:a=>l("staffKnowledge",parseInt(a.target.value)),className:"flex-1 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-amber-500"}),e.jsx("div",{className:"w-12 text-center",children:e.jsx("span",{className:"text-2xl text-amber-400 font-bold",children:n.staffKnowledge})})]}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500",children:[e.jsx("span",{children:"Poor"}),e.jsx("span",{children:"Excellent"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Certified Bartenders"}),e.jsx("input",{type:"number",value:n.certifiedBartenders,onChange:a=>l("certifiedBartenders",parseInt(a.target.value)),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Total Bartenders"}),e.jsx("input",{type:"number",value:n.totalBartenders,onChange:a=>l("totalBartenders",parseInt(a.target.value)),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Brand Advocacy Level"}),e.jsxs("select",{value:n.brandAdvocacy,onChange:a=>l("brandAdvocacy",a.target.value),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50",children:[e.jsx("option",{value:"high",children:"High - Actively Recommends"}),e.jsx("option",{value:"medium",children:"Medium - Neutral"}),e.jsx("option",{value:"low",children:"Low - Prefers Competitors"}),e.jsx("option",{value:"none",children:"None - No Knowledge"})]})]})]}),c===4&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg text-white font-semibold",children:"Competition Analysis"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Main Competitor"}),e.jsx("input",{type:"text",value:n.mainCompetitor,onChange:a=>l("mainCompetitor",a.target.value),placeholder:"e.g., Tanqueray, Bombay Sapphire",className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Competitor Visibility"}),e.jsxs("select",{value:n.competitorVisibility,onChange:a=>l("competitorVisibility",a.target.value),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50",children:[e.jsx("option",{value:"high",children:"High - More Prominent"}),e.jsx("option",{value:"medium",children:"Medium - Equal"}),e.jsx("option",{value:"low",children:"Low - Less Prominent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Price Comparison"}),e.jsxs("select",{value:n.priceComparison,onChange:a=>l("priceComparison",a.target.value),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50",children:[e.jsx("option",{value:"premium",children:"Premium (+$2-3)"}),e.jsx("option",{value:"equal",children:"Equal Pricing"}),e.jsx("option",{value:"lower",children:"Lower (-$2-3)"})]})]})]}),c===5&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg text-white font-semibold",children:"Sales & Inventory Data"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Estimated Monthly Rotation (bottles)"}),e.jsx("input",{type:"number",value:n.estimatedMonthlyRotation,onChange:a=>l("estimatedMonthlyRotation",parseInt(a.target.value)),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Current Stock Level"}),e.jsxs("select",{value:n.stockLevel,onChange:a=>l("stockLevel",a.target.value),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50",children:[e.jsx("option",{value:"overstocked",children:"Overstocked"}),e.jsx("option",{value:"adequate",children:"Adequate"}),e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"out-of-stock",children:"Out of Stock"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Out of Stock in Last 30 Days?"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>l("outOfStock",!0),className:`flex-1 px-4 py-3 rounded-lg font-medium transition-all ${n.outOfStock?"bg-red-600 text-white":"bg-slate-800/50 text-slate-400"}`,children:"Yes"}),e.jsx("button",{onClick:()=>l("outOfStock",!1),className:`flex-1 px-4 py-3 rounded-lg font-medium transition-all ${n.outOfStock?"bg-slate-800/50 text-slate-400":"bg-green-600 text-white"}`,children:"No"})]})]}),e.jsxs("div",{className:"bg-amber-900/20 border border-amber-600/30 rounded-lg p-4",children:[e.jsx("h4",{className:"text-amber-400 font-semibold mb-2",children:"Opportunity Assessment"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.trainingNeeded,onChange:a=>l("trainingNeeded",a.target.checked),className:"w-5 h-5 rounded bg-slate-800 border-slate-600 text-amber-500 focus:ring-amber-500"}),e.jsx("span",{className:"text-slate-300",children:"Training Needed"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.materialRefresh,onChange:a=>l("materialRefresh",a.target.checked),className:"w-5 h-5 rounded bg-slate-800 border-slate-600 text-amber-500 focus:ring-amber-500"}),e.jsx("span",{className:"text-slate-300",children:"Material Refresh Needed"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Activation Potential"}),e.jsxs("select",{value:n.activationPotential,onChange:a=>l("activationPotential",a.target.value),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50",children:[e.jsx("option",{value:"high",children:"High - Prime Target"}),e.jsx("option",{value:"medium",children:"Medium - Good Opportunity"}),e.jsx("option",{value:"low",children:"Low - Limited Potential"})]})]})]})]}),c===6&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg text-white font-semibold",children:"Photos & Notes"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Upload Photos"}),e.jsxs("div",{className:"border-2 border-dashed border-slate-700 rounded-lg p-6 text-center hover:border-slate-600 transition-colors",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:p,className:"hidden",id:"photo-upload"}),e.jsxs("label",{htmlFor:"photo-upload",className:"cursor-pointer",children:[e.jsx(W,{className:"w-12 h-12 text-slate-500 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-400 mb-1",children:"Click to upload photos"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Back bar, signage, materials, perfect serve"})]})]}),n.photos.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-3 mt-4",children:n.photos.map((a,b)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:a,alt:`Photo ${b+1}`,className:"w-full h-24 object-cover rounded-lg border border-slate-700"}),e.jsx("button",{onClick:()=>l("photos",n.photos.filter((N,v)=>v!==b)),className:"absolute -top-2 -right-2 w-6 h-6 bg-red-600 rounded-full flex items-center justify-center",children:e.jsx(T,{className:"w-4 h-4 text-white"})})]},b))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"General Notes"}),e.jsx("textarea",{value:n.notes,onChange:a=>l("notes",a.target.value),rows:4,placeholder:"General observations, staff interactions, venue atmosphere...",className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Recommended Actions"}),e.jsx("textarea",{value:n.recommendedActions,onChange:a=>l("recommendedActions",a.target.value),rows:4,placeholder:"Specific actions to improve brand presence, training recommendations, activation ideas...",className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50 resize-none"})]})]})]}),e.jsxs("div",{className:"flex gap-3 sticky bottom-4",children:[c>0&&e.jsx("button",{onClick:()=>u(c-1),className:"flex-1 bg-slate-700/50 hover:bg-slate-700 text-white px-6 py-4 rounded-lg font-semibold transition-colors",children:"Previous"}),c<h.length-1?e.jsx("button",{onClick:()=>u(c+1),className:"flex-1 bg-amber-600 hover:bg-amber-500 text-white px-6 py-4 rounded-lg font-semibold transition-colors",children:"Next Section"}):e.jsx("button",{onClick:f,className:"flex-1 bg-green-600 hover:bg-green-500 text-white px-6 py-4 rounded-lg font-semibold transition-colors",children:"Submit Inspection"})]})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-8 text-center shadow-xl",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-red-500/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(_,{className:"w-8 h-8 text-red-400"})}),e.jsx("h3",{className:"text-xl text-white font-semibold mb-2",children:"Error: Producto no seleccionado"}),e.jsx("p",{className:"text-slate-400 mb-6",children:"No se pudo cargar la informaci√≥n del producto."}),e.jsx("button",{onClick:o,className:"bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded-lg transition-colors",children:"Volver a seleccionar producto"})]})})}function ne({inspections:t,onRefresh:s,onBack:o}){const[r,c]=d.useState(null),[u,n]=d.useState({});d.useEffect(()=>{(async()=>{if(!t||t.length===0)return;const p=[...new Set(t.map(b=>b.punto_venta_id).filter(Boolean))];if(p.length===0)return;const{data:f,error:a}=await j.from("btl_puntos_venta").select("id, nombre").in("id",p);if(!a&&f){const b={};f.forEach(N=>{b[N.id]=N.nombre}),n(b)}})()},[t]);const g=l=>new Date(l).toLocaleDateString("es-ES",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}),h=t||[];return h.length===0?e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-12 shadow-xl text-center",children:[e.jsx(L,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl text-white font-semibold mb-2",children:"No hay inspecciones a√∫n"}),e.jsx("p",{className:"text-slate-400",children:"Tus inspecciones completadas aparecer√°n aqu√≠"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-4 sm:p-6 shadow-xl",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl text-white font-semibold mb-2",children:"Historial de Inspecciones"}),e.jsxs("p",{className:"text-slate-400 text-sm",children:[h.length," inspecci√≥n",h.length!==1?"es":""," completada",h.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[s&&e.jsxs("button",{onClick:s,className:"flex items-center gap-2 bg-slate-800/50 hover:bg-slate-800 border border-slate-700/50 text-slate-300 px-4 py-2 rounded-lg transition-colors text-sm",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{children:"Actualizar"})]}),o&&e.jsxs("button",{onClick:o,className:"flex items-center gap-2 bg-amber-500/20 hover:bg-amber-500/30 border border-amber-500/30 text-amber-400 px-4 py-2 rounded-lg transition-colors text-sm",children:[e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{children:"Nueva Inspecci√≥n"})]})]})]})}),e.jsx("div",{className:"space-y-3",children:h.map((l,p)=>{const f=h.length-p;return e.jsxs("div",{onClick:()=>c(l),className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-4 sm:p-5 shadow-xl hover:border-amber-500/50 hover:shadow-amber-500/10 transition-all cursor-pointer group",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4 gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"text-base sm:text-lg text-white font-semibold mb-1",children:["Inspecci√≥n #",f]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm text-slate-400 mb-2",children:[e.jsx(B,{className:"w-3 h-3 shrink-0"}),e.jsx("span",{className:"truncate",children:u[l.punto_venta_id]||"Cargando..."})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[e.jsx(L,{className:"w-3 h-3 shrink-0"}),e.jsx("span",{children:g(l.fecha_inspeccion||l.created_at)})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("div",{className:`flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-1 rounded-lg ${l.tiene_producto?"bg-green-500/20 text-green-400 border border-green-500/30":"bg-red-500/20 text-red-400 border border-red-500/30"}`,children:l.tiene_producto?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold hidden sm:inline",children:"Producto Presente"})]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold hidden sm:inline",children:"Sin Producto"})]})}),e.jsx(H,{className:"w-5 h-5 text-slate-500 group-hover:text-amber-400 transition-colors hidden sm:block"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-3 pt-3 sm:pt-4 border-t border-slate-700/50",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] sm:text-xs text-slate-400 mb-1",children:"Stock"}),e.jsx("div",{className:"text-sm sm:text-lg text-white font-semibold",children:l.stock_estimado||"N/A"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] sm:text-xs text-slate-400 mb-1",children:"Temp."}),e.jsx("div",{className:"text-sm sm:text-lg text-white font-semibold",children:l.temperatura_refrigeracion?`${l.temperatura_refrigeracion}¬∞C`:"N/A"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] sm:text-xs text-slate-400 mb-1",children:"Material POP"}),e.jsx("div",{className:"text-sm sm:text-lg text-white font-semibold",children:l.tiene_material_pop?e.jsx(D,{className:"w-4 h-4 sm:w-5 sm:h-5 text-green-400 mx-auto"}):e.jsx(I,{className:"w-4 h-4 sm:w-5 sm:h-5 text-red-400 mx-auto"})})]})]})]},l.id)})})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>c(null),children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/95 to-slate-900/95 backdrop-blur-xl border border-slate-700/50 rounded-xl max-w-3xl w-full shadow-2xl max-h-[90vh] overflow-y-auto",onClick:l=>l.stopPropagation(),children:[e.jsx("div",{className:"sticky top-0 bg-gradient-to-r from-amber-600/20 to-amber-500/20 border-b border-amber-500/30 p-4 sm:p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl sm:text-2xl text-white font-bold",children:["Inspecci√≥n #",h.length-h.findIndex(l=>l.id===r.id)]}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:u[r.punto_venta_id]||"Punto de Venta"})]}),e.jsx("button",{onClick:()=>c(null),className:"text-slate-400 hover:text-white transition-colors",children:e.jsx(I,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 mb-2",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Fecha de Inspecci√≥n"})]}),e.jsx("p",{className:"text-white text-lg",children:g(r.fecha_inspeccion||r.created_at)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-slate-400 mb-3",children:"Estado del Producto"}),e.jsx("div",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-lg ${r.tiene_producto?"bg-green-500/20 text-green-400 border border-green-500/30":"bg-red-500/20 text-red-400 border border-red-500/30"}`,children:r.tiene_producto?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Producto Presente"})]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Sin Producto"})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-slate-800/30 rounded-lg p-4 border border-slate-700/30",children:[e.jsx("div",{className:"text-xs text-slate-400 mb-1",children:"Stock Estimado"}),e.jsx("div",{className:"text-2xl text-white font-bold",children:r.stock_estimado||"N/A"})]}),e.jsxs("div",{className:"bg-slate-800/30 rounded-lg p-4 border border-slate-700/30",children:[e.jsx("div",{className:"text-xs text-slate-400 mb-1",children:"Temperatura"}),e.jsx("div",{className:"text-2xl text-white font-bold",children:r.temperatura_refrigeracion?`${r.temperatura_refrigeracion}¬∞C`:"N/A"})]}),e.jsxs("div",{className:"bg-slate-800/30 rounded-lg p-4 border border-slate-700/30",children:[e.jsx("div",{className:"text-xs text-slate-400 mb-1",children:"Material POP"}),e.jsx("div",{className:"text-2xl text-white font-bold",children:r.tiene_material_pop?e.jsx(D,{className:"w-8 h-8 text-green-400 mx-auto"}):e.jsx(I,{className:"w-8 h-8 text-red-400 mx-auto"})})]})]}),r.material_pop_detalle&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-slate-400 mb-2",children:"Material POP Detalle"}),e.jsx("div",{className:"bg-slate-800/30 rounded-lg p-4 border border-slate-700/30",children:e.jsx("p",{className:"text-slate-300",children:typeof r.material_pop_detalle=="string"?r.material_pop_detalle:JSON.stringify(r.material_pop_detalle)})})]}),r.observaciones&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-slate-400 mb-2",children:"Observaciones"}),e.jsx("div",{className:"bg-slate-800/30 rounded-lg p-4 border border-slate-700/30",children:e.jsxs("p",{className:"text-slate-300 italic",children:["‚Äú",r.observaciones,"‚Äù"]})})]}),r.fotos_urls&&r.fotos_urls.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm text-slate-400 mb-3",children:["Fotos (",r.fotos_urls.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:r.fotos_urls.map((l,p)=>e.jsx("div",{className:"aspect-square bg-slate-700 rounded-lg overflow-hidden",children:e.jsx("img",{src:l,alt:`Foto ${p+1}`,className:"w-full h-full object-cover"})},p))})]})]})]})})]})}function oe({session:t}){const[s,o]=d.useState(!1),[r,c]=d.useState(null),[u,n]=d.useState(!1),g=async()=>{n(!0);const h={session:{},directAPI:{},timestamp:new Date().toISOString()};h.session={exists:!!t,hasAccessToken:!!t?.access_token,tokenLength:t?.access_token?.length||0,tokenPreview:t?.access_token?.substring(0,20)+"..."||"N/A",user:{id:t?.user?.id||"N/A",email:t?.user?.email||"N/A",emailConfirmed:t?.user?.email_confirmed_at?"‚úÖ Yes":"‚ùå No",role:t?.user?.role||t?.user?.user_metadata?.role||"N/A"},expiresAt:t?.expires_at?new Date(t.expires_at*1e3).toISOString():"N/A",isExpired:t?.expires_at?Date.now()>t.expires_at*1e3:"Unknown"};try{console.log("üîç Testing Direct API auth...");const l=await te();h.directAPI.authCheck={status:l.authenticated?"‚úÖ Authenticated":"‚ùå Not Authenticated",authenticated:l.authenticated,user:l.user||null,error:l.error||null}}catch(l){h.directAPI.authCheck={status:"‚ùå Failed",error:l.message}}c(h),n(!1)};return s?e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-gray-900 text-white rounded-lg shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gray-800 px-6 py-4 flex items-center justify-between border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{className:"w-6 h-6 text-purple-400"}),e.jsx("h2",{className:"text-xl font-bold",children:"Debug Panel"})]}),e.jsx("button",{onClick:()=>o(!1),className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(T,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("p",{className:"text-gray-300",children:"This panel shows your session info and tests the Edge Function connection."}),e.jsxs("button",{onClick:g,disabled:u,className:"flex items-center gap-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors",children:[e.jsx(F,{className:`w-4 h-4 ${u?"animate-spin":""}`}),"Run Tests"]})]}),r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-amber-400 mb-3",children:"1. Session Information"}),e.jsxs("div",{className:"space-y-2 text-sm font-mono",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Session exists:"}),e.jsx("span",{className:r.session.exists?"text-green-400":"text-red-400",children:r.session.exists?"‚úÖ Yes":"‚ùå No"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Has access token:"}),e.jsx("span",{className:r.session.hasAccessToken?"text-green-400":"text-red-400",children:r.session.hasAccessToken?"‚úÖ Yes":"‚ùå No"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Token length:"}),e.jsxs("span",{className:"text-white",children:[r.session.tokenLength," chars"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Token preview:"}),e.jsx("span",{className:"text-white text-xs",children:r.session.tokenPreview})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"User email:"}),e.jsx("span",{className:"text-white",children:r.session.user.email})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Email confirmed:"}),e.jsx("span",{className:r.session.user.emailConfirmed.includes("‚úÖ")?"text-green-400":"text-red-400",children:r.session.user.emailConfirmed})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Token expires:"}),e.jsx("span",{className:"text-white text-xs",children:r.session.expiresAt})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Is expired:"}),e.jsx("span",{className:r.session.isExpired?"text-red-400":"text-green-400",children:r.session.isExpired?"‚ùå Yes (expired!)":"‚úÖ No (valid)"})]})]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-amber-400 mb-3",children:"2. Direct API Auth Check"}),e.jsxs("div",{className:"space-y-2 text-sm font-mono",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("span",{className:r.directAPI.authCheck.authenticated?"text-green-400":"text-red-400",children:r.directAPI.authCheck.status})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-gray-400",children:"Response:"}),e.jsx("pre",{className:"mt-1 bg-gray-900 p-2 rounded overflow-x-auto text-xs text-green-300",children:JSON.stringify(r.directAPI.authCheck.user||r.directAPI.authCheck.error,null,2)})]})]})]}),e.jsxs("div",{className:"bg-purple-900/50 border border-purple-500 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-300 mb-2",children:"üìä Summary"}),e.jsxs("div",{className:"text-sm space-y-1",children:[r.session.exists&&r.session.hasAccessToken?e.jsx("p",{className:"text-green-300",children:"‚úÖ Session is valid and has access token"}):e.jsx("p",{className:"text-red-300",children:"‚ùå Session is missing or invalid"}),r.directAPI.authCheck.authenticated?e.jsx("p",{className:"text-green-300",children:"‚úÖ Direct API auth check passed"}):e.jsxs("p",{className:"text-red-300",children:["‚ùå Direct API auth check failed - Status: ",r.directAPI.authCheck.status]})]})]})]}),!r&&e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(M,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:'Click "Run Tests" to start debugging'})]})]})]})}):e.jsx("button",{onClick:()=>o(!0),className:"fixed bottom-4 right-4 bg-purple-600 hover:bg-purple-700 text-white p-3 rounded-full shadow-lg z-50 transition-colors",title:"Open Debug Panel",children:e.jsx(M,{className:"w-6 h-6"})})}function ue({session:t}){const[s,o]=d.useState("new"),[r,c]=d.useState(null),[u,n]=d.useState(null),[g,h]=d.useState([]),[l,p]=d.useState(!1),[f,a]=d.useState(null);t.access_token,d.useEffect(()=>{b()},[]);const b=async()=>{p(!0),a(null);try{console.log("üîÑ [Inspector Dashboard] Loading inspections via Direct API...");const x=await X();h(x),console.log("‚úÖ [Inspector Dashboard] Loaded",x.length,"inspections")}catch(x){console.error("‚ùå [Inspector Dashboard] Error loading inspections:",x),x.message?.includes("autenticado")||x.message?.includes("sesi√≥n")?a("Tu sesi√≥n ha expirado. Por favor cierra sesi√≥n e inicia sesi√≥n nuevamente."):a(x.message||"Error al cargar las inspecciones")}finally{p(!1)}},N=x=>{c(x)},v=x=>{n(x)},C=()=>{c(null),n(null)},i=()=>{n(null)},w=async x=>{try{console.log("üìù [Inspector Dashboard] Submitting inspection via Direct API..."),console.log("üì¶ Selected Product:",u);const S={punto_venta_id:r.id,producto_id:u.id,fecha_inspeccion:new Date().toISOString(),tiene_producto:x.brand_present||!1,tiene_material_pop:x.pos_materials&&x.pos_materials.length>0||!1,material_pop_detalle:x.pos_materials?JSON.stringify(x.pos_materials):null,temperatura_refrigeracion:x.temperature||null,stock_estimado:x.stock_level||null,observaciones:x.notes||"",fotos_urls:x.photos||[],productData:{producto_id:u.id,tiene_producto:x.brandOnMenu||!1,stock_nivel:x.stockLevel||"adequate",tiene_material_pop:x.backBarSignage!=="missing"&&x.backBarSignage!=="not-applicable"||!1,observaciones:x.notes||""}};await Z(S),console.log("‚úÖ [Inspector Dashboard] Inspection created successfully"),R.success("Inspecci√≥n Enviada",{description:"Datos guardados exitosamente"}),await b(),c(null),n(null)}catch(S){console.error("‚ùå [Inspector Dashboard] Error submitting inspection:",S),R.error("Error al enviar la inspecci√≥n",{description:S.message||"Por favor intenta de nuevo."})}},A=async()=>{console.log("üîÑ Forcing logout due to auth error..."),await j.auth.signOut(),localStorage.clear(),sessionStorage.clear(),window.location.href="/?mode=inspector"};return e.jsxs(e.Fragment,{children:[e.jsx(J,{currentView:s,onViewChange:o}),e.jsx("main",{className:"max-w-[1600px] mx-auto px-4 sm:px-8 py-6 pb-20",children:l&&s==="history"?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx($,{className:"w-8 h-8 text-amber-500 animate-spin"})}):s==="new"?e.jsx(e.Fragment,{children:r?u?e.jsx(le,{venue:r,product:u,onBack:i,onSubmit:w}):e.jsx(re,{venue:r,onBack:C,onProductSelect:v}):e.jsx(ae,{onVenueSelect:N})}):e.jsx(ne,{inspections:g,onRefresh:b,onBack:()=>o("new")})}),f&&e.jsx("div",{className:"fixed top-20 left-1/2 -translate-x-1/2 z-50 max-w-md animate-in slide-in-from-top",children:e.jsx("div",{className:"bg-red-500/95 backdrop-blur-sm text-white px-6 py-4 rounded-lg shadow-2xl",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Error de Autenticaci√≥n"}),e.jsx("div",{className:"text-sm opacity-90 mb-3",children:f}),e.jsx("button",{onClick:A,className:"bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors",children:"Cerrar Sesi√≥n e Ingresar Nuevamente"})]}),e.jsx("button",{onClick:()=>a(null),className:"flex-shrink-0 text-white/70 hover:text-white",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})}),e.jsx(oe,{session:t})]})}export{ue as InspectorDashboard};
