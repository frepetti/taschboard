import{c as O,r as i,j as e,s as d}from"./index-BvDo0rdQ.js";import{a as A}from"./api-_AOULUoD.js";import{A as D}from"./arrow-left-D5_T9bTh.js";import{A as T}from"./alert-circle-Da_Orva5.js";import{M as V}from"./mail-COyL00Av.js";import{L as R}from"./lock-DTJvx-Oe.js";const E=O("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);function F({onAuthSuccess:v}){const[c,m]=i.useState("login"),[S,x]=i.useState("email"),[l,p]=i.useState(""),[f,j]=i.useState(""),[h,w]=i.useState(""),[y,N]=i.useState(""),[u,o]=i.useState(!1),[k,s]=i.useState(""),[b,n]=i.useState(""),P=()=>{const r={user:{id:"demo-inspector",email:"inspector@demo.com",user_metadata:{role:"inspector",name:"Inspector Demo"}},access_token:"demo-token"};localStorage.setItem("inspector_demo_mode","true"),v(r)},_=()=>{if(!l||!l.includes("@")){s("Por favor ingresa tu email primero para validar el cÃ³digo.");return}s(""),n(""),x("otp")},L=async r=>{r.preventDefault(),s(""),n(""),o(!0);try{const{error:a}=await d.auth.signInWithOtp({email:l,options:{shouldCreateUser:!1}});if(a)if(a.message.includes("security purposes")){const t=a.message.match(/after (\d+) seconds/),g=t?t[1]:"unos";s(`â³ Por seguridad, debes esperar ${g} segundos antes de solicitar otro cÃ³digo.`)}else s(a.message);else n("âœ… CÃ³digo enviado. Por favor revisa tu correo e ingresa el cÃ³digo numÃ©rico."),x("otp")}catch(a){s(a.message||"Error al enviar cÃ³digo")}finally{o(!1)}},M=async r=>{r.preventDefault(),s(""),o(!0);try{const{data:a,error:t}=await d.auth.verifyOtp({email:l,token:h,type:"email"});if(t){s("El cÃ³digo ingresado es invÃ¡lido o ha expirado."),o(!1);return}a.session&&(sessionStorage.setItem("auth_reset_mode","true"),window.location.reload())}catch(a){s(a.message||"Error al verificar cÃ³digo"),o(!1)}},I=async r=>{r.preventDefault(),s(""),n(""),o(!0);try{const{data:a,error:t}=await d.auth.signInWithPassword({email:l,password:f});if(t){t.message.includes("Email not confirmed")||t.message.includes("not confirmed")?s("âš ï¸ Tu email aÃºn no ha sido confirmado. Por favor revisa tu bandeja de entrada y confirma tu cuenta antes de iniciar sesiÃ³n."):s(t.message),o(!1);return}if(a.user&&!a.user.email_confirmed_at){s("âš ï¸ Tu email aÃºn no ha sido confirmado. Por favor revisa tu bandeja de entrada y confirma tu cuenta."),await d.auth.signOut(),o(!1);return}if(a.session&&a.session.user.user_metadata?.role!=="inspector"){s("Acceso denegado. Esta cuenta no estÃ¡ registrada como inspector."),await d.auth.signOut(),o(!1);return}if(a.user){const{data:g,error:C}=await d.from("btl_usuarios").select("estado_aprobacion").eq("email",a.user.email).single();if(C){console.error("Error checking user approval status:",C),s("Error al verificar el estado de la cuenta. Por favor contacta al administrador."),await d.auth.signOut(),o(!1);return}if(g?.estado_aprobacion==="pending"){s("â³ Tu cuenta estÃ¡ pendiente de aprobaciÃ³n. Un administrador debe aprobar tu solicitud antes de que puedas acceder."),await d.auth.signOut(),o(!1);return}if(g?.estado_aprobacion==="rejected"){s("âŒ Tu solicitud de cuenta fue rechazada. Por favor contacta al administrador para mÃ¡s informaciÃ³n."),await d.auth.signOut(),o(!1);return}}a.session&&v(a.session)}catch(a){s(a.message||"Error durante el login"),o(!1)}},q=async r=>{r.preventDefault(),s(""),n(""),o(!0);try{const a=await A.signup(l,f,y,"inspector");if(!a.success){const t=a.error||"Error durante el registro";t.includes("already registered")||t.includes("already exists")?(s("Este email ya estÃ¡ registrado. Por favor, intenta iniciar sesiÃ³n."),m("login")):t.includes("invalid")||t.includes("credentials")?s("Error al crear la cuenta. Verifica que el email sea vÃ¡lido y la contraseÃ±a tenga al menos 6 caracteres."):s(t),o(!1);return}n(`âœ… Cuenta creada exitosamente! 

ðŸ“§ **Paso 1:** Hemos enviado un email de confirmaciÃ³n a ${l}. Por favor revisa tu bandeja de entrada y confirma tu cuenta.

â³ **Paso 2:** Un administrador revisarÃ¡ y aprobarÃ¡ tu solicitud. RecibirÃ¡s una notificaciÃ³n cuando puedas acceder.`),o(!1),p(""),j(""),N(""),setTimeout(()=>{m("login"),n("")},8e3)}catch(a){const t=a.message||"Error inesperado durante el registro";t.includes("already registered")||t.includes("already exists")?(s("Este email ya estÃ¡ registrado. Por favor, intenta iniciar sesiÃ³n."),m("login")):t.includes("invalid")||t.includes("credentials")?s("Error al crear la cuenta. Verifica que el email sea vÃ¡lido y la contraseÃ±a tenga al menos 6 caracteres."):s(t),o(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("a",{href:"/",className:"inline-flex items-center gap-2 text-slate-400 hover:text-white transition-colors mb-6",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Back to Home"})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-4xl",children:"ðŸ“‹"})}),e.jsx("h1",{className:"text-3xl text-white font-bold mb-2",children:"Inspector Login"}),e.jsx("p",{className:"text-slate-400",children:"Acceso para empleados de campo"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-8 shadow-2xl",children:[k&&e.jsxs("div",{className:"mb-6 p-4 bg-red-500/10 border border-red-500/50 rounded-lg flex items-start gap-3",children:[e.jsx(T,{className:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-red-400",children:k})})]}),b&&e.jsxs("div",{className:"mb-6 p-4 bg-green-500/10 border border-green-500/50 rounded-lg flex items-start gap-3",children:[e.jsx(E,{className:"w-5 h-5 text-green-400 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-green-400",children:b})})]}),c==="forgot_password"?e.jsxs("div",{className:"space-y-4",children:[S==="email"?e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Email Corporativo"}),e.jsx("input",{type:"email",value:l,onChange:r=>p(r.target.value),placeholder:"tu@empresa.com",required:!0,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),e.jsxs("button",{type:"submit",disabled:u,className:"w-full bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 disabled:from-slate-700 disabled:to-slate-700 disabled:text-slate-500 text-white px-6 py-3 rounded-lg font-semibold transition-all shadow-lg shadow-blue-500/20 disabled:shadow-none flex items-center justify-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),e.jsx("span",{children:u?"Enviando...":"Enviar CÃ³digo de Acceso"})]}),e.jsx("button",{type:"button",onClick:_,className:"w-full text-sm text-slate-400 hover:text-white transition-colors py-2 mt-2",children:"Â¿Ya tienes un cÃ³digo? IngrÃ©salo aquÃ­"})]}):e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg mb-4",children:e.jsx("p",{className:"text-sm text-blue-300 text-center",children:b||e.jsxs(e.Fragment,{children:["Ingresa el cÃ³digo enviado a ",e.jsx("strong",{children:l})]})})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"CÃ³digo de VerificaciÃ³n"}),e.jsx("input",{type:"text",value:h,onChange:r=>w(r.target.value.replace(/\D/g,"").slice(0,8)),placeholder:"123456",required:!0,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50 text-center text-2xl tracking-widest font-mono"})]}),e.jsxs("button",{type:"submit",disabled:u||h.length<6,className:"w-full bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 disabled:from-slate-700 disabled:to-slate-700 disabled:text-slate-500 text-white px-6 py-3 rounded-lg font-semibold transition-all shadow-lg shadow-green-500/20 disabled:shadow-none flex items-center justify-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),e.jsx("span",{children:u?"Validando...":"Verificar y Cambiar Password"})]}),e.jsx("button",{type:"button",onClick:()=>{x("email"),w(""),s("")},className:"w-full text-sm text-slate-400 hover:text-white transition-colors py-2",children:"Volver a ingresar email"})]}),e.jsx("button",{type:"button",onClick:()=>{m("login"),x("email"),s(""),n("")},className:"w-full text-sm text-slate-400 hover:text-white transition-colors py-2 border-t border-slate-700/50 mt-4",children:"Volver al Login"})]}):e.jsxs("form",{onSubmit:c==="login"?I:q,className:"space-y-4",children:[c==="signup"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Nombre Completo"}),e.jsx("input",{type:"text",value:y,onChange:r=>N(r.target.value),placeholder:"Tu nombre",required:c==="signup",className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Email Corporativo"}),e.jsx("input",{type:"email",value:l,onChange:r=>p(r.target.value),placeholder:"tu@empresa.com",required:!0,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"ContraseÃ±a"}),e.jsx("input",{type:"password",value:f,onChange:r=>j(r.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,minLength:6,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500/50"}),c==="signup"&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"MÃ­nimo 6 caracteres"}),c==="login"&&e.jsx("div",{className:"flex justify-end mt-1",children:e.jsx("button",{type:"button",onClick:()=>{m("forgot_password"),s(""),n("")},className:"text-xs text-blue-400 hover:text-blue-300 transition-colors",children:"Â¿Olvidaste tu contraseÃ±a?"})})]}),e.jsx("button",{type:"submit",disabled:u,className:"w-full bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 disabled:from-slate-700 disabled:to-slate-700 disabled:text-slate-500 text-white px-6 py-3 rounded-lg font-semibold transition-all shadow-lg shadow-blue-500/20 disabled:shadow-none",children:u?"Procesando...":c==="login"?"Iniciar SesiÃ³n":"Crear Cuenta"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("button",{onClick:P,className:"w-full bg-gradient-to-r from-slate-800 to-slate-700 hover:from-slate-700 hover:to-slate-600 border border-slate-600/50 text-white px-6 py-4 rounded-xl font-medium transition-all shadow-lg flex items-center justify-center gap-2 group",children:[e.jsx(E,{className:"w-5 h-5 text-blue-400 group-hover:text-blue-300"}),e.jsx("span",{children:"Entrar sin Login (Modo Demo)"})]}),e.jsx("p",{className:"text-xs text-slate-500 text-center mt-2",children:"Prueba la aplicaciÃ³n sin necesidad de crear cuenta"})]})]})})}export{F as InspectorAuth};
