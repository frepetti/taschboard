import{r as g,s as T,a as E,j as e,u as zt}from"./index-icditDDW.js";import{b as yt,a as qt}from"./api-DErTizCc.js";import{S as $e,T as te,A as Bt,U as qe,a as Ht,C as Xt,G as Gt}from"./users--eLVHCsQ.js";import{X,S as re,M as xe,P as oe,b as Ye,a as Me,C as Se}from"./x-TLHLM5qg.js";import{L as V,C as Re}from"./loader-2-DKWS8KVR.js";import{c as z}from"./createLucideIcon-B_1fxKTs.js";import{E as Wt,a as Le,C as Kt,R as Qt}from"./refresh-cw-DhxFsk2l.js";import{A as Be}from"./alert-circle-BHTX8deH.js";import{M as Zt}from"./mail-BwE_W4zE.js";const Jt=z("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);const et=z("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);const Yt=z("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]);const er=z("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);const tr=z("FileSpreadsheet",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M14 17h2",key:"10kma7"}]]);const wt=z("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);const ue=z("Map",[["polygon",{points:"3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21",key:"ok2ie8"}],["line",{x1:"9",x2:"9",y1:"3",y2:"18",key:"w34qz5"}],["line",{x1:"15",x2:"15",y1:"6",y2:"21",key:"volv9a"}]]);const Nt=z("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);const He=z("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);const St=z("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);const rr=z("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]);const tt=z("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);const Ct=z("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);const sr=z("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);function ar({clientId:t,clientName:r,onClose:s,embedded:a=!1}){const[n,o]=g.useState([]),[i,c]=g.useState([]),[h,y]=g.useState(!0),[v,m]=g.useState(""),[p,w]=g.useState(!1);g.useEffect(()=>{S()},[t]);const S=async()=>{y(!0);try{const{data:u,error:k}=await T.from("btl_clientes_venues").select(`
          id,
          venue:btl_puntos_venta (
            id,
            nombre,
            ciudad,
            direccion
          )
        `).eq("cliente_id",t);if(k)throw k;const{data:D,error:I}=await T.from("btl_puntos_venta").select("id, nombre, ciudad, direccion").order("nombre");if(I)throw I;const M=(u||[]).filter(O=>O.venue).map(O=>({id:O.id,venue:O.venue}));o(M);const j=new Set(M.map(O=>O.venue.id)),_=(D||[]).filter(O=>!j.has(O.id));c(_)}catch(u){console.error("Error loading client venues:",u),E.error("Error al cargar asignaciones")}finally{y(!1)}},b=async u=>{w(!0);try{const{error:k}=await T.from("btl_clientes_venues").insert({cliente_id:t,venue_id:u});if(k)throw k;E.success("Venue asignado correctamente"),S()}catch(k){console.error("Error assigning venue:",k),E.error("Error al asignar el venue")}finally{w(!1)}},f=async u=>{try{const{error:k}=await T.from("btl_clientes_venues").delete().eq("id",u);if(k)throw k;E.success("Asignaci√≥n eliminada"),S()}catch(k){console.error("Error unassigning venue:",k),E.error("Error al eliminar asignaci√≥n")}},N=i.filter(u=>u.nombre.toLowerCase().includes(v.toLowerCase())||u.ciudad?.toLowerCase().includes(v.toLowerCase())),d=e.jsxs("div",{className:`${a?"h-full border-0 shadow-none bg-transparent":"bg-slate-900 border border-slate-700 shadow-2xl max-h-[85vh]"} rounded-xl w-full flex flex-col overflow-hidden`,children:[!a&&e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-800 bg-slate-900",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl text-white font-bold flex items-center gap-2",children:[e.jsx($e,{className:"w-5 h-5 text-amber-500"}),"Asignar Venues"]}),e.jsxs("p",{className:"text-slate-400 text-sm mt-1",children:["Cliente: ",e.jsx("span",{className:"text-white font-medium",children:r})]})]}),e.jsx("button",{onClick:s,className:"text-slate-400 hover:text-white transition-colors",children:e.jsx(X,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:`flex-1 overflow-hidden flex flex-col md:flex-row ${a?"min-h-[400px]":""}`,children:[e.jsxs("div",{className:"flex-1 p-4 border-r border-slate-800 overflow-y-auto bg-slate-900/50",children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-300 mb-3 uppercase tracking-wider",children:["Disponibles (",N.length,")"]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),e.jsx("input",{type:"text",placeholder:"Buscar venue...",value:v,onChange:u=>m(u.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-lg pl-9 pr-3 py-2 text-sm text-white focus:outline-none focus:border-amber-500"})]}),e.jsx("div",{className:"space-y-2",children:h?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(V,{className:"w-6 h-6 text-amber-500 animate-spin"})}):N.length===0?e.jsx("p",{className:"text-slate-500 text-center text-sm py-4",children:"No hay venues disponibles con ese criterio."}):N.map(u=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/40 border border-slate-700/30 rounded-lg hover:border-amber-500/30 transition-colors group",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-slate-200 font-medium text-sm truncate",children:u.nombre}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-500",children:[e.jsx(xe,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:u.ciudad||"Sin ciudad"})]})]}),e.jsx("button",{onClick:()=>b(u.id),disabled:p,className:"p-1.5 bg-slate-700 text-slate-300 rounded hover:bg-amber-600 hover:text-white transition-colors",title:"Asignar",children:e.jsx(oe,{className:"w-4 h-4"})})]},u.id))})]}),e.jsxs("div",{className:"flex-1 p-4 overflow-y-auto bg-slate-950/30",children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-300 mb-3 uppercase tracking-wider",children:["Asignados (",n.length,")"]}),e.jsx("div",{className:"space-y-2",children:h?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(V,{className:"w-6 h-6 text-purple-500 animate-spin"})}):n.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-slate-800 rounded-xl",children:[e.jsx($e,{className:"w-8 h-8 text-slate-700 mx-auto mb-2"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Este cliente no tiene venues asignados."})]}):n.map(u=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-500/10 border border-purple-500/20 rounded-lg",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-purple-200 font-medium text-sm truncate",children:u.venue.nombre}),e.jsx("p",{className:"text-xs text-purple-300/60 truncate",children:u.venue.ciudad})]}),e.jsx("button",{onClick:()=>f(u.id),className:"p-1.5 hover:bg-red-500/20 rounded text-slate-400 hover:text-red-400 transition-colors",title:"Remover asignaci√≥n",children:e.jsx(te,{className:"w-4 h-4"})})]},u.id))})]})]}),!a&&e.jsx("div",{className:"p-4 border-t border-slate-800 bg-slate-900 flex justify-end",children:e.jsx("button",{onClick:s,className:"px-4 py-2 bg-slate-800 hover:bg-slate-700 text-white rounded-lg transition-colors text-sm font-medium",children:"Cerrar"})})]});return a?d:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4",children:e.jsx("div",{className:"w-full max-w-2xl",children:d})})}function se({isOpen:t,onClose:r,onConfirm:s,title:a,message:n,confirmText:o="Confirmar",cancelText:i="Cancelar",variant:c="danger"}){return t?e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-900 to-slate-950 border border-slate-700 shadow-2xl rounded-xl w-full max-w-md overflow-hidden animate-in fade-in zoom-in-95 duration-200",children:[e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center shrink-0 ${c==="danger"?"bg-red-500/20 text-red-500 border border-red-500/30":"bg-amber-500/20 text-amber-500 border border-amber-500/30"}`,children:e.jsx(Bt,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:a}),e.jsx("p",{className:"text-slate-400 text-sm leading-relaxed",children:n})]})]})}),e.jsxs("div",{className:"bg-slate-900/50 p-4 border-t border-slate-800 flex justify-end gap-3",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 rounded-lg text-slate-300 hover:text-white hover:bg-slate-800 transition-colors text-sm font-medium",children:i}),e.jsx("button",{onClick:()=>{s(),r()},className:`px-4 py-2 rounded-lg text-white text-sm font-medium shadow-lg transition-all hover:scale-105 ${c==="danger"?"bg-red-600 hover:bg-red-500 shadow-red-900/20":"bg-amber-600 hover:bg-amber-500 shadow-amber-900/20"}`,children:o})]})]})}):null}function nr({session:t,onUpdate:r}){const[s,a]=g.useState([]),[n,o]=g.useState(!0),[i,c]=g.useState(""),[h,y]=g.useState(!1),[v,m]=g.useState(!1),[p,w]=g.useState(null),[S,b]=g.useState(null),[f,N]=g.useState(null),[d,u]=g.useState({pending:!0,approved:!0,rejected:!0}),[k,D]=g.useState({admin:!0,inspector:!0,client:!0});g.useEffect(()=>{I()},[]);const I=async()=>{o(!0);try{console.log("üîç Loading users from btl_usuarios..."),console.log("üìù Current session:",t?.user?.id,t?.user?.email);const{data:C,error:x}=await T.from("btl_usuarios").select("*").order("created_at",{ascending:!1});if(x)throw console.error("‚ùå Error loading users:",x),x;console.log("üë• Users loaded:",C?.length||0),console.log("üìä Raw users data:",C);const A=(C||[]).map($=>({id:$.id,auth_id:$.usuario_id,name:$.nombre,email:$.email,role:$.rol,company:$.empresa,estado_aprobacion:$.estado_aprobacion||"approved",created_at:$.created_at}));console.log("‚úÖ Formatted users:",A),a(A)}catch(C){console.error("Error loading users:",C)}finally{o(!1)}},M=C=>{N(C)},j=async()=>{if(!f)return;const C=f,{data:{session:x},error:A}=await T.auth.getSession();if(A||!x){console.log("‚ùå Session invalid before delete operation"),E.error("Tu sesi√≥n ha expirado. Por favor inicia sesi√≥n nuevamente."),window.dispatchEvent(new Event("auth:unauthorized"));return}try{const $=C.auth_id||C.id;console.log("üóëÔ∏è Deleting user via API:",$);const F=await yt.deleteUser($,x.access_token);if(!F.success)throw new Error(F.error||"Error deleting user");await I(),r(),E.success("Usuario eliminado exitosamente")}catch($){if(console.error("‚ö†Ô∏è API Deletion failed:",$),$.message?.includes("Unauthorized"))return;console.error("‚ùå Deletion failed:",$),E.error("Error al eliminar usuario (API): "+$.message)}},_=s.filter(C=>{const x=C.name?.toLowerCase().includes(i.toLowerCase())||C.email?.toLowerCase().includes(i.toLowerCase())||C.role?.toLowerCase().includes(i.toLowerCase()),A=C.estado_aprobacion||"approved",$=d[A]!==!1,F=C.role||"inspector",J=k[F]!==!1;return console.log("User filter:",{name:C.name,estado:A,matchesSearch:x,matchesStatus:$,matchesRole:J,statusFilter:d}),x&&$&&J});console.log("Total users:",s.length),console.log("Filtered users:",_.length),console.log("Status filter:",d),console.log("Role filter:",k);const O=(C,x=!0)=>{if(!x)return"bg-transparent text-slate-500 border-slate-700 border hover:border-slate-500";switch(C){case"admin":return"bg-purple-500/20 text-purple-400 border-purple-500/30 border";case"inspector":return"bg-blue-500/20 text-blue-400 border-blue-500/30 border";case"client":return"bg-amber-500/20 text-amber-400 border-amber-500/30 border";default:return"bg-slate-500/20 text-slate-300 border-slate-500/30 border"}},l=C=>O(C,!0),P=(C,x=!0)=>{if(!x)return"bg-transparent text-slate-500 border-slate-700 border hover:border-slate-500";switch(C){case"pending":return"bg-amber-500/20 text-amber-300 border-amber-500/30 border";case"approved":return"bg-green-500/20 text-green-300 border-green-500/30 border";case"rejected":return"bg-red-500/20 text-red-300 border-red-500/30 border";default:return"bg-slate-500/20 text-slate-300 border-slate-500/30 border"}},R=C=>{switch(C){case"pending":return"Pendiente";case"approved":return"Aprobado";case"rejected":return"Rechazado";default:return C}},U=C=>P(C,!0);return n?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(V,{className:"w-12 h-12 text-purple-500 animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl text-white font-semibold",children:"Gesti√≥n de Usuarios"}),e.jsxs("p",{className:"text-slate-400 text-sm",children:["Total: ",s.length," usuarios"]})]}),e.jsxs("button",{onClick:()=>y(!0),className:"flex items-center gap-2 bg-purple-600 hover:bg-purple-500 text-white px-4 py-2.5 rounded-lg transition-colors",children:[e.jsx(sr,{className:"w-4 h-4"}),e.jsx("span",{children:"Nuevo Usuario"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por nombre, email o rol...",value:i,onChange:C=>c(C.target.value),className:"w-full bg-slate-800/50 border border-slate-700 text-white pl-10 pr-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-4 space-y-4 sm:space-y-0 sm:flex sm:items-start sm:gap-8",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("span",{className:"text-slate-300 text-sm font-medium",children:"Filtrar por estado:"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{onClick:()=>u({...d,approved:!d.approved}),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all ${P("approved",d.approved)}`,children:"Aprobados"}),e.jsx("button",{onClick:()=>u({...d,pending:!d.pending}),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all ${P("pending",d.pending)}`,children:"Pendientes"}),e.jsx("button",{onClick:()=>u({...d,rejected:!d.rejected}),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all ${P("rejected",d.rejected)}`,children:"Rechazados"})]})]}),e.jsx("div",{className:"hidden sm:block w-px h-16 bg-slate-700/50"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("span",{className:"text-slate-300 text-sm font-medium",children:"Filtrar por rol:"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{onClick:()=>D({...k,admin:!k.admin}),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all ${O("admin",k.admin)}`,children:"Admin"}),e.jsx("button",{onClick:()=>D({...k,client:!k.client}),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all ${O("client",k.client)}`,children:"Cliente"}),e.jsx("button",{onClick:()=>D({...k,inspector:!k.inspector}),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all ${O("inspector",k.inspector)}`,children:"Inspector"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl shadow-xl overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-700/50",children:[e.jsx("th",{className:"text-left text-xs uppercase tracking-wider text-slate-400 p-4",children:"Usuario"}),e.jsx("th",{className:"text-left text-xs uppercase tracking-wider text-slate-400 p-4",children:"Email"}),e.jsx("th",{className:"text-left text-xs uppercase tracking-wider text-slate-400 p-4",children:"Rol"}),e.jsx("th",{className:"text-left text-xs uppercase tracking-wider text-slate-400 p-4",children:"Estado"}),e.jsx("th",{className:"text-left text-xs uppercase tracking-wider text-slate-400 p-4",children:"Empresa"}),e.jsx("th",{className:"text-left text-xs uppercase tracking-wider text-slate-400 p-4",children:"Creado"}),e.jsx("th",{className:"text-right text-xs uppercase tracking-wider text-slate-400 p-4",children:"Acciones"})]})}),e.jsx("tbody",{children:_.map(C=>e.jsxs("tr",{className:"border-b border-slate-700/30 hover:bg-slate-800/30 cursor-pointer transition-colors",onClick:()=>w(C),children:[e.jsx("td",{className:"p-4",children:e.jsx("div",{className:"text-white font-medium",children:C.name})}),e.jsx("td",{className:"p-4 text-slate-300",children:C.email}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${l(C.role)}`,children:C.role==="admin"?"Admin":C.role==="inspector"?"Inspector":"Cliente"})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${U(C.estado_aprobacion)}`,children:R(C.estado_aprobacion)})}),e.jsx("td",{className:"p-4 text-slate-300",children:C.company||"-"}),e.jsx("td",{className:"p-4 text-slate-400 text-sm",children:new Date(C.created_at).toLocaleDateString()}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",onClick:x=>x.stopPropagation(),children:[e.jsx("button",{onClick:x=>{x.stopPropagation(),b(C),m(!0)},className:"p-2 hover:bg-slate-700 rounded-lg text-slate-400 hover:text-amber-400 transition-colors",title:"Gestionar Contrase√±a",children:e.jsx(wt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:x=>{x.stopPropagation(),w(C)},className:"p-2 hover:bg-slate-700 rounded-lg text-slate-400 hover:text-white transition-colors",title:"Editar",children:e.jsx(Nt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:x=>{x.stopPropagation(),M(C)},className:"p-2 hover:bg-red-600/20 rounded-lg text-red-400 transition-colors",title:"Eliminar",children:e.jsx(te,{className:"w-4 h-4"})})]})})]},C.id))})]})}),_.length===0&&e.jsx("div",{className:"text-center py-12 text-slate-400",children:"No se encontraron usuarios"})]}),h&&e.jsx(ir,{session:t,onClose:()=>y(!1),onSuccess:()=>{I(),r(),y(!1)}}),v&&S&&e.jsx(lr,{user:S,currentUser:t?.user,onClose:()=>{m(!1),b(null)}}),e.jsx(se,{isOpen:!!f,onClose:()=>N(null),onConfirm:j,title:"Eliminar Usuario",message:`¬øEst√°s seguro de que deseas eliminar al usuario ${f?.email}? Esta acci√≥n no se puede deshacer.`,confirmText:"Eliminar Usuario",variant:"danger"}),p&&e.jsx(or,{user:p,onClose:()=>w(null),onSuccess:()=>{I(),r(),w(null)}})]})}function lr({user:t,currentUser:r,onClose:s}){const[a,n]=g.useState(!1),[o,i]=g.useState(""),[c,h]=g.useState(!1),y=r?.email===t.email,v=async()=>{n(!0);try{const{error:p}=await T.auth.signInWithOtp({email:t.email,options:{shouldCreateUser:!1}});if(p)throw p;E.success(`C√≥digo de acceso enviado a ${t.email}`),s()}catch(p){if(console.error("Error sending reset code:",p),p.message?.includes("security purposes")||p.status===429){const w=p.message.match(/after (\d+) seconds/),S=w?w[1]:"unos";E.error(`Por seguridad, debes esperar ${S} segundos antes de solicitar otro c√≥digo.`)}else E.error("Error al enviar c√≥digo: "+p.message)}finally{n(!1)}},m=async p=>{if(p.preventDefault(),o.length<6){E.error("La contrase√±a debe tener al menos 6 caracteres");return}n(!0);try{if(y){const{error:w}=await T.auth.updateUser({password:o});if(w)throw w;E.success("Tu contrase√±a ha sido actualizada correctamente"),s()}else{const{data:{session:w}}=await T.auth.getSession();if(!w)throw new Error("No hay sesi√≥n activa");const S=t.auth_id||t.id,b=await yt.updateUser(S,{password:o},w.access_token);if(!b.success)throw new Error(b.error||"Error al actualizar contrase√±a");E.success(`Contrase√±a actualizada para ${t.email}`),s()}}catch(w){console.error("Error updating password:",w),E.error(w.message)}finally{n(!1)}};return e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-900 to-slate-950 border border-slate-700 shadow-2xl rounded-xl w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"p-5 border-b border-slate-800 bg-slate-900/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-amber-500/20 flex items-center justify-center border border-amber-500/30",children:e.jsx(wt,{className:"w-5 h-5 text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg text-white font-bold",children:"Seguridad de Usuario"}),e.jsx("p",{className:"text-slate-400 text-xs truncate max-w-[200px]",children:t.email}),y&&e.jsx("span",{className:"text-[10px] bg-purple-500/20 text-purple-300 px-1.5 py-0.5 rounded border border-purple-500/30",children:"Usuario Actual"})]})]}),e.jsx("button",{onClick:s,className:"text-slate-400 hover:text-white transition-colors",children:e.jsx(X,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-slate-800/30 rounded-lg p-4 border border-slate-700/50 hover:border-purple-500/30 transition-colors",children:[e.jsxs("h4",{className:"text-white font-medium mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-400"}),"Enviar C√≥digo de Acceso (OTP)"]}),e.jsx("p",{className:"text-sm text-slate-400 mb-4",children:'El usuario recibir√° un c√≥digo num√©rico para acceder. Debe usarlo en la opci√≥n "Olvid√© mi contrase√±a" de la pantalla de login.'}),e.jsx("button",{onClick:v,disabled:a,className:"w-full py-2.5 bg-purple-600 hover:bg-purple-500 disabled:bg-slate-700 disabled:text-slate-500 text-white rounded-lg transition-colors font-medium flex items-center justify-center gap-2",children:a?e.jsx(V,{className:"w-4 h-4 animate-spin"}):"Enviar C√≥digo OTP"})]}),e.jsxs("div",{className:"relative flex items-center gap-2 py-2",children:[e.jsx("div",{className:"h-px bg-slate-800 flex-1"}),e.jsx("span",{className:"text-xs text-slate-600 font-medium uppercase",children:"Opciones Avanzadas"}),e.jsx("div",{className:"h-px bg-slate-800 flex-1"})]}),e.jsx("div",{className:`transition-all duration-300 ${c?"opacity-100":"opacity-80"}`,children:c?e.jsxs("form",{onSubmit:m,className:"space-y-3 bg-slate-800/20 p-4 rounded-lg border border-slate-700/50",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-1.5",children:"Nueva Contrase√±a"}),e.jsx("input",{type:"text",value:o,onChange:p=>i(p.target.value),placeholder:"M√≠nimo 6 caracteres",className:"w-full bg-slate-900 border border-slate-700 text-white px-3 py-2 rounded focus:outline-none focus:border-amber-500 text-sm"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>h(!1),className:"flex-1 py-2 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded text-sm transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:a||o.length<6,className:"flex-1 py-2 bg-amber-600/80 hover:bg-amber-500 text-white rounded text-sm transition-colors font-medium",children:a?"Procesando...":"Cambiar"})]}),!y&&e.jsxs("p",{className:"text-[10px] text-red-400 flex items-start gap-1 mt-2 bg-red-500/10 p-2 rounded border border-red-500/20",children:[e.jsx($e,{className:"w-3 h-3 mt-0.5 shrink-0"}),e.jsx("span",{children:"Nota: Solo el propio usuario puede cambiar su contrase√±a directamente desde aqu√≠. Para otros usuarios, usa el correo de recuperaci√≥n."})]})]}):e.jsx("button",{onClick:()=>h(!0),className:"w-full py-2 border border-slate-700 text-slate-400 hover:text-slate-200 hover:border-slate-500 rounded-lg text-sm transition-colors",children:"Establecer contrase√±a manualmente"})})]})]})})}function or({user:t,onClose:r,onSuccess:s}){const[a,n]=g.useState(t.name||""),[o,i]=g.useState(t.role||"inspector"),[c,h]=g.useState(t.company||""),[y,v]=g.useState(t.estado_aprobacion||"approved"),[m,p]=g.useState(!1),[w,S]=g.useState("profile"),b=async f=>{f.preventDefault(),p(!0);try{const{error:N}=await T.from("btl_usuarios").update({nombre:a,rol:o,empresa:o==="client"?c:null,estado_aprobacion:y}).eq("id",t.id);if(N)throw N;E.success("Usuario actualizado correctamente"),s()}catch(N){console.error("Error updating user:",N),E.error("Error al actualizar usuario")}finally{p(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-900 to-slate-950 border border-slate-700 shadow-2xl rounded-xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-slate-800 flex items-center justify-between bg-slate-900/50",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl text-white font-bold",children:"Editar Usuario"}),e.jsx("p",{className:"text-slate-400 text-sm mt-1",children:t.email})]}),e.jsx("button",{onClick:r,className:"text-slate-400 hover:text-white transition-colors",children:e.jsx(X,{className:"w-5 h-5"})})]}),o==="client"&&e.jsxs("div",{className:"flex border-b border-slate-800 px-6",children:[e.jsx("button",{onClick:()=>S("profile"),className:`py-3 px-4 text-sm font-medium border-b-2 transition-colors ${w==="profile"?"border-purple-500 text-purple-400":"border-transparent text-slate-400 hover:text-slate-200"}`,children:"Perfil"}),e.jsx("button",{onClick:()=>S("venues"),className:`py-3 px-4 text-sm font-medium border-b-2 transition-colors ${w==="venues"?"border-amber-500 text-amber-400":"border-transparent text-slate-400 hover:text-slate-200"}`,children:"Asignar Venues"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:w==="profile"?e.jsx("form",{id:"edit-user-form",onSubmit:b,className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Nombre"}),e.jsx("input",{type:"text",value:a,onChange:f=>n(f.target.value),className:"w-full bg-slate-800/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:border-purple-500 transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Email (Solo lectura)"}),e.jsx("input",{type:"text",value:t.email,disabled:!0,className:"w-full bg-slate-900/50 border border-slate-800 text-slate-500 px-4 py-2.5 rounded-lg cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Rol"}),e.jsxs("select",{value:o,onChange:f=>i(f.target.value),className:"w-full bg-slate-800/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:border-purple-500 transition-colors",children:[e.jsx("option",{value:"inspector",children:"Inspector"}),e.jsx("option",{value:"client",children:"Cliente"}),e.jsx("option",{value:"admin",children:"Administrador"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Estado"}),e.jsxs("select",{value:y,onChange:f=>v(f.target.value),className:"w-full bg-slate-800/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:border-purple-500 transition-colors",children:[e.jsx("option",{value:"pending",children:"Pendiente"}),e.jsx("option",{value:"approved",children:"Aprobado"}),e.jsx("option",{value:"rejected",children:"Rechazado"})]})]}),o==="client"&&e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Empresa"}),e.jsx("input",{type:"text",value:c,onChange:f=>h(f.target.value),className:"w-full bg-slate-800/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:border-purple-500 transition-colors"})]})]})}):e.jsx("div",{className:"h-full min-h-[400px]",children:e.jsx(ar,{clientId:t.id,clientName:t.name,embedded:!0})})}),e.jsxs("div",{className:"p-4 border-t border-slate-800 bg-slate-900/50 flex justify-end gap-3",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 bg-slate-800 hover:bg-slate-700 text-slate-200 rounded-lg transition-colors font-medium",children:"Cancelar"}),w==="profile"&&e.jsxs("button",{type:"submit",form:"edit-user-form",disabled:m,className:"px-6 py-2 bg-purple-600 hover:bg-purple-500 disabled:bg-slate-700 disabled:text-slate-500 text-white rounded-lg transition-colors font-medium flex items-center gap-2",children:[m&&e.jsx(V,{className:"w-4 h-4 animate-spin"}),"Guardar Cambios"]}),w==="venues"&&e.jsx("button",{onClick:()=>S("profile"),className:"px-6 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg transition-colors font-medium",children:"Volver al Perfil"})]})]})})}function ir({session:t,onClose:r,onSuccess:s}){const[a,n]=g.useState(""),[o,i]=g.useState(""),[c,h]=g.useState(""),[y,v]=g.useState("inspector"),[m,p]=g.useState(""),[w,S]=g.useState(!1),b=async f=>{f.preventDefault(),S(!0);try{await qt.signup(a,o,c,y,m||void 0),E.success("Usuario creado exitosamente"),s()}catch(N){E.error(`Error: ${N.message}`),S(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/90 to-slate-900/90 backdrop-blur-sm border border-slate-700/50 rounded-xl shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"p-6 border-b border-slate-700/50 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl text-white font-semibold",children:"Nuevo Usuario"}),e.jsx("button",{onClick:r,className:"text-slate-400 hover:text-white",children:e.jsx(X,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:b,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Nombre"}),e.jsx("input",{type:"text",value:c,onChange:f=>h(f.target.value),required:!0,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:a,onChange:f=>n(f.target.value),required:!0,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Contrase√±a"}),e.jsx("input",{type:"password",value:o,onChange:f=>i(f.target.value),required:!0,minLength:6,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Rol"}),e.jsxs("select",{value:y,onChange:f=>v(f.target.value),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg",children:[e.jsx("option",{value:"inspector",children:"Inspector"}),e.jsx("option",{value:"client",children:"Cliente"}),e.jsx("option",{value:"admin",children:"Administrador"})]})]}),y==="client"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Empresa"}),e.jsx("input",{type:"text",value:m,onChange:f=>p(f.target.value),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:r,className:"flex-1 bg-slate-700/50 hover:bg-slate-700 text-white px-4 py-2.5 rounded-lg",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:w,className:"flex-1 bg-purple-600 hover:bg-purple-500 disabled:bg-slate-700 text-white px-4 py-2.5 rounded-lg",children:w?"Creando...":"Crear Usuario"})]})]})]})})}function cr({session:t,onUpdate:r,initialTicketId:s}){const{t:a}=zt(),[n,o]=g.useState([]),[i,c]=g.useState(!0),[h,y]=g.useState(""),[v,m]=g.useState("all"),[p,w]=g.useState(null);g.useEffect(()=>{S()},[]),g.useEffect(()=>{if(s&&n.length>0){const u=n.find(k=>k.id===s);u&&w(u)}},[s,n]);const S=async()=>{c(!0);try{const{data:u,error:k}=await T.from("btl_reportes").select(`
          *,
          btl_usuarios!btl_reportes_creado_por_fkey (
            id,
            nombre,
            email,
            empresa
          )
        `).order("created_at",{ascending:!1});if(k)throw k;const D=(u||[]).map(I=>({id:I.id,subject:I.asunto||I.titulo,description:I.descripcion,category:I.categoria||I.tipo,priority:I.prioridad,status:I.estado,type:I.tipo,user_id:I.creado_por,user_name:I.btl_usuarios?.nombre,user_email:I.btl_usuarios?.email,company:I.btl_usuarios?.empresa,created_at:I.created_at,updated_at:I.updated_at,metadata:I.metadata}));o(D)}catch(u){console.error("Error loading tickets:",u)}finally{c(!1)}},b=async(u,k)=>{try{const{error:D}=await T.from("btl_reportes").update({estado:k}).eq("id",u);if(D)throw D;await S(),w(null),r(),E.success(a("tickets.success_update"))}catch(D){console.error("Error updating ticket:",D),E.error(a("common.error"))}},f=n.filter(u=>{const k=u.subject?.toLowerCase().includes(h.toLowerCase())||u.user_name?.toLowerCase().includes(h.toLowerCase())||u.company?.toLowerCase().includes(h.toLowerCase()),D=v==="all"||u.status===v;return k&&D}),N=u=>["high","alta"].includes(u)?a("tickets.prio_high"):["urgent","critica"].includes(u)?a("tickets.prio_critical"):["medium","media"].includes(u)?a("tickets.prio_medium"):a("tickets.prio_low"),d=u=>{switch(u){case"abierto":return a("tickets.status_open");case"en_progreso":return a("tickets.status_progress");case"resuelto":return a("tickets.status_resolved");case"cerrado":return a("tickets.status_closed");default:return u}};return i?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(V,{className:"w-12 h-12 text-purple-500 animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl text-white font-semibold",children:a("tickets.title")}),e.jsxs("p",{className:"text-slate-400 text-sm",children:[a("common.total"),": ",n.length," ",a("tickets.ticket").toLowerCase(),"s"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:a("common.search"),value:h,onChange:u=>y(u.target.value),className:"w-full bg-slate-800/50 border border-slate-700 text-white pl-10 pr-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50"})]}),e.jsxs("select",{value:v,onChange:u=>m(u.target.value),className:"bg-slate-800/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50",children:[e.jsx("option",{value:"all",children:a("common.filter_all")}),e.jsx("option",{value:"abierto",children:a("tickets.status_open")}),e.jsx("option",{value:"en_progreso",children:a("tickets.status_progress")}),e.jsx("option",{value:"resuelto",children:a("tickets.status_resolved")}),e.jsx("option",{value:"cerrado",children:a("tickets.status_closed")})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:f.map(u=>e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6 shadow-xl hover:border-slate-600/50 transition-all cursor-pointer",onClick:()=>w(u),children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${u.type==="ticket"?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"bg-purple-500/20 text-purple-400 border border-purple-500/30"}`,children:u.type==="ticket"?"üé´ "+a("tickets.ticket"):"üìã "+a("tickets.request")}),e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${["high","alta","critica","urgent"].includes(u.priority)?"bg-red-500/20 text-red-400 border border-red-500/30":["medium","media"].includes(u.priority)?"bg-amber-500/20 text-amber-400 border border-amber-500/30":"bg-green-500/20 text-green-400 border border-green-500/30"}`,children:[["high","alta"].includes(u.priority)?"üü† ":["critica","urgent"].includes(u.priority)?"üî¥ ":["medium","media"].includes(u.priority)?"üü° ":"üü¢ ",N(u.priority)]})]}),e.jsx("h3",{className:"text-lg text-white font-semibold mb-1",children:u.subject}),e.jsx("p",{className:"text-sm text-slate-400 line-clamp-2",children:u.description})]})}),e.jsxs("div",{className:"flex items-center gap-4 mb-4 pb-4 border-b border-slate-700/50",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:a("common.user")}),e.jsx("div",{className:"text-sm text-slate-300",children:u.user_name})]}),u.company&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:a("common.company")}),e.jsx("div",{className:"text-sm text-slate-300",children:u.company})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-slate-500",children:new Date(u.created_at).toLocaleDateString()}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${u.status==="abierto"?"bg-red-500/20 text-red-400 border border-red-500/30":u.status==="en_progreso"?"bg-amber-500/20 text-amber-400 border border-amber-500/30":u.status==="resuelto"?"bg-green-500/20 text-green-400 border border-green-500/30":"bg-slate-500/20 text-slate-400 border border-slate-500/30"}`,children:d(u.status)})]})]},u.id))}),f.length===0&&e.jsx("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-12 shadow-xl text-center",children:e.jsx("p",{className:"text-slate-400",children:a("common.no_data")})}),p&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/90 to-slate-900/90 backdrop-blur-sm border border-slate-700/50 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-slate-900/50 backdrop-blur-sm border-b border-slate-700/50 p-6",children:e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl text-white font-semibold mb-2",children:p.subject}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${p.type==="ticket"?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"bg-purple-500/20 text-purple-400 border border-purple-500/30"}`,children:p.type==="ticket"?a("tickets.ticket"):a("tickets.request")}),e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${["high","alta","critica","urgent"].includes(p.priority)?"bg-red-500/20 text-red-400 border border-red-500/30":["medium","media"].includes(p.priority)?"bg-amber-500/20 text-amber-400 border border-amber-500/30":"bg-green-500/20 text-green-400 border border-green-500/30"}`,children:[a("tickets.priority"),": ",N(p.priority)]})]})]}),e.jsx("button",{onClick:()=>w(null),className:"text-slate-400 hover:text-white",children:e.jsx(Ye,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm uppercase tracking-wider text-slate-400 mb-2",children:a("tickets.description")}),e.jsx("p",{className:"text-slate-300 whitespace-pre-wrap",children:p.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm uppercase tracking-wider text-slate-400 mb-2",children:a("common.user")}),e.jsx("p",{className:"text-white",children:p.user_name}),e.jsx("p",{className:"text-sm text-slate-400",children:p.user_email})]}),p.company&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm uppercase tracking-wider text-slate-400 mb-2",children:a("common.company")}),e.jsx("p",{className:"text-white",children:p.company})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm uppercase tracking-wider text-slate-400 mb-2",children:a("tickets.created_at")}),e.jsx("p",{className:"text-slate-300",children:new Date(p.created_at).toLocaleString()})]}),p.updated_at&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm uppercase tracking-wider text-slate-400 mb-2",children:a("tickets.updated_at")}),e.jsx("p",{className:"text-slate-300",children:new Date(p.updated_at).toLocaleString()})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm uppercase tracking-wider text-slate-400 mb-3",children:a("tickets.change_status")}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[{status:"abierto",label:a("tickets.status_open"),icon:Wt,color:"red"},{status:"en_progreso",label:a("tickets.status_progress"),icon:Le,color:"amber"},{status:"resuelto",label:a("tickets.status_resolved"),icon:Re,color:"green"},{status:"cerrado",label:a("tickets.status_closed"),icon:Ye,color:"slate"}].map(u=>{const k=u.icon,D=p.status===u.status;return e.jsxs("button",{onClick:()=>b(p.id,u.status),className:`flex flex-col items-center gap-2 p-3 rounded-lg border transition-all ${D?`bg-${u.color}-500/20 border-${u.color}-500/50 text-${u.color}-400`:"bg-slate-800/50 border-slate-700/50 text-slate-400 hover:bg-slate-800 hover:border-slate-600"}`,children:[e.jsx(k,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium",children:u.label})]},u.status)})})]})]})]})})]})}function dr({stats:t}){const r=[{label:"Total Usuarios",value:t?.totalUsers||0,icon:qe,color:"blue",detail:`${t?.usersByRole?.inspector||0} Inspectores, ${t?.usersByRole?.client||0} Clientes, ${t?.usersByRole?.admin||0} Admins`},{label:"Total Venues",value:t?.totalVenues||0,icon:xe,color:"purple",detail:"Puntos de venta registrados"},{label:"Total Inspecciones",value:t?.totalInspections||0,icon:Kt,color:"green",detail:"Registradas en el sistema"},{label:"Tickets Abiertos",value:t?.openTickets||0,icon:Be,color:"red",detail:`${t?.totalTickets||0} totales`}],s={blue:{bg:"bg-blue-600/20",text:"text-blue-400",border:"border-blue-500/30"},green:{bg:"bg-green-600/20",text:"text-green-400",border:"border-green-500/30"},amber:{bg:"bg-amber-600/20",text:"text-amber-400",border:"border-amber-500/30"},red:{bg:"bg-red-600/20",text:"text-red-400",border:"border-red-500/30"},purple:{bg:"bg-purple-600/20",text:"text-purple-400",border:"border-purple-500/30"}};return e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:r.map((a,n)=>{const o=s[a.color],i=a.icon;return e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6 shadow-xl",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsx("div",{className:`w-12 h-12 rounded-lg ${o.bg} flex items-center justify-center`,children:e.jsx(i,{className:`w-6 h-6 ${o.text}`})})}),e.jsx("div",{className:"text-3xl text-white font-bold mb-1",children:a.value}),e.jsx("div",{className:"text-sm text-slate-400 mb-2",children:a.label}),e.jsx("div",{className:`text-xs ${o.text}`,children:a.detail})]},n)})}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6 shadow-xl",children:[e.jsx("h3",{className:"text-lg text-white font-semibold mb-6",children:"Distribuci√≥n de Usuarios por Rol"}),e.jsx("div",{className:"space-y-4",children:[{role:"inspector",label:"Inspectores",count:t?.usersByRole?.inspector||0,color:"blue"},{role:"client",label:"Clientes",count:t?.usersByRole?.client||0,color:"amber"},{role:"admin",label:"Administradores",count:t?.usersByRole?.admin||0,color:"purple"}].map(a=>{const n=t?.totalUsers>0?Math.round(a.count/t.totalUsers*100):0,o=s[a.color];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-slate-300 text-sm",children:a.label}),e.jsxs("span",{className:`text-sm font-semibold ${o.text}`,children:[a.count," (",n,"%)"]})]}),e.jsx("div",{className:"w-full bg-slate-800 rounded-full h-2",children:e.jsx("div",{className:`${o.bg} h-2 rounded-full transition-all`,style:{width:`${n}%`}})})]},a.role)})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6 shadow-xl",children:[e.jsx("h3",{className:"text-lg text-white font-semibold mb-6",children:"Estado de Tickets"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[{status:"open",label:"Abiertos",count:t?.ticketsByStatus?.open||0,color:"red"},{status:"in-progress",label:"En Progreso",count:t?.ticketsByStatus?.["in-progress"]||0,color:"amber"},{status:"resolved",label:"Resueltos",count:t?.ticketsByStatus?.resolved||0,color:"green"}].map(a=>{const n=s[a.color];return e.jsxs("div",{className:`p-4 rounded-lg border ${n.border} ${n.bg}`,children:[e.jsx("div",{className:"text-sm text-slate-400 mb-1",children:a.label}),e.jsx("div",{className:`text-2xl font-bold ${n.text}`,children:a.count})]},a.status)})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6 shadow-xl",children:[e.jsx("h3",{className:"text-lg text-white font-semibold mb-4",children:"Informaci√≥n del Sistema"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Versi√≥n:"}),e.jsx("span",{className:"ml-2 text-white",children:"1.0.0"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"√öltima actualizaci√≥n:"}),e.jsx("span",{className:"ml-2 text-white",children:"Enero 2026"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Base de datos:"}),e.jsx("span",{className:"ml-2 text-white",children:"Supabase PostgreSQL"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Estado:"}),e.jsx("span",{className:"ml-2 text-green-400",children:"‚óè Operativo"})]})]})]})]})}const ur={createDocument:function(r){return new DOMParser().parseFromString(r.trim(),"text/xml")}};var q=Uint8Array,ne=Uint16Array,mr=Int32Array,kt=new q([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_t=new q([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),xr=new q([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Et=function(t,r){for(var s=new ne(31),a=0;a<31;++a)s[a]=r+=1<<t[a-1];for(var n=new mr(s[30]),a=1;a<30;++a)for(var o=s[a];o<s[a+1];++o)n[o]=o-s[a]<<5|a;return{b:s,r:n}},Pt=Et(kt,2),At=Pt.b,pr=Pt.r;At[28]=258,pr[258]=28;var hr=Et(_t,0),br=hr.b,Fe=new ne(32768);for(var L=0;L<32768;++L){var Y=(L&43690)>>1|(L&21845)<<1;Y=(Y&52428)>>2|(Y&13107)<<2,Y=(Y&61680)>>4|(Y&3855)<<4,Fe[L]=((Y&65280)>>8|(Y&255)<<8)>>1}var me=(function(t,r,s){for(var a=t.length,n=0,o=new ne(r);n<a;++n)t[n]&&++o[t[n]-1];var i=new ne(r);for(n=1;n<r;++n)i[n]=i[n-1]+o[n-1]<<1;var c;if(s){c=new ne(1<<r);var h=15-r;for(n=0;n<a;++n)if(t[n])for(var y=n<<4|t[n],v=r-t[n],m=i[t[n]-1]++<<v,p=m|(1<<v)-1;m<=p;++m)c[Fe[m]>>h]=y}else for(c=new ne(a),n=0;n<a;++n)t[n]&&(c[n]=Fe[i[t[n]-1]++]>>15-t[n]);return c}),ve=new q(288);for(var L=0;L<144;++L)ve[L]=8;for(var L=144;L<256;++L)ve[L]=9;for(var L=256;L<280;++L)ve[L]=7;for(var L=280;L<288;++L)ve[L]=8;var Ot=new q(32);for(var L=0;L<32;++L)Ot[L]=5;var fr=me(ve,9,1),gr=me(Ot,5,1),_e=function(t){for(var r=t[0],s=1;s<t.length;++s)t[s]>r&&(r=t[s]);return r},W=function(t,r,s){var a=r/8|0;return(t[a]|t[a+1]<<8)>>(r&7)&s},Ee=function(t,r){var s=r/8|0;return(t[s]|t[s+1]<<8|t[s+2]<<16)>>(r&7)},vr=function(t){return(t+7)/8|0},Xe=function(t,r,s){return(r==null||r<0)&&(r=0),(s==null||s>t.length)&&(s=t.length),new q(t.subarray(r,s))},jr=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],H=function(t,r,s){var a=new Error(r||jr[t]);if(a.code=t,Error.captureStackTrace&&Error.captureStackTrace(a,H),!s)throw a;return a},yr=function(t,r,s,a){var n=t.length,o=a?a.length:0;if(!n||r.f&&!r.l)return s||new q(0);var i=!s,c=i||r.i!=2,h=r.i;i&&(s=new q(n*3));var y=function(Qe){var Ze=s.length;if(Qe>Ze){var Je=new q(Math.max(Ze*2,Qe));Je.set(s),s=Je}},v=r.f||0,m=r.p||0,p=r.b||0,w=r.l,S=r.d,b=r.m,f=r.n,N=n*8;do{if(!w){v=W(t,m,1);var d=W(t,m+1,3);if(m+=3,d)if(d==1)w=fr,S=gr,b=9,f=5;else if(d==2){var I=W(t,m,31)+257,M=W(t,m+10,15)+4,j=I+W(t,m+5,31)+1;m+=14;for(var _=new q(j),O=new q(19),l=0;l<M;++l)O[xr[l]]=W(t,m+l*3,7);m+=M*3;for(var P=_e(O),R=(1<<P)-1,U=me(O,P,1),l=0;l<j;){var C=U[W(t,m,R)];m+=C&15;var u=C>>4;if(u<16)_[l++]=u;else{var x=0,A=0;for(u==16?(A=3+W(t,m,3),m+=2,x=_[l-1]):u==17?(A=3+W(t,m,7),m+=3):u==18&&(A=11+W(t,m,127),m+=7);A--;)_[l++]=x}}var $=_.subarray(0,I),F=_.subarray(I);b=_e($),f=_e(F),w=me($,b,1),S=me(F,f,1)}else H(1);else{var u=vr(m)+4,k=t[u-4]|t[u-3]<<8,D=u+k;if(D>n){h&&H(0);break}c&&y(p+k),s.set(t.subarray(u,D),p),r.b=p+=k,r.p=m=D*8,r.f=v;continue}if(m>N){h&&H(0);break}}c&&y(p+131072);for(var J=(1<<b)-1,ie=(1<<f)-1,ae=m;;ae=m){var x=w[Ee(t,m)&J],G=x>>4;if(m+=x&15,m>N){h&&H(0);break}if(x||H(2),G<256)s[p++]=G;else if(G==256){ae=m,w=null;break}else{var Ge=G-254;if(G>264){var l=G-257,ce=kt[l];Ge=W(t,m,(1<<ce)-1)+At[l],m+=ce}var Ce=S[Ee(t,m)&ie],ke=Ce>>4;Ce||H(3),m+=Ce&15;var F=br[ke];if(ke>3){var ce=_t[ke];F+=Ee(t,m)&(1<<ce)-1,m+=ce}if(m>N){h&&H(0);break}c&&y(p+131072);var We=p+Ge;if(p<F){var Ke=o-F,Vt=Math.min(F,We);for(Ke+p<0&&H(3);p<Vt;++p)s[p]=a[Ke+p]}for(;p<We;++p)s[p]=s[p-F]}}r.l=w,r.p=ae,r.b=p,r.f=v,w&&(v=1,r.m=b,r.d=S,r.n=f)}while(!v);return p!=s.length&&i?Xe(s,0,p):s.subarray(0,p)},wr=new q(0),Q=function(t,r){return t[r]|t[r+1]<<8},K=function(t,r){return(t[r]|t[r+1]<<8|t[r+2]<<16|t[r+3]<<24)>>>0},Pe=function(t,r){return K(t,r)+K(t,r+4)*4294967296};function Nr(t,r){return yr(t,{i:2},r&&r.out,r&&r.dictionary)}var Ue=typeof TextDecoder<"u"&&new TextDecoder,Sr=0;try{Ue.decode(wr,{stream:!0}),Sr=1}catch{}var Cr=function(t){for(var r="",s=0;;){var a=t[s++],n=(a>127)+(a>223)+(a>239);if(s+n>t.length)return{s:r,r:Xe(t,s-1)};n?n==3?(a=((a&15)<<18|(t[s++]&63)<<12|(t[s++]&63)<<6|t[s++]&63)-65536,r+=String.fromCharCode(55296|a>>10,56320|a&1023)):n&1?r+=String.fromCharCode((a&31)<<6|t[s++]&63):r+=String.fromCharCode((a&15)<<12|(t[s++]&63)<<6|t[s++]&63):r+=String.fromCharCode(a)}};function Tt(t,r){if(r){for(var s="",a=0;a<t.length;a+=16384)s+=String.fromCharCode.apply(null,t.subarray(a,a+16384));return s}else{if(Ue)return Ue.decode(t);var n=Cr(t),o=n.s,s=n.r;return s.length&&H(8),o}}var kr=function(t,r){return r+30+Q(t,r+26)+Q(t,r+28)},_r=function(t,r,s){var a=Q(t,r+28),n=Tt(t.subarray(r+46,r+46+a),!(Q(t,r+8)&2048)),o=r+46+a,i=K(t,r+20),c=s&&i==4294967295?Er(t,o):[i,K(t,r+24),K(t,r+42)],h=c[0],y=c[1],v=c[2];return[Q(t,r+10),h,y,n,o+Q(t,r+30)+Q(t,r+32),v]},Er=function(t,r){for(;Q(t,r)!=1;r+=4+Q(t,r+2));return[Pe(t,r+12),Pe(t,r+4),Pe(t,r+20)]};function Pr(t,r){for(var s={},a=t.length-22;K(t,a)!=101010256;--a)(!a||t.length-a>65558)&&H(13);var n=Q(t,a+8);if(!n)return{};var o=K(t,a+16),i=o==4294967295||n==65535;if(i){var c=K(t,a-12);i=K(t,c)==101075792,i&&(n=K(t,c+32),o=K(t,c+48))}for(var h=0;h<n;++h){var y=_r(t,o,i),v=y[0],m=y[1],p=y[2],w=y[3],S=y[4],b=y[5],f=kr(t,b);o=S,v?v==8?s[w]=Nr(t.subarray(f,f+m),{out:new q(p)}):H(14,"unknown compression type "+v):s[w]=Xe(t,f,f+m)}return s}function Ar(t){return t instanceof File||t instanceof Blob?t.arrayBuffer().then(Ae):Ae(t)}function Ae(t){var r=new Uint8Array(t),s=Pr(r);return Promise.resolve(Or(s))}function Or(t){for(var r=[],s=0,a=Object.keys(t);s<a.length;s++){var n=a[s];r[n]=Tt(t[n])}return r}function Z(t,r){for(var s=0;s<t.childNodes.length;){var a=t.childNodes[s];if(a.nodeType===1&&ee(a)===r)return a;s++}}function je(t,r){for(var s=[],a=0;a<t.childNodes.length;){var n=t.childNodes[a];n.nodeType===1&&ee(n)===r&&s.push(n),a++}return s}function Ne(t,r,s){for(var a=0;a<t.childNodes.length;){var n=t.childNodes[a];r?n.nodeType===1&&ee(n)===r&&s(n,a):s(n,a),a++}}function Tr(t,r,s){var a=[];return Ne(t,r,function(n,o){a.push(s(n,o))}),a}var Ir=/.+\:/;function ee(t){return t.tagName.replace(Ir,"")}function Dr(t){return t.nodeType===1}function rt(t){for(var r=0;r<t.childNodes.length;){if(Dr(t.childNodes[r]))return t.childNodes[r];r++}}function It(t){if(t.nodeType!==1)return t.textContent;for(var r="<"+ee(t),s=0;s<t.attributes.length;)r+=" "+t.attributes[s].name+'="'+t.attributes[s].value+'"',s++;r+=">";for(var a=0;a<t.childNodes.length;)r+=It(t.childNodes[a]),a++;return r+="</"+ee(t)+">",r}function $r(t){var r=t.documentElement,s=Z(r,"sheetData"),a=[];return Ne(s,"row",function(n){Ne(n,"c",function(o){a.push(o)})}),a}function Mr(t,r){return Z(r,"v")}function Rr(t,r){var s=rt(r);if(s&&ee(s)==="is"){var a=rt(s);if(a&&ee(a)==="t")return a.textContent}}function Lr(t){var r=t.documentElement,s=Z(r,"dimension");if(s)return s.getAttribute("ref")}function Fr(t){var r=t.documentElement,s=Z(r,"cellStyleXfs");return s?je(s,"xf"):[]}function Ur(t){var r=t.documentElement,s=Z(r,"cellXfs");return s?je(s,"xf"):[]}function Vr(t){var r=t.documentElement,s=Z(r,"numFmts");return s?je(s,"numFmt"):[]}function zr(t){var r=t.documentElement;return Tr(r,"si",function(s){var a=Z(s,"t");if(a)return a.textContent;var n="";return Ne(s,"r",function(o){n+=Z(o,"t").textContent}),n})}function qr(t){var r=t.documentElement;return Z(r,"workbookPr")}function Br(t){var r=t.documentElement;return je(r,"Relationship")}function Hr(t){var r=t.documentElement,s=Z(r,"sheets");return je(s,"sheet")}function Xr(t,r){var s=r.createDocument(t),a={},n=qr(s);n&&n.getAttribute("date1904")==="1"&&(a.epoch1904=!0),a.sheets=[];var o=function(c){c.getAttribute("name")&&a.sheets.push({id:c.getAttribute("sheetId"),name:c.getAttribute("name"),relationId:c.getAttribute("r:id")})};return Hr(s).forEach(o),a}function Gr(t,r){var s=r.createDocument(t),a={sheets:{},sharedStrings:void 0,styles:void 0},n=function(i){var c=i.getAttribute("Target"),h=i.getAttribute("Type");switch(h){case"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles":a.styles=Oe(c);break;case"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings":a.sharedStrings=Oe(c);break;case"http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet":a.sheets[i.getAttribute("Id")]=Oe(c);break}};return Br(s).forEach(n),a}function Oe(t){return t[0]==="/"?t.slice(1):"xl/"+t}function pe(t){"@babel/helpers - typeof";return pe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},pe(t)}function st(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,a)}return s}function at(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?st(Object(s),!0).forEach(function(a){Wr(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):st(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Wr(t,r,s){return r=Kr(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Kr(t){var r=Qr(t,"string");return pe(r)==="symbol"?r:String(r)}function Qr(t,r){if(pe(t)!=="object"||t===null)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var a=s.call(t,r);if(pe(a)!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function Zr(t,r){if(!t)return{};var s=r.createDocument(t),a=Fr(s).map(Te),n=Vr(s).map(Jr).reduce(function(i,c){return i[c.id]=c,i},[]),o=function(c){return c.hasAttribute("xfId")?at(at({},a[c.xfId]),Te(c,n)):Te(c,n)};return Ur(s).map(o)}function Jr(t){return{id:t.getAttribute("numFmtId"),template:t.getAttribute("formatCode")}}function Te(t,r){var s={};if(t.hasAttribute("numFmtId")){var a=t.getAttribute("numFmtId");r[a]?s.numberFormat=r[a]:s.numberFormat={id:a}}return s}function Yr(t,r){return t?zr(r.createDocument(t)):[]}function Dt(t,r){r&&r.epoch1904&&(t+=1462);var s=70*365+19,a=3600*1e3;return new Date(Math.round((t-s)*24*a))}function es(t,r){var s=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s)return(s=s.call(t)).next.bind(s);if(Array.isArray(t)||(s=ts(t))||r){s&&(t=s);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ts(t,r){if(t){if(typeof t=="string")return nt(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return nt(t,r)}}function nt(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,a=new Array(r);s<r;s++)a[s]=t[s];return a}function rs(t,r,s){if(t){var a=r[t];if(!a)throw new Error("Cell style not found: ".concat(t));if(!a.numberFormat)return!1;if(ss.indexOf(Number(a.numberFormat.id))>=0||s.dateFormat&&a.numberFormat.template===s.dateFormat||s.smartDateParser!==!1&&a.numberFormat.template&&ls(a.numberFormat.template))return!0}}var ss=[14,15,16,17,18,19,20,21,22,27,30,36,45,46,47,50,57],as=/^\[\$-414\]/,ns=/;@$/;function ls(t){t=t.toLowerCase(),t=t.replace(as,""),t=t.replace(ns,"");for(var r=t.split(/\W+/),s=es(r),a;!(a=s()).done;){var n=a.value;if(os.indexOf(n)<0)return!1}return!0}var os=["ss","mm","h","hh","am","pm","d","dd","m","mm","mmm","mmmm","yy","yyyy","e"];function is(t,r,s){var a=s.getInlineStringValue,n=s.getInlineStringXml,o=s.getStyleId,i=s.styles,c=s.values,h=s.properties,y=s.options;switch(r||(r="n"),r){case"str":t=Ie(t,y);break;case"inlineStr":if(t=a(),t===void 0)throw new Error('Unsupported "inline string" cell value structure: '.concat(n()));t=Ie(t,y);break;case"s":var v=Number(t);if(isNaN(v))throw new Error('Invalid "shared" string index: '.concat(t));if(v>=c.length)throw new Error('An out-of-bounds "shared" string index: '.concat(t));t=c[v],t=Ie(t,y);break;case"b":if(t==="1")t=!0;else if(t==="0")t=!1;else throw new Error('Unsupported "boolean" cell value: '.concat(t));break;case"z":t=void 0;break;case"e":t=cs(t);break;case"d":if(t===void 0)break;var m=new Date(t);if(isNaN(m.valueOf()))throw new Error('Unsupported "date" cell value: '.concat(t));t=m;break;case"n":if(t===void 0)break;var p=rs(o(),i,y);p?(t=lt(t),t=Dt(t,h)):t=(y.parseNumber||lt)(t);break;default:throw new TypeError("Cell type not supported: ".concat(r))}return t===void 0&&(t=null),t}function cs(t){switch(t){case 0:return"#NULL!";case 7:return"#DIV/0!";case 15:return"#VALUE!";case 23:return"#REF!";case 29:return"#NAME?";case 36:return"#NUM!";case 42:return"#N/A";case 43:return"#GETTING_DATA";default:return"#ERROR_".concat(t)}}function Ie(t,r){return r.trim!==!1&&(t=t.trim()),t===""&&(t=void 0),t}function lt(t){var r=Number(t);if(isNaN(r))throw new Error('Invalid "numeric" cell value: '.concat(t));return r}var ds=["","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function us(t){var r=function(y,v){return y-v},s=t.map(function(h){return h.row}).sort(r),a=t.map(function(h){return h.column}).sort(r),n=s[0],o=s[s.length-1],i=a[0],c=a[a.length-1];return[{row:n,column:i},{row:o,column:c}]}function ms(t){for(var r=0,s=0;s<t.length;)r*=26,r+=ds.indexOf(t[s]),s++;return r}function $t(t){return t=t.split(/(\d+)/),[parseInt(t[1]),ms(t[0].trim())]}function xs(t,r,s,a,n,o,i){var c=$t(t.getAttribute("r")),h=Mr(r,t),y=h&&h.textContent,v;return t.hasAttribute("t")&&(v=t.getAttribute("t")),{row:c[0],column:c[1],value:is(y,v,{getInlineStringValue:function(){return Rr(r,t)},getInlineStringXml:function(){return It(t)},getStyleId:function(){return t.getAttribute("s")},styles:n,values:a,properties:o,options:i})}}function ps(t,r,s,a,n,o){var i=$r(t);return i.length===0?[]:i.map(function(c){return xs(c,t,r,s,a,n,o)})}function hs(t,r){return vs(t)||gs(t,r)||fs(t,r)||bs()}function bs(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fs(t,r){if(t){if(typeof t=="string")return ot(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return ot(t,r)}}function ot(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,a=new Array(r);s<r;s++)a[s]=t[s];return a}function gs(t,r){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var a,n,o,i,c=[],h=!0,y=!1;try{if(o=(s=s.call(t)).next,r!==0)for(;!(h=(a=o.call(s)).done)&&(c.push(a.value),c.length!==r);h=!0);}catch(v){y=!0,n=v}finally{try{if(!h&&s.return!=null&&(i=s.return(),Object(i)!==i))return}finally{if(y)throw n}}return c}}function vs(t){if(Array.isArray(t))return t}function js(t){var r=Lr(t);if(r)return r=r.split(":").map($t).map(function(s){var a=hs(s,2),n=a[0],o=a[1];return{row:n,column:o}}),r.length===1&&(r=[r[0],r[0]]),r}function ys(t,r,s,a,n,o){var i=r.createDocument(t),c=ps(i,r,s,a,n,o),h=js(i)||us(c);return{cells:c,dimensions:h}}function ws(t,r){var s=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s)return(s=s.call(t)).next.bind(s);if(Array.isArray(t)||(s=Ns(t))||r){s&&(t=s);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ns(t,r){if(t){if(typeof t=="string")return it(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return it(t,r)}}function it(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,a=new Array(r);s<r;s++)a[s]=t[s];return a}function Ss(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=r.rowIndexSourceMap,a=r.accessor,n=a===void 0?function(m){return m}:a,o=r.onlyTrimAtTheEnd,i=t.length-1;i>=0;){for(var c=!0,h=ws(t[i]),y;!(y=h()).done;){var v=y.value;if(n(v)!==null){c=!1;break}}if(c)t.splice(i,1),s&&s.splice(i,1);else if(o)break;i--}return t}function Cs(t,r){var s=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s)return(s=s.call(t)).next.bind(s);if(Array.isArray(t)||(s=ks(t))||r){s&&(t=s);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ks(t,r){if(t){if(typeof t=="string")return ct(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return ct(t,r)}}function ct(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,a=new Array(r);s<r;s++)a[s]=t[s];return a}function _s(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=r.accessor,a=s===void 0?function(m){return m}:s,n=r.onlyTrimAtTheEnd,o=t[0].length-1;o>=0;){for(var i=!0,c=Cs(t),h;!(h=c()).done;){var y=h.value;if(a(y[o])!==null){i=!1;break}}if(i)for(var v=0;v<t.length;)t[v].splice(o,1),v++;else if(n)break;o--}return t}function Es(t,r){var s=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s)return(s=s.call(t)).next.bind(s);if(Array.isArray(t)||(s=Mt(t))||r){s&&(t=s);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ps(t,r){return Ts(t)||Os(t,r)||Mt(t,r)||As()}function As(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Mt(t,r){if(t){if(typeof t=="string")return dt(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return dt(t,r)}}function dt(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,a=new Array(r);s<r;s++)a[s]=t[s];return a}function Os(t,r){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var a,n,o,i,c=[],h=!0,y=!1;try{if(o=(s=s.call(t)).next,r!==0)for(;!(h=(a=o.call(s)).done)&&(c.push(a.value),c.length!==r);h=!0);}catch(v){y=!0,n=v}finally{try{if(!h&&s.return!=null&&(i=s.return(),Object(i)!==i))return}finally{if(y)throw n}}return c}}function Ts(t){if(Array.isArray(t))return t}function Is(t,r){var s=t.dimensions,a=t.cells;if(a.length===0)return[];var n=Ps(s,2);n[0];for(var o=n[1],i=o.column,c=o.row,h=new Array(c),y=0;y<c;){h[y]=new Array(i);for(var v=0;v<i;)h[y][v]=null,v++;y++}for(var m=Es(a),p;!(p=m()).done;){var w=p.value,S=w.row-1,b=w.column-1;b<i&&S<c&&(h[S][b]=w.value)}var f=r.rowIndexSourceMap;if(f)for(var N=0;N<h.length;)f[N]=N,N++;return h=Ss(_s(h,{onlyTrimAtTheEnd:!0}),{onlyTrimAtTheEnd:!0,rowIndexSourceMap:f}),r.transformData&&(h=r.transformData(h)),h}function he(t){"@babel/helpers - typeof";return he=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},he(t)}function Ds(t,r){var s=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s)return(s=s.call(t)).next.bind(s);if(Array.isArray(t)||(s=$s(t))||r){s&&(t=s);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $s(t,r){if(t){if(typeof t=="string")return ut(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return ut(t,r)}}function ut(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,a=new Array(r);s<r;s++)a[s]=t[s];return a}function mt(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,a)}return s}function xt(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?mt(Object(s),!0).forEach(function(a){Ms(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):mt(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Ms(t,r,s){return r=Rs(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Rs(t){var r=Ls(t,"string");return he(r)==="symbol"?r:String(r)}function Ls(t,r){if(he(t)!=="object"||t===null)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var a=s.call(t,r);if(he(a)!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function Fs(t,r){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};s.sheet||(s=xt({sheet:1},s));var a=function(p){if(!t[p])throw new Error('"'.concat(p,'" file not found inside the *.xlsx file zip archive'));return t[p]},n=Gr(a("xl/_rels/workbook.xml.rels"),r),o=n.sharedStrings?Yr(a(n.sharedStrings),r):[],i=n.styles?Zr(a(n.styles),r):{},c=Xr(a("xl/workbook.xml"),r);if(s.getSheets)return c.sheets.map(function(m){var p=m.name;return{name:p}});var h=Us(s.sheet,c.sheets);if(!h||!n.sheets[h])throw Vs(s.sheet,c.sheets);var y=ys(a(n.sheets[h]),r,o,i,c,s);s=xt({rowIndexSourceMap:[]},s);var v=Is(y,s);return s.properties?{data:v,properties:c}:v}function Us(t,r){if(typeof t=="number"){var s=r[t-1];return s&&s.relationId}for(var a=Ds(r),n;!(n=a()).done;){var o=n.value;if(o.name===t)return o.relationId}}function Vs(t,r){var s=r&&r.map(function(a,n){return'"'.concat(a.name,'" (#').concat(n+1,")")}).join(", ");return new Error("Sheet ".concat(typeof t=="number"?"#"+t:'"'+t+'"'," not found in the *.xlsx file.").concat(r?" Available sheets: "+s+".":""))}function Ve(t){"@babel/helpers - typeof";return Ve=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Ve(t)}function zs(t,r,s){return Object.defineProperty(t,"prototype",{writable:!1}),t}function qs(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function Bs(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&be(t,r)}function Hs(t){var r=Rt();return function(){var a=fe(t),n;if(r){var o=fe(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return Xs(this,n)}}function Xs(t,r){if(r&&(Ve(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Gs(t)}function Gs(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ze(t){var r=typeof Map=="function"?new Map:void 0;return ze=function(a){if(a===null||!Ws(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r<"u"){if(r.has(a))return r.get(a);r.set(a,n)}function n(){return we(a,arguments,fe(this).constructor)}return n.prototype=Object.create(a.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),be(n,a)},ze(t)}function we(t,r,s){return Rt()?we=Reflect.construct.bind():we=function(n,o,i){var c=[null];c.push.apply(c,o);var h=Function.bind.apply(n,c),y=new h;return i&&be(y,i.prototype),y},we.apply(null,arguments)}function Rt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ws(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function be(t,r){return be=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,n){return a.__proto__=n,a},be(t,r)}function fe(t){return fe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},fe(t)}var B=(function(t){Bs(s,t);var r=Hs(s);function s(a){var n;return qs(this,s),n=r.call(this,"invalid"),n.reason=a,n}return zs(s)})(ze(Error));function Ks(t){if(typeof t=="string"){var r=t;if(t=Number(t),String(t)!==r)throw new B("not_a_number")}if(typeof t!="number")throw new B("not_a_number");if(isNaN(t))throw new B("invalid_number");if(!isFinite(t))throw new B("out_of_bounds");return t}function Qs(t){if(typeof t=="string")return t;if(typeof t=="number"){if(isNaN(t))throw new B("invalid_number");if(!isFinite(t))throw new B("out_of_bounds");return String(t)}throw new B("not_a_string")}function Zs(t){if(typeof t=="boolean")return t;throw new B("not_a_boolean")}function Js(t,r){var s=r.properties;if(t instanceof Date){if(isNaN(t.valueOf()))throw new B("out_of_bounds");return t}if(typeof t=="number"){if(isNaN(t))throw new B("invalid_number");if(!isFinite(t))throw new B("out_of_bounds");var a=Dt(t,s);if(isNaN(a.valueOf()))throw new B("out_of_bounds");return a}throw new B("not_a_date")}var Ys=["isColumnOriented","ignoreEmptyRows","rowIndexSourceMap"];function le(t){"@babel/helpers - typeof";return le=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},le(t)}function ea(t,r){return sa(t)||ra(t,r)||Lt(t,r)||ta()}function ta(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ra(t,r){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var a,n,o,i,c=[],h=!0,y=!1;try{if(o=(s=s.call(t)).next,r!==0)for(;!(h=(a=o.call(s)).done)&&(c.push(a.value),c.length!==r);h=!0);}catch(v){y=!0,n=v}finally{try{if(!h&&s.return!=null&&(i=s.return(),Object(i)!==i))return}finally{if(y)throw n}}return c}}function sa(t){if(Array.isArray(t))return t}function aa(t,r){var s=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s)return(s=s.call(t)).next.bind(s);if(Array.isArray(t)||(s=Lt(t))||r){s&&(t=s);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Lt(t,r){if(t){if(typeof t=="string")return pt(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return pt(t,r)}}function pt(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,a=new Array(r);s<r;s++)a[s]=t[s];return a}function na(t,r){if(t==null)return{};var s=la(t,r),a,n;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)a=o[n],!(r.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(t,a)&&(s[a]=t[a])}return s}function la(t,r){if(t==null)return{};var s={},a=Object.keys(t),n,o;for(o=0;o<a.length;o++)n=a[o],!(r.indexOf(n)>=0)&&(s[n]=t[n]);return s}function ht(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,a)}return s}function bt(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?ht(Object(s),!0).forEach(function(a){oa(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):ht(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function oa(t,r,s){return r=ia(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function ia(t){var r=ca(t,"string");return le(r)==="symbol"?r:String(r)}function ca(t,r){if(le(t)!=="object"||t===null)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var a=s.call(t,r);if(le(a)!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}var ft={schemaPropertyValueForMissingColumn:void 0,schemaPropertyValueForMissingValue:null,schemaPropertyShouldSkipRequiredValidationForMissingColumn:function(){return!1},getEmptyObjectValue:function(){return null},getEmptyArrayValue:function(){return null},isColumnOriented:!1,ignoreEmptyRows:!0,arrayValueSeparator:","};function da(t,r,s){s?s=bt(bt({},ft),s):s=ft;var a=s,n=a.isColumnOriented,o=a.ignoreEmptyRows,i=a.rowIndexSourceMap,c=na(a,Ys),h=i&&i.slice();pa(r),n&&(t=xa(t)),o&&(t=t.filter(function(N,d){var u=N.every(function(k){return k===null});return u?(h&&h.splice(d,1),!1):!0}));for(var y=t[0],v=[],m=[],p=1;p<t.length;p++){var w=Ft(r,t[p],p,void 0,y,m,c);v.push(w)}if(h)for(var S=aa(m),b;!(b=S()).done;){var f=b.value;f.row=h[f.row-1]+1}return{rows:v,errors:m}}function Ft(t,r,s,a,n,o,i){for(var c={},h=!0,y=function(j){var _=j.schemaEntry,O=j.value,l=j.error,P=j.reason,R={error:l,row:s+1,column:_.column,value:O};return P&&(R.reason=P),_.type&&(R.type=_.type),R},v=[],m=function(){var j=w[p],_=t[j],O=j,l=_.column,P="".concat(a||"",".").concat(O),R,U=n.indexOf(l),C=U<0;C||(R=r[U]);var x,A,$;if(_.schema)x=Ft(_.schema,r,s,P,n,o,i);else if(C)"schemaPropertyValueForMissingColumn"in i&&(x=i.schemaPropertyValueForMissingColumn);else if(R===void 0)"schemaPropertyValueForMissingValue"in i&&(x=i.schemaPropertyValueForMissingValue);else if(R===null)"schemaPropertyValueForMissingValue"in i&&(x=i.schemaPropertyValueForMissingValue);else if(Array.isArray(_.type)){var F=ma(R,i.arrayValueSeparator).map(function(ae){if(!A){var G=gt(ae,_,i);return G.error&&(x=ae,A=G.error,$=G.reason),G.value}});if(!A){var J=F.every(De);x=J?i.getEmptyArrayValue(F,{path:P}):F}}else{var ie=gt(R,_,i);A=ie.error,$=ie.reason,x=A?R:ie.value}!A&&De(x)&&_.required&&v.push({schemaEntry:_,value:x,isMissingColumn:C}),A?o.push(y({schemaEntry:_,value:x,error:A,reason:$})):(h&&!De(x)&&(h=!1),x!==void 0&&(c[O]=x))},p=0,w=Object.keys(t);p<w.length;p++)m();if(h)return i.getEmptyObjectValue(c,{path:a});for(var S=0,b=v;S<b.length;S++){var f=b[S],N=f.schemaEntry,d=f.value,u=f.isMissingColumn,k=u&&i.schemaPropertyShouldSkipRequiredValidationForMissingColumn(N.column,{object:c});if(!k){var D=N.required,I=typeof D=="boolean"?D:D(c);I&&o.push(y({schemaEntry:N,value:d,error:"required"}))}}return c}function gt(t,r,s){if(t===null)return{value:null};var a;if(r.parse)throw new Error("`schemaEntry.parse` property was renamed to `schemaEntry.type`");if(r.type?a=ua(t,Array.isArray(r.type)?r.type[0]:r.type,s):a={value:t},a.error)return a;if(a.value!==null){if(r.oneOf&&r.oneOf.indexOf(a.value)<0)return{error:"invalid",reason:"unknown"};if(r.validate)try{r.validate(a.value)}catch(n){return{error:n.message}}}return a}function de(t,r){try{var s=r(t);return s===void 0?{value:null}:{value:s}}catch(n){var a={error:n.message};return n.reason&&(a.reason=n.reason),a}}function ua(t,r,s){switch(r){case String:return de(t,Qs);case Number:return de(t,Ks);case Date:return de(t,function(a){return Js(a,{properties:s.properties})});case Boolean:return de(t,Zs);default:if(typeof r=="function")return de(t,r);throw new Error("Unsupported schema type: ".concat(r&&r.name||r))}}function Ut(t,r,s){for(var a=0,n="";s+a<t.length;){var o=t[s+a];if(o===r)return[n,a];if(o==='"'){var i=Ut(t,'"',s+a+1);n+=i[0],a+=1+i[1]+1}else n+=o,a++}return[n,a]}function ma(t,r){for(var s=[],a=0;a<t.length;){var n=Ut(t,r,a),o=ea(n,2),i=o[0],c=o[1];a+=c+r.length,s.push(i.trim())}return s}var xa=function(r){return r[0].map(function(s,a){return r.map(function(n){return n[a]})})};function pa(t){for(var r=0,s=Object.keys(t);r<s.length;r++){var a=s[r],n=t[a];if(le(n.type)==="object"&&!Array.isArray(n.type))throw new Error("When defining a nested schema, use a `schema` property instead of a `type` property");if(!n.schema&&!n.column)throw new Error('"column" not defined for schema entry "'.concat(a,'".'))}}function De(t){return t==null}function ge(t){"@babel/helpers - typeof";return ge=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},ge(t)}var ha=["schema"];function vt(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,a)}return s}function ye(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?vt(Object(s),!0).forEach(function(a){ba(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):vt(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function ba(t,r,s){return r=fa(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function fa(t){var r=ga(t,"string");return ge(r)==="symbol"?r:String(r)}function ga(t,r){if(ge(t)!=="object"||t===null)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var a=s.call(t,r);if(ge(a)!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function va(t,r){if(t==null)return{};var s=ja(t,r),a,n;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)a=o[n],!(r.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(t,a)&&(s[a]=t[a])}return s}function ja(t,r){if(t==null)return{};var s={},a=Object.keys(t),n,o;for(o=0;o<a.length;o++)n=a[o],!(r.indexOf(n)>=0)&&(s[n]=t[n]);return s}function ya(t,r,s){var a=s.schema,n=va(s,ha);if(n.map)throw new Error("`map` option was removed. Pass a `schema` option instead.");var o=Fs(t,r,ye(ye({},n),{},{properties:a||n.properties}));return a?da(o.data,a,ye(ye({},n),{},{properties:o.properties})):o}function jt(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Ar(t).then(function(s){return ya(s,ur,r)})}function wa({session:t,onImportComplete:r}){const[s,a]=g.useState(null),[n,o]=g.useState([]),[i,c]=g.useState(!1),[h,y]=g.useState(!1),[v,m]=g.useState(null),p=b=>{if(b.length<2)return[];const f=b[0];return b.slice(1).map(d=>{const u={};return f.forEach((k,D)=>{u[k]=d[D]}),u})},w=async b=>{const f=b.target.files?.[0];if(f){a(f),m(null),y(!1);try{const N=await jt(f),d=p(N);o(d.slice(0,5))}catch(N){console.error("Error reading file:",N),m("Error al leer el archivo Excel. Verifica que sea un archivo v√°lido.")}}},S=async()=>{if(s){c(!0),m(null);try{const b=await jt(s),f=p(b);console.log("üìä Parsed Excel data:",f),console.log("üìç Total rows to import:",f.length);const N=f.map((d,u)=>({id:d.ID||d.id||`venue-${u+1}`,name:d["Nombre del venue"]||d.nombre||d.name||`Venue ${u+1}`,address:d.Direccion||d.direccion||d.address||"",zone:d["Zona geografica"]||d.zona||d.zone||"",channel:d.Canal||d.canal||d.channel||"Bar Premium",city:d.Ciudad||d.ciudad||d.city||"",lat:d.Latitud||d.lat||d.latitude||null,lng:d.Longitud||d.lng||d.longitude||null,imported:!0,importedAt:new Date().toISOString()}));console.log("‚úÖ Transformed venues:",N),localStorage.setItem("imported_venues",JSON.stringify(N)),console.log("üíæ Venues saved to localStorage"),y(!0),m(null),c(!1),r()}catch(b){console.error("‚ùå Error processing file:",b),m(b.message||"Error al procesar el archivo"),c(!1)}}};return e.jsxs("div",{className:"bg-slate-800/30 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-amber-600/20 flex items-center justify-center",children:e.jsx(tr,{className:"w-6 h-6 text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl text-white font-semibold",children:"Importar Venues desde Excel"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Carga un archivo .xlsx con el listado de bares"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block mb-2 text-sm text-slate-300",children:"Seleccionar archivo Excel (.xlsx)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:w,className:"hidden",id:"venue-file-upload",disabled:i}),e.jsxs("label",{htmlFor:"venue-file-upload",className:`
              flex items-center justify-center gap-3 w-full px-6 py-8 
              border-2 border-dashed rounded-lg cursor-pointer transition-all
              ${i?"opacity-50 cursor-not-allowed":"hover:border-amber-500/50 hover:bg-slate-800/50"}
              ${s?"border-amber-500/50 bg-amber-500/10":"border-slate-600"}
            `,children:[e.jsx(tt,{className:"w-6 h-6 text-slate-400"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-white font-medium",children:s?s.name:"Haz clic para seleccionar archivo"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Formato esperado: ID, Nombre del venue, Zona geografica, Direccion, Latitud, Longitud"})]})]})]})]}),n.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm text-slate-300 font-medium mb-3",children:"Vista Previa (primeras 5 filas)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-700",children:[e.jsx("th",{className:"text-left py-2 px-3 text-slate-400 font-medium",children:"ID"}),e.jsx("th",{className:"text-left py-2 px-3 text-slate-400 font-medium",children:"Nombre"}),e.jsx("th",{className:"text-left py-2 px-3 text-slate-400 font-medium",children:"Zona"}),e.jsx("th",{className:"text-left py-2 px-3 text-slate-400 font-medium",children:"Direcci√≥n"}),e.jsx("th",{className:"text-left py-2 px-3 text-slate-400 font-medium",children:"Lat"}),e.jsx("th",{className:"text-left py-2 px-3 text-slate-400 font-medium",children:"Lng"})]})}),e.jsx("tbody",{children:n.map((b,f)=>e.jsxs("tr",{className:"border-b border-slate-800/50",children:[e.jsx("td",{className:"py-2 px-3 text-slate-300",children:b.ID||b.id||"-"}),e.jsx("td",{className:"py-2 px-3 text-white",children:b["Nombre del venue"]||b.nombre||"-"}),e.jsx("td",{className:"py-2 px-3 text-slate-300",children:b["Zona geografica"]||b.zona||"-"}),e.jsx("td",{className:"py-2 px-3 text-slate-400 text-xs",children:b.Direccion||b.direccion||"-"}),e.jsx("td",{className:"py-2 px-3 text-slate-400 text-xs",children:b.Latitud||b.lat||"-"}),e.jsx("td",{className:"py-2 px-3 text-slate-400 text-xs",children:b.Longitud||b.lng||"-"})]},f))})]})})]}),n.length>0&&e.jsx("div",{className:"mb-6 bg-blue-500/10 border border-blue-500/30 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-300",children:["‚ÑπÔ∏è El canal se asignar√° autom√°ticamente como ",e.jsx("strong",{children:'"Bar Premium"'})," para todos los venues. Podr√°s editarlo individualmente despu√©s de la importaci√≥n."]})}),v&&e.jsxs("div",{className:"mb-6 bg-red-500/10 border border-red-500/30 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(Be,{className:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-red-300 font-medium",children:"Error"}),e.jsx("p",{className:"text-sm text-red-400 mt-1 whitespace-pre-wrap",children:v}),v.includes("Columns available")&&e.jsxs("div",{className:"mt-3 p-3 bg-slate-900/50 rounded border border-slate-700",children:[e.jsx("p",{className:"text-xs text-slate-300 font-medium mb-1",children:"üí° Tip:"}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Aseg√∫rate de que tu Excel tenga una columna llamada exactamente:",e.jsx("strong",{className:"text-amber-400",children:' "Nombre del venue"'}),",",e.jsx("strong",{className:"text-amber-400",children:' "nombre"'}),", o",e.jsx("strong",{className:"text-amber-400",children:' "name"'})]})]})]})]}),h&&e.jsxs("div",{className:"mb-6 bg-green-500/10 border border-green-500/30 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(Re,{className:"w-5 h-5 text-green-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-green-300 font-medium",children:"¬°Importaci√≥n Exitosa!"}),e.jsx("p",{className:"text-sm text-green-400 mt-1",children:"Los venues se han importado correctamente."})]})]}),e.jsx("button",{onClick:S,disabled:!s||i||h,className:`
          w-full py-3 rounded-lg font-medium transition-all flex items-center justify-center gap-2
          ${!s||i||h?"bg-slate-700 text-slate-500 cursor-not-allowed":"bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-500 hover:to-amber-400 text-white"}
        `,children:i?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-5 h-5 animate-spin"}),"Importando..."]}):h?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-5 h-5"}),"Importaci√≥n Completada"]}):e.jsxs(e.Fragment,{children:[e.jsx(tt,{className:"w-5 h-5"}),"Importar Venues"]})})]})}function Na({session:t}){const[r,s]=g.useState([]),[a,n]=g.useState([]),[o,i]=g.useState(!0),[c,h]=g.useState(!1),[y,v]=g.useState(!1),[m,p]=g.useState({}),[w,S]=g.useState(null);g.useEffect(()=>{b()},[]);const b=async()=>{i(!0);try{await Promise.all([N(),f()])}catch(j){console.error("Error loading data:",j)}finally{i(!1)}},f=async()=>{try{const{data:j,error:_}=await T.from("btl_regiones").select("id, nombre").order("nombre",{ascending:!0});!_&&j&&n(j)}catch{console.log("Regiones table might not exist yet")}},N=async()=>{try{console.log("üìç VenueManager: Loading venues...");let j,_;try{const O=await T.from("btl_puntos_venta").select("*, region_rel:region_id(id, nombre)").order("nombre",{ascending:!0});j=O.data,_=O.error}catch{const l=await T.from("btl_puntos_venta").select("*").order("nombre",{ascending:!0});j=l.data,_=l.error}if(_){const O=await T.from("btl_puntos_venta").select("*").order("nombre",{ascending:!0});j=O.data,_=O.error}if(_)throw _;console.log("‚úÖ Loaded venues:",j?.length||0),s(j||[])}catch(j){console.error("‚ùå Error loading venues:",j),E.error("Error al cargar los puntos de venta"),s([])}},d=()=>{h(!1),N()},u=j=>{S(j)},k=async()=>{if(!w)return;const j=w;try{const{error:_}=await T.from("btl_puntos_venta").delete().eq("id",j);if(_)throw _;E.success("Punto de venta eliminado exitosamente"),await N()}catch(_){console.error("Error deleting venue:",_),E.error("Error al eliminar el punto de venta")}finally{S(null)}},D=j=>{let _=j.region_id;if(!_&&j.region){const O=a.find(l=>l.nombre.toLowerCase()===j.region.toLowerCase());O&&(_=O.id)}p({...j,region_id:_}),v(!0)},I=async()=>{try{const j=a.find(l=>l.id===m.region_id),_={nombre:m.nombre,direccion:m.direccion,ciudad:m.ciudad,tipo:m.tipo,segmento:m.segmento,potencial_ventas:m.potencial_ventas,contacto_nombre:m.contacto_nombre,contacto_telefono:m.contacto_telefono,region_id:m.region_id||null,region:j?j.nombre:m.region},{error:O}=await T.from("btl_puntos_venta").update(_).eq("id",m.id);if(O)throw O;E.success("Punto de venta actualizado"),v(!1),N()}catch(j){console.error("Error updating venue:",j),E.error("Error al actualizar el punto de venta")}},M=j=>{if(j.region_rel&&j.region_rel.nombre)return j.region_rel.nombre;if(j.region_id){const _=a.find(O=>O.id===j.region_id);if(_)return _.nombre}return j.region?j.region:"-"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl text-white font-bold",children:"Gesti√≥n de Venues"}),e.jsxs("p",{className:"text-slate-400 mt-1",children:[r.length," venues registrados"]})]}),e.jsx("button",{onClick:()=>h(!c),className:"flex items-center gap-2 bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-500 hover:to-amber-400 text-white px-4 py-2 rounded-lg transition-all",children:c?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"w-4 h-4"}),"Ver Lista de Venues"]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4"}),"Importar desde Excel"]})})]}),c&&e.jsx(wa,{session:t,onImportComplete:d}),!c&&e.jsx("div",{className:"bg-slate-800/30 backdrop-blur-sm border border-slate-700/50 rounded-xl overflow-hidden",children:o?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(V,{className:"w-8 h-8 text-amber-500 animate-spin"})}):r.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xe,{className:"w-12 h-12 text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"No hay venues registrados"}),e.jsx("button",{onClick:()=>h(!0),className:"mt-4 text-amber-400 hover:text-amber-300 font-medium",children:"Importar venues desde Excel"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-700 bg-slate-900/50",children:[e.jsx("th",{className:"text-left py-3 px-4 text-slate-400 font-medium text-sm",children:"Nombre"}),e.jsx("th",{className:"text-left py-3 px-4 text-slate-400 font-medium text-sm",children:"Regi√≥n"}),e.jsx("th",{className:"text-left py-3 px-4 text-slate-400 font-medium text-sm",children:"Ciudad"}),e.jsx("th",{className:"text-left py-3 px-4 text-slate-400 font-medium text-sm",children:"Direcci√≥n"}),e.jsx("th",{className:"text-left py-3 px-4 text-slate-400 font-medium text-sm",children:"Tipo/Segmento"}),e.jsx("th",{className:"text-left py-3 px-4 text-slate-400 font-medium text-sm",children:"Contacto"}),e.jsx("th",{className:"text-right py-3 px-4 text-slate-400 font-medium text-sm",children:"Acciones"})]})}),e.jsx("tbody",{children:r.map(j=>e.jsxs("tr",{className:"border-b border-slate-800/50 hover:bg-slate-800/30 transition-colors",children:[e.jsx("td",{className:"py-3 px-4 text-white font-medium",children:j.nombre}),e.jsx("td",{className:"py-3 px-4 text-slate-300",children:M(j)!=="-"?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-purple-500/20 text-purple-300 text-xs rounded border border-purple-500/30",children:[e.jsx(ue,{className:"w-3 h-3"}),M(j)]}):e.jsx("span",{className:"text-slate-500 text-xs",children:"Sin asignar"})}),e.jsx("td",{className:"py-3 px-4 text-slate-300 text-sm",children:j.ciudad||"-"}),e.jsx("td",{className:"py-3 px-4 text-slate-400 text-sm max-w-xs truncate",title:j.direccion,children:j.direccion}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"inline-block px-2 py-1 bg-amber-500/20 text-amber-300 text-xs rounded w-fit",children:j.tipo||"General"}),j.segmento&&e.jsx("span",{className:"text-xs text-slate-500",children:j.segmento})]})}),e.jsx("td",{className:"py-3 px-4 text-slate-400 text-sm",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:j.contacto_nombre||"-"}),j.contacto_telefono&&e.jsx("span",{className:"text-xs text-slate-500",children:j.contacto_telefono})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>D(j),className:"p-2 hover:bg-blue-500/10 rounded-lg transition-colors",title:"Editar",children:e.jsx(He,{className:"w-4 h-4 text-blue-400"})}),e.jsx("button",{onClick:()=>u(j.id),className:"p-2 hover:bg-red-500/10 rounded-lg transition-colors",title:"Eliminar",children:e.jsx(te,{className:"w-4 h-4 text-red-400"})})]})})]},j.id))})]})})}),e.jsx(se,{isOpen:!!w,onClose:()=>S(null),onConfirm:k,title:"Eliminar Venue",message:"¬øEst√°s seguro de que deseas eliminar este punto de venta? Esta acci√≥n no se puede deshacer.",confirmText:"Eliminar",variant:"danger"}),y&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-2xl shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-800",children:[e.jsx("h3",{className:"text-xl text-white font-bold",children:"Editar Venue"}),e.jsx("button",{onClick:()=>v(!1),className:"text-slate-400 hover:text-white transition-colors",children:e.jsx(X,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Nombre del Venue"}),e.jsx("input",{type:"text",value:m.nombre||"",onChange:j=>p({...m,nombre:j.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-amber-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Regi√≥n"}),e.jsxs("select",{value:m.region_id||"",onChange:j=>p({...m,region_id:j.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-amber-500",children:[e.jsx("option",{value:"",children:"Seleccionar Regi√≥n..."}),a.map(j=>e.jsx("option",{value:j.id,children:j.nombre},j.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Ciudad"}),e.jsx("input",{type:"text",value:m.ciudad||"",onChange:j=>p({...m,ciudad:j.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-amber-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Direcci√≥n Completa"}),e.jsx("input",{type:"text",value:m.direccion||"",onChange:j=>p({...m,direccion:j.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-amber-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Tipo"}),e.jsx("input",{type:"text",value:m.tipo||"",onChange:j=>p({...m,tipo:j.target.value}),placeholder:"Ej. Bar, Discoteca",className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-amber-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Segmento"}),e.jsx("input",{type:"text",value:m.segmento||"",onChange:j=>p({...m,segmento:j.target.value}),placeholder:"Ej. Premium, High Energy",className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-amber-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Potencial Ventas"}),e.jsx("input",{type:"text",value:m.potencial_ventas||"",onChange:j=>p({...m,potencial_ventas:j.target.value}),placeholder:"Ej. Alto, Medio",className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-amber-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Nombre Contacto"}),e.jsx("input",{type:"text",value:m.contacto_nombre||"",onChange:j=>p({...m,contacto_nombre:j.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-amber-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Tel√©fono Contacto"}),e.jsx("input",{type:"text",value:m.contacto_telefono||"",onChange:j=>p({...m,contacto_telefono:j.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-amber-500"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-slate-800 bg-slate-900/50",children:[e.jsx("button",{onClick:()=>v(!1),className:"px-4 py-2 text-slate-400 hover:text-white transition-colors font-medium",children:"Cancelar"}),e.jsxs("button",{onClick:I,className:"flex items-center gap-2 bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-500 hover:to-amber-400 text-white px-6 py-2 rounded-lg font-medium shadow-lg shadow-amber-500/20 transition-all hover:scale-105",children:[e.jsx(St,{className:"w-4 h-4"}),"Guardar Cambios"]})]})]})})]})}function Sa({session:t}){const[r,s]=g.useState([]),[a,n]=g.useState(null),[o,i]=g.useState([]),[c,h]=g.useState([]),[y,v]=g.useState(!0),[m,p]=g.useState(!1),[w,S]=g.useState(""),[b,f]=g.useState(!1),[N,d]=g.useState([]),[u,k]=g.useState(null);g.useEffect(()=>{D(),I()},[]),g.useEffect(()=>{a&&M()},[a]);const D=async()=>{try{const{data:x,error:A}=await T.from("btl_usuarios").select("id, nombre, email, empresa").eq("rol","client").order("nombre");if(A)throw A;s(x||[])}catch(x){console.error("Error loading clients:",x)}finally{v(!1)}},I=async()=>{try{const{data:x,error:A}=await T.from("btl_productos").select("id, nombre, marca, categoria, presentacion").order("marca, nombre");if(A)throw A;h(x||[])}catch(x){console.error("Error loading products:",x)}},M=async()=>{if(a){v(!0);try{const{data:x,error:A}=await T.from("btl_cliente_productos").select(`
          id,
          producto_id,
          activo,
          prioridad,
          visible_dashboard,
          notas,
          btl_productos!inner (
            id,
            nombre,
            marca,
            categoria,
            presentacion
          )
        `).eq("usuario_id",a.id).order("prioridad",{ascending:!1});if(A)throw A;i(x||[])}catch(x){console.error("Error loading client products:",x)}finally{v(!1)}}},j=async()=>{if(!(!a||N.length===0)){p(!0);try{const x=o.length>0?Math.max(...o.map(F=>F.prioridad)):0,A=N.map((F,J)=>({usuario_id:a.id,producto_id:F,activo:!0,prioridad:x+N.length-J,visible_dashboard:!0})),{error:$}=await T.from("btl_cliente_productos").insert(A);if($)throw $;await M(),f(!1),d([]),E.success("Productos agregados exitosamente")}catch(x){console.error("Error adding products:",x),E.error("Error al agregar productos")}finally{p(!1)}}},_=x=>{k(x)},O=async()=>{if(!u)return;const x=u;try{const{error:A}=await T.from("btl_cliente_productos").delete().eq("id",x);if(A)throw A;await M(),E.success("Producto eliminado del cliente")}catch(A){console.error("Error removing product:",A),E.error("Error al eliminar producto")}finally{k(null)}},l=async(x,A)=>{try{const{error:$}=await T.from("btl_cliente_productos").update(A).eq("id",x);if($)throw $;await M()}catch($){console.error("Error updating product:",$),E.error("Error al actualizar producto")}},P=async(x,A)=>{await l(x,{prioridad:A})},R=r.filter(x=>x.nombre?.toLowerCase().includes(w.toLowerCase())||x.email?.toLowerCase().includes(w.toLowerCase())||x.empresa?.toLowerCase().includes(w.toLowerCase())),U=o.map(x=>x.producto_id),C=c.filter(x=>!U.includes(x.id));return y&&!a?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(V,{className:"w-12 h-12 text-amber-500 animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl text-white font-semibold mb-2",children:"Gesti√≥n de Productos por Cliente"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Asigna productos a cada cliente para que aparezcan en sus solicitudes de tickets"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl shadow-xl p-6",children:[e.jsxs("h3",{className:"text-white font-semibold mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"Clientes"}),e.jsx("span",{className:"text-xs bg-slate-700/50 px-2 py-1 rounded",children:r.length})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Buscar cliente...",value:w,onChange:x=>S(x.target.value),className:"w-full bg-slate-900/50 border border-slate-700 text-white text-sm pl-10 pr-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500/50"})]}),e.jsxs("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:[R.map(x=>e.jsxs("button",{onClick:()=>n(x),className:`w-full text-left p-3 rounded-lg border transition-all ${a?.id===x.id?"bg-amber-600/20 border-amber-600 text-white":"bg-slate-800/50 border-slate-700/50 text-slate-300 hover:bg-slate-800 hover:border-slate-600"}`,children:[e.jsx("div",{className:"font-medium text-sm",children:x.nombre}),e.jsx("div",{className:"text-xs text-slate-400 truncate",children:x.email}),x.empresa&&e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:x.empresa})]},x.id)),R.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400 text-sm",children:"No se encontraron clientes"})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:a?e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl shadow-xl p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-white font-semibold text-lg mb-1",children:["Productos de ",a.nombre]}),e.jsxs("p",{className:"text-slate-400 text-sm",children:[o.length," productos asignados"]})]}),e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 bg-amber-600 hover:bg-amber-500 text-white px-4 py-2 rounded-lg transition-colors text-sm",children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Agregar Productos"})]})]}),y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(V,{className:"w-8 h-8 text-amber-500 animate-spin"})}):o.length>0?e.jsx("div",{className:"space-y-3",children:o.map(x=>e.jsx("div",{className:"bg-slate-900/30 border border-slate-700/50 rounded-lg p-4",children:e.jsx("div",{className:"flex items-start gap-4",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-medium",children:x.btl_productos.nombre}),e.jsx("p",{className:"text-slate-400 text-sm",children:x.btl_productos.marca}),x.btl_productos.categoria&&e.jsx("p",{className:"text-slate-500 text-xs mt-1",children:x.btl_productos.categoria})]}),e.jsx("button",{onClick:()=>_(x.id),className:"p-2 hover:bg-red-600/20 rounded-lg text-red-400 transition-colors",title:"Eliminar",children:e.jsx(te,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Prioridad"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:x.prioridad,onChange:A=>P(x.id,Number(A.target.value)),className:"w-20 bg-slate-800 border border-slate-700 text-white text-sm px-2 py-1 rounded"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("button",{onClick:()=>P(x.id,x.prioridad+1),className:"p-1 hover:bg-slate-700 rounded text-slate-400",children:e.jsx(er,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>P(x.id,Math.max(0,x.prioridad-1)),className:"p-1 hover:bg-slate-700 rounded text-slate-400",children:e.jsx(Ht,{className:"w-3 h-3"})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Estado"}),e.jsx("button",{onClick:()=>l(x.id,{activo:!x.activo}),className:`px-3 py-1 rounded-full text-xs font-medium border transition-colors ${x.activo?"bg-green-500/20 text-green-400 border-green-500/30 hover:bg-green-500/30":"bg-slate-700/50 text-slate-400 border-slate-600 hover:bg-slate-700"}`,children:x.activo?"Activo":"Inactivo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Dashboard"}),e.jsx("button",{onClick:()=>l(x.id,{visible_dashboard:!x.visible_dashboard}),className:`px-3 py-1 rounded-full text-xs font-medium border transition-colors ${x.visible_dashboard?"bg-amber-500/20 text-amber-400 border-amber-500/30 hover:bg-amber-500/30":"bg-slate-700/50 text-slate-400 border-slate-600 hover:bg-slate-700"}`,children:x.visible_dashboard?"Visible":"Oculto"})]})]})]})})},x.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Me,{className:"w-12 h-12 text-slate-600 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-400 mb-4",children:"Este cliente no tiene productos asignados"}),e.jsx("button",{onClick:()=>f(!0),className:"bg-amber-600 hover:bg-amber-500 text-white px-4 py-2 rounded-lg transition-colors",children:"Agregar Productos"})]})]}):e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl shadow-xl p-12 text-center",children:[e.jsx(Me,{className:"w-16 h-16 text-slate-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-white font-semibold text-lg mb-2",children:"Selecciona un Cliente"}),e.jsx("p",{className:"text-slate-400",children:"Elige un cliente de la lista para gestionar sus productos"})]})})]}),e.jsx(se,{isOpen:!!u,onClose:()=>k(null),onConfirm:O,title:"Eliminar Producto del Cliente",message:"¬øEst√°s seguro de que deseas eliminar este producto del cliente? Esta acci√≥n no se puede deshacer.",confirmText:"Eliminar",variant:"danger"}),b&&a&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/90 to-slate-900/90 backdrop-blur-sm border border-slate-700/50 rounded-xl shadow-2xl max-w-3xl w-full max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-slate-700/50 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-xl text-white font-semibold",children:["Agregar Productos a ",a.nombre]}),e.jsx("button",{onClick:()=>{f(!1),d([])},className:"text-slate-400 hover:text-white",children:e.jsx(X,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[C.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:C.map(x=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${N.includes(x.id)?"bg-amber-600/10 border-amber-600 shadow-sm shadow-amber-500/20":"bg-slate-800/30 border-slate-700/50 hover:border-slate-600 hover:bg-slate-800/50"}`,children:[e.jsx("input",{type:"checkbox",checked:N.includes(x.id),onChange:A=>{A.target.checked?d([...N,x.id]):d(N.filter($=>$!==x.id))},className:"w-5 h-5 rounded border-slate-600 text-amber-600 focus:ring-2 focus:ring-amber-500/50 focus:ring-offset-0 bg-slate-700"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-white text-sm font-medium truncate",children:x.nombre}),e.jsx("div",{className:"text-slate-400 text-xs truncate",children:x.marca}),x.categoria&&e.jsx("div",{className:"text-slate-500 text-xs mt-0.5",children:x.categoria})]})]},x.id))}):e.jsx("div",{className:"text-center py-12 text-slate-400",children:"Todos los productos ya est√°n asignados a este cliente"}),N.length>0&&e.jsx("div",{className:"mt-4 p-3 bg-amber-500/10 border border-amber-500/30 rounded-lg",children:e.jsxs("p",{className:"text-xs text-amber-400",children:["‚úì ",N.length," producto",N.length!==1?"s":""," seleccionado",N.length!==1?"s":""]})})]}),e.jsxs("div",{className:"p-6 border-t border-slate-700/50 flex gap-3",children:[e.jsx("button",{onClick:()=>{f(!1),d([])},disabled:m,className:"flex-1 bg-slate-700/50 hover:bg-slate-700 disabled:bg-slate-800 text-white px-4 py-2.5 rounded-lg transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:j,disabled:m||N.length===0,className:"flex-1 bg-amber-600 hover:bg-amber-500 disabled:bg-slate-700 text-white px-4 py-2.5 rounded-lg transition-colors flex items-center justify-center gap-2",children:m?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Agregando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-4 h-4"}),e.jsx("span",{children:"Agregar Productos"})]})})]})]})})]})}function Ca(){const[t,r]=g.useState([]),[s,a]=g.useState(!0),[n,o]=g.useState(""),[i,c]=g.useState(!1),[h,y]=g.useState(null),[v,m]=g.useState(null),p={nombre:"",marca:"",categoria:"Cerveza",subcategoria:"Premium",sku:"",codigo_barras:"",presentacion:"",color_primario:"#FFD700",color_secundario:"#FFFFFF",objetivo_presencia:80,objetivo_stock:75,objetivo_pop:60,descripcion:"",activo:!0,orden_visualizacion:0};g.useEffect(()=>{w()},[]);const w=async()=>{try{a(!0);const{data:d,error:u}=await T.from("btl_productos").select("*").order("orden_visualizacion");if(u)throw u;r(d||[])}catch(d){console.error("Error loading products:",d)}finally{a(!1)}},S=async d=>{try{if(d.id){const{error:u}=await T.from("btl_productos").update(d).eq("id",d.id);if(u)throw u}else{const{error:u}=await T.from("btl_productos").insert([d]);if(u)throw u}await w(),c(!1),y(null),E.success("Producto guardado correctamente")}catch(u){console.error("Error saving product:",u),E.error("Error al guardar el producto")}},b=d=>{m(d)},f=async()=>{if(!v)return;const d=v;try{const{error:u}=await T.from("btl_productos").delete().eq("id",d);if(u)throw u;await w(),E.success("Producto eliminado correctamente")}catch(u){console.error("Error deleting product:",u),E.error("Error al eliminar el producto")}finally{m(null)}},N=t.filter(d=>d.nombre.toLowerCase().includes(n.toLowerCase())||d.marca.toLowerCase().includes(n.toLowerCase())||d.sku.toLowerCase().includes(n.toLowerCase()));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl text-white font-bold mb-1",children:"Gesti√≥n de Productos"}),e.jsx("p",{className:"text-slate-400",children:"Administra el cat√°logo de productos disponibles para los clientes"})]}),e.jsxs("button",{onClick:()=>{y(p),c(!0)},className:"px-4 py-2 bg-gradient-to-r from-amber-600 to-amber-500 text-white rounded-lg hover:from-amber-500 hover:to-amber-400 transition-all flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Nuevo Producto"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",value:n,onChange:d=>o(d.target.value),placeholder:"Buscar productos por nombre, marca o SKU...",className:"w-full pl-10 pr-4 py-3 bg-slate-800/50 border border-slate-700/50 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:border-amber-500/50"})]}),s?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-amber-600 border-t-transparent rounded-full animate-spin"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:N.map(d=>e.jsx("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-4 hover:border-slate-600/50 transition-all",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-14 h-14 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:d.color_primario+"20",borderColor:d.color_primario+"50",borderWidth:"1px"},children:e.jsx("span",{className:"text-xl font-bold",style:{color:d.color_primario},children:d.marca.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold",children:d.marca}),e.jsx("p",{className:"text-slate-400 text-sm",children:d.nombre})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>{y(d),c(!0)},className:"p-2 text-blue-400 hover:bg-blue-400/10 rounded-lg transition-all",children:e.jsx(He,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>d.id&&b(d.id),className:"p-2 text-red-400 hover:bg-red-400/10 rounded-lg transition-all",children:e.jsx(te,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-0.5 bg-slate-700/50 text-slate-300 text-xs rounded",children:d.categoria}),e.jsx("span",{className:"px-2 py-0.5 bg-slate-700/50 text-slate-300 text-xs rounded",children:d.presentacion})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["SKU: ",d.sku]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-slate-400",children:"Presencia"}),e.jsxs("div",{className:"text-white font-semibold",children:[d.objetivo_presencia,"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-slate-400",children:"Stock"}),e.jsxs("div",{className:"text-white font-semibold",children:[d.objetivo_stock,"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-slate-400",children:"POP"}),e.jsxs("div",{className:"text-white font-semibold",children:[d.objetivo_pop,"%"]})]})]})]})]})]})},d.id))}),e.jsx(se,{isOpen:!!v,onClose:()=>m(null),onConfirm:f,title:"Eliminar Producto",message:"¬øEst√°s seguro de que deseas eliminar este producto? Esta acci√≥n no se puede deshacer.",confirmText:"Eliminar",variant:"danger"}),i&&h&&e.jsx(ka,{product:h,onSave:S,onClose:()=>{c(!1),y(null)}})]})}function ka({product:t,onSave:r,onClose:s}){const[a,n]=g.useState(t),o=i=>{i.preventDefault(),r(a)};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4",children:e.jsx("div",{className:"bg-gradient-to-br from-slate-900 to-slate-800 border border-slate-700/50 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("form",{onSubmit:o,children:[e.jsx("div",{className:"p-6 border-b border-slate-700/50 sticky top-0 bg-slate-900/95 backdrop-blur-sm z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl text-white font-bold",children:a.id?"Editar Producto":"Nuevo Producto"}),e.jsx("button",{type:"button",onClick:s,className:"text-slate-400 hover:text-white transition-colors",children:e.jsx(X,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm mb-2",children:"Marca *"}),e.jsx("input",{type:"text",required:!0,value:a.marca,onChange:i=>n({...a,marca:i.target.value}),className:"w-full px-4 py-2 bg-slate-800/50 border border-slate-700/50 rounded-lg text-white focus:outline-none focus:border-amber-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm mb-2",children:"SKU *"}),e.jsx("input",{type:"text",required:!0,value:a.sku,onChange:i=>n({...a,sku:i.target.value}),className:"w-full px-4 py-2 bg-slate-800/50 border border-slate-700/50 rounded-lg text-white focus:outline-none focus:border-amber-500/50"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm mb-2",children:"Nombre del Producto *"}),e.jsx("input",{type:"text",required:!0,value:a.nombre,onChange:i=>n({...a,nombre:i.target.value}),className:"w-full px-4 py-2 bg-slate-800/50 border border-slate-700/50 rounded-lg text-white focus:outline-none focus:border-amber-500/50"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm mb-2",children:"Categor√≠a"}),e.jsxs("select",{value:a.categoria,onChange:i=>n({...a,categoria:i.target.value}),className:"w-full px-4 py-2 bg-slate-800/50 border border-slate-700/50 rounded-lg text-white focus:outline-none focus:border-amber-500/50",children:[e.jsx("option",{children:"Cerveza"}),e.jsx("option",{children:"Whisky"}),e.jsx("option",{children:"Vodka"}),e.jsx("option",{children:"Ron"}),e.jsx("option",{children:"Tequila"}),e.jsx("option",{children:"Gin"}),e.jsx("option",{children:"Vino"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm mb-2",children:"Subcategor√≠a"}),e.jsxs("select",{value:a.subcategoria,onChange:i=>n({...a,subcategoria:i.target.value}),className:"w-full px-4 py-2 bg-slate-800/50 border border-slate-700/50 rounded-lg text-white focus:outline-none focus:border-amber-500/50",children:[e.jsx("option",{children:"Premium"}),e.jsx("option",{children:"Est√°ndar"}),e.jsx("option",{children:"Popular"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm mb-2",children:"Presentaci√≥n"}),e.jsx("input",{type:"text",value:a.presentacion,onChange:i=>n({...a,presentacion:i.target.value}),placeholder:"355ml, 750ml...",className:"w-full px-4 py-2 bg-slate-800/50 border border-slate-700/50 rounded-lg text-white focus:outline-none focus:border-amber-500/50"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm mb-2",children:"Color Primario"}),e.jsx("input",{type:"color",value:a.color_primario,onChange:i=>n({...a,color_primario:i.target.value}),className:"w-full h-10 bg-slate-800/50 border border-slate-700/50 rounded-lg cursor-pointer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm mb-2",children:"Color Secundario"}),e.jsx("input",{type:"color",value:a.color_secundario,onChange:i=>n({...a,color_secundario:i.target.value}),className:"w-full h-10 bg-slate-800/50 border border-slate-700/50 rounded-lg cursor-pointer"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm mb-2",children:"Objetivo Presencia (%)"}),e.jsx("input",{type:"number",min:"0",max:"100",value:a.objetivo_presencia,onChange:i=>n({...a,objetivo_presencia:Number(i.target.value)}),className:"w-full px-4 py-2 bg-slate-800/50 border border-slate-700/50 rounded-lg text-white focus:outline-none focus:border-amber-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm mb-2",children:"Objetivo Stock (%)"}),e.jsx("input",{type:"number",min:"0",max:"100",value:a.objetivo_stock,onChange:i=>n({...a,objetivo_stock:Number(i.target.value)}),className:"w-full px-4 py-2 bg-slate-800/50 border border-slate-700/50 rounded-lg text-white focus:outline-none focus:border-amber-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-sm mb-2",children:"Objetivo POP (%)"}),e.jsx("input",{type:"number",min:"0",max:"100",value:a.objetivo_pop,onChange:i=>n({...a,objetivo_pop:Number(i.target.value)}),className:"w-full px-4 py-2 bg-slate-800/50 border border-slate-700/50 rounded-lg text-white focus:outline-none focus:border-amber-500/50"})]})]})]}),e.jsxs("div",{className:"p-6 border-t border-slate-700/50 bg-slate-800/30 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:s,className:"px-6 py-2.5 bg-slate-700/50 text-white rounded-lg hover:bg-slate-700 transition-colors",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"px-6 py-2.5 bg-gradient-to-r from-amber-600 to-amber-500 text-white rounded-lg hover:from-amber-500 hover:to-amber-400 transition-all flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),"Guardar"]})]})]})})})}function _a({session:t,onUpdate:r}){const[s,a]=g.useState([]),[n,o]=g.useState(!0),[i,c]=g.useState(null),[h,y]=g.useState(""),[v,m]=g.useState(""),[p,w]=g.useState(!1),[S,b]=g.useState(null),[f,N]=g.useState(null);g.useEffect(()=>{d()},[]);const d=async()=>{o(!0);try{const{data:l,error:P}=await T.from("btl_usuarios").select("*").eq("estado_aprobacion","pending").order("created_at",{ascending:!0});if(P)throw P;a(l||[])}catch(l){console.error("Error loading pending users:",l),E.error("Error al cargar solicitudes pendientes")}finally{o(!1)}},u=l=>{N(l)},k=async()=>{if(!f)return;const l=f;c(l.id);try{const{data:P,error:R}=await T.from("btl_usuarios").select("id").eq("auth_user_id",t.user.id).single();if(R)throw console.error("Error getting admin ID:",R),new Error("No se pudo obtener informaci√≥n del administrador");const{error:U}=await T.from("btl_usuarios").update({estado_aprobacion:"approved",aprobado_por:P.id,fecha_aprobacion:new Date().toISOString()}).eq("id",l.id);if(U)throw U;E.success(`‚úÖ Usuario ${l.nombre} aprobado exitosamente`),await d(),r()}catch(P){console.error("Error approving user:",P),E.error(`Error al aprobar usuario: ${P.message}`)}finally{c(null),N(null)}},D=async()=>{if(S){if(!v.trim()){E.error("Por favor ingresa una raz√≥n para el rechazo");return}c(S.id);try{const{data:l,error:P}=await T.from("btl_usuarios").select("id").eq("auth_user_id",t.user.id).single();if(P)throw console.error("Error getting admin ID:",P),new Error("No se pudo obtener informaci√≥n del administrador");const{error:R}=await T.from("btl_usuarios").update({estado_aprobacion:"rejected",aprobado_por:l.id,fecha_aprobacion:new Date().toISOString(),nota_rechazo:v}).eq("id",S.id);if(R)throw R;E.success(`Usuario ${S.nombre} rechazado`),w(!1),b(null),m(""),await d(),r()}catch(l){console.error("Error rejecting user:",l),E.error(`Error al rechazar usuario: ${l.message}`)}finally{c(null)}}},I=l=>{b(l),w(!0),m("")},M=s.filter(l=>l.nombre?.toLowerCase().includes(h.toLowerCase())||l.email?.toLowerCase().includes(h.toLowerCase())||l.rol?.toLowerCase().includes(h.toLowerCase())),j=l=>{switch(l){case"admin":return"bg-purple-500/20 text-purple-300 border-purple-500/30";case"inspector":return"bg-blue-500/20 text-blue-300 border-blue-500/30";case"client":return"bg-amber-500/20 text-amber-300 border-amber-500/30";default:return"bg-slate-500/20 text-slate-300 border-slate-500/30"}},_=l=>{switch(l){case"admin":return"Administrador";case"inspector":return"Inspector";case"client":return"Cliente";default:return l}},O=l=>{const P=new Date(l),U=new Date().getTime()-P.getTime(),C=Math.floor(U/(1e3*60*60)),x=Math.floor(C/24);if(C<1){const A=Math.floor(U/6e4);return`Hace ${A} minuto${A!==1?"s":""}`}else return C<24?`Hace ${C} hora${C!==1?"s":""}`:x<7?`Hace ${x} d√≠a${x!==1?"s":""}`:P.toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})};return n?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(V,{className:"w-12 h-12 text-purple-500 animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl text-white font-semibold",children:"Solicitudes Pendientes"}),e.jsx("p",{className:"text-slate-400 text-sm",children:M.length===0?"No hay solicitudes pendientes":`${M.length} solicitud${M.length!==1?"es":""} esperando aprobaci√≥n`})]}),s.length>0&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-amber-500/10 border border-amber-500/30 rounded-lg",children:[e.jsx(Le,{className:"w-4 h-4 text-amber-400"}),e.jsxs("span",{className:"text-sm text-amber-300 font-medium",children:[s.length," pendiente",s.length!==1?"s":""]})]})]}),e.jsx("div",{className:"rounded-xl bg-blue-500/10 border border-blue-500/30 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-500/20 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx(Be,{className:"w-5 h-5 text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-white font-semibold mb-1",children:"Sistema de Aprobaci√≥n de Usuarios"}),e.jsx("p",{className:"text-sm text-slate-300",children:"Los nuevos usuarios deben ser aprobados por un administrador antes de poder acceder al sistema. Revisa cada solicitud cuidadosamente y verifica que el email corporativo y la informaci√≥n sean correctos."})]})]})}),s.length>0&&e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por nombre, email o rol...",value:h,onChange:l=>y(l.target.value),className:"w-full bg-slate-800/50 border border-slate-700 text-white pl-10 pr-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50"})]}),M.length===0?e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-green-500/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(Ct,{className:"w-8 h-8 text-green-400"})}),e.jsx("h3",{className:"text-xl text-white font-semibold mb-2",children:h?"No se encontraron solicitudes":"¬°Todo al d√≠a!"}),e.jsx("p",{className:"text-slate-400",children:h?"Intenta con otros t√©rminos de b√∫squeda":"No hay solicitudes de registro pendientes de aprobaci√≥n"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:M.map(l=>e.jsx("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6 hover:border-slate-600/50 transition-all",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4 lg:gap-6",children:[e.jsx("div",{className:"flex-1 space-y-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-lg",children:l.nombre.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h3",{className:"text-white font-semibold text-lg",children:l.nombre}),e.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs font-medium border ${j(l.rol)}`,children:_(l.rol)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-sm mt-1",children:[e.jsx(Zt,{className:"w-4 h-4"}),e.jsx("span",{className:"break-all",children:l.email})]}),l.empresa&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-sm mt-1",children:[e.jsx(Yt,{className:"w-4 h-4"}),e.jsx("span",{children:l.empresa})]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 text-xs mt-2",children:[e.jsx(Le,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:O(l.created_at)})]})]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>u(l),disabled:i===l.id,className:"flex items-center gap-2 bg-green-600 hover:bg-green-500 disabled:bg-slate-700 disabled:text-slate-500 text-white px-4 py-2.5 rounded-lg transition-colors font-medium",children:[i===l.id?e.jsx(V,{className:"w-4 h-4 animate-spin"}):e.jsx(Se,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Aprobar"})]}),e.jsxs("button",{onClick:()=>I(l),disabled:i===l.id,className:"flex items-center gap-2 bg-red-600/80 hover:bg-red-600 disabled:bg-slate-700 disabled:text-slate-500 text-white px-4 py-2.5 rounded-lg transition-colors font-medium",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Rechazar"})]})]})]})},l.id))}),e.jsx(se,{isOpen:!!f,onClose:()=>N(null),onConfirm:k,title:"Aprobar Usuario",message:`¬øAprobar la solicitud de ${f?.nombre} (${f?.email})?`,confirmText:"Aprobar",variant:"info"}),p&&S&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-800 to-slate-900 border border-slate-700/50 rounded-xl max-w-md w-full p-6 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center",children:e.jsx(X,{className:"w-5 h-5 text-red-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg text-white font-semibold",children:"Rechazar Solicitud"}),e.jsx("p",{className:"text-sm text-slate-400",children:S.nombre})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm text-slate-300 mb-2",children:["Raz√≥n del rechazo ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("textarea",{value:v,onChange:l=>m(l.target.value),placeholder:"Explica brevemente por qu√© se rechaza esta solicitud...",rows:4,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-3 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500/50 resize-none"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{w(!1),b(null),m("")},disabled:i!==null,className:"flex-1 bg-slate-700 hover:bg-slate-600 disabled:bg-slate-800 disabled:text-slate-600 text-white px-4 py-2.5 rounded-lg transition-colors font-medium",children:"Cancelar"}),e.jsx("button",{onClick:D,disabled:i!==null||!v.trim(),className:"flex-1 bg-red-600 hover:bg-red-500 disabled:bg-slate-700 disabled:text-slate-500 text-white px-4 py-2.5 rounded-lg transition-colors font-medium flex items-center justify-center gap-2",children:i===S.id?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Rechazando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{children:"Confirmar Rechazo"})]})})]})]})})]})}function Ea({session:t}){const[r,s]=g.useState([]),[a,n]=g.useState(!0),[o,i]=g.useState(""),[c,h]=g.useState("all"),[y,v]=g.useState(!1),[m,p]=g.useState(null),[w,S]=g.useState(null),[b,f]=g.useState({titulo:"",descripcion:"",objetivo:"",categoria:"Producto",tipo:"Presencial",nivel:"B√°sico",fecha_inicio:"",fecha_fin:"",duracion_horas:0,modalidad:"presencial",ubicacion:"",instructor_nombre:"",cupo_maximo:20,cupo_minimo:1,estado:"programada",asistencia_esperada:0});g.useEffect(()=>{N()},[]);const N=async()=>{n(!0);try{const{data:l,error:P}=await T.from("btl_capacitaciones").select("*").order("fecha_inicio",{ascending:!1});if(P)throw P;s(l||[])}catch(l){console.error("Error loading trainings:",l),E.error("Error al cargar las capacitaciones")}finally{n(!1)}},d=l=>{l?(p(l),f({titulo:l.titulo,descripcion:l.descripcion||"",objetivo:l.objetivo||"",categoria:l.categoria||"Producto",tipo:l.tipo||"Presencial",nivel:l.nivel||"B√°sico",fecha_inicio:l.fecha_inicio?new Date(l.fecha_inicio).toISOString().slice(0,16):"",fecha_fin:l.fecha_fin?new Date(l.fecha_fin).toISOString().slice(0,16):"",duracion_horas:l.duracion_horas||0,modalidad:l.modalidad||"presencial",ubicacion:l.ubicacion||"",instructor_nombre:l.instructor_nombre||"",cupo_maximo:l.cupo_maximo||20,cupo_minimo:1,estado:l.estado||"programada",asistencia_esperada:l.asistencia_esperada||0})):(p(null),f({titulo:"",descripcion:"",objetivo:"",categoria:"Producto",tipo:"Presencial",nivel:"B√°sico",fecha_inicio:"",fecha_fin:"",duracion_horas:0,modalidad:"presencial",ubicacion:"",instructor_nombre:"",cupo_maximo:20,cupo_minimo:1,estado:"programada",asistencia_esperada:0})),v(!0)},u=()=>{v(!1),p(null)},k=async l=>{l.preventDefault();try{if(m){const{error:P}=await T.from("btl_capacitaciones").update(b).eq("id",m.id);if(P)throw P;E.success("Capacitaci√≥n actualizada exitosamente")}else{const{error:P}=await T.from("btl_capacitaciones").insert([{...b,creado_por:t.user.id}]);if(P)throw P;E.success("Capacitaci√≥n creada exitosamente")}u(),await N()}catch(P){console.error("Error saving training:",P),E.error("Error al guardar la capacitaci√≥n")}},D=l=>{S(l)},I=async()=>{if(!w)return;const l=w;try{const{error:P}=await T.from("btl_capacitaciones").delete().eq("id",l);if(P)throw P;E.success("Capacitaci√≥n eliminada exitosamente"),await N()}catch(P){console.error("Error deleting training:",P),E.error("Error al eliminar la capacitaci√≥n")}finally{S(null)}},M=r.filter(l=>{const P=l.titulo.toLowerCase().includes(o.toLowerCase())||l.instructor_nombre?.toLowerCase().includes(o.toLowerCase())||l.categoria?.toLowerCase().includes(o.toLowerCase()),R=c==="all"||l.estado===c;return P&&R}),j=l=>{switch(l){case"programada":return"bg-blue-500/20 text-blue-300 border-blue-500/30";case"en_curso":return"bg-green-500/20 text-green-300 border-green-500/30";case"completada":return"bg-purple-500/20 text-purple-300 border-purple-500/30";case"cancelada":return"bg-red-500/20 text-red-300 border-red-500/30";case"pospuesta":return"bg-amber-500/20 text-amber-300 border-amber-500/30";default:return"bg-slate-500/20 text-slate-300 border-slate-500/30"}},_=l=>{switch(l){case"programada":return"Programada";case"en_curso":return"En Curso";case"completada":return"Completada";case"cancelada":return"Cancelada";case"pospuesta":return"Pospuesta";default:return l}},O=l=>l?new Date(l).toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-";return a?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(V,{className:"w-12 h-12 text-purple-500 animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl text-white font-semibold",children:"Gesti√≥n de Capacitaciones"}),e.jsxs("p",{className:"text-slate-400 text-sm",children:["Total: ",r.length," capacitaciones"]})]}),e.jsxs("button",{onClick:()=>d(),className:"flex items-center gap-2 bg-purple-600 hover:bg-purple-500 text-white px-4 py-2.5 rounded-lg transition-colors",children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Nueva Capacitaci√≥n"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por t√≠tulo, instructor o categor√≠a...",value:o,onChange:l=>i(l.target.value),className:"w-full bg-slate-800/50 border border-slate-700 text-white pl-10 pr-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50"})]}),e.jsxs("select",{value:c,onChange:l=>h(l.target.value),className:"bg-slate-800/50 border border-slate-700 text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50",children:[e.jsx("option",{value:"all",children:"Todos los estados"}),e.jsx("option",{value:"programada",children:"Programada"}),e.jsx("option",{value:"en_curso",children:"En Curso"}),e.jsx("option",{value:"completada",children:"Completada"}),e.jsx("option",{value:"cancelada",children:"Cancelada"}),e.jsx("option",{value:"pospuesta",children:"Pospuesta"})]})]}),M.length===0?e.jsxs("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-12 text-center",children:[e.jsx(et,{className:"w-12 h-12 text-slate-600 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-400",children:o||c!=="all"?"No se encontraron capacitaciones con los filtros aplicados":"No hay capacitaciones registradas. Crea la primera capacitaci√≥n."})]}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:M.map(l=>e.jsx("div",{className:"bg-gradient-to-br from-slate-800/40 to-slate-900/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6 hover:border-slate-600/50 transition-all",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg text-white font-semibold mb-1",children:l.titulo}),l.descripcion&&e.jsx("p",{className:"text-sm text-slate-400 line-clamp-2",children:l.descripcion})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border whitespace-nowrap ${j(l.estado)}`,children:_(l.estado)})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400",children:[e.jsx(Xt,{className:"w-4 h-4"}),e.jsx("span",{children:O(l.fecha_inicio)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-400",children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{children:l.categoria||"Sin categor√≠a"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-400",children:[e.jsx(qe,{className:"w-4 h-4"}),e.jsxs("span",{children:[l.asistencia_real||0,"/",l.cupo_maximo," asistentes"]})]}),e.jsxs("div",{className:"text-slate-400",children:[e.jsx("span",{className:"font-medium",children:"Instructor:"})," ",l.instructor_nombre||"No asignado"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"px-2 py-1 bg-slate-800/50 rounded text-xs text-slate-400",children:l.tipo||"Presencial"}),e.jsx("span",{className:"px-2 py-1 bg-slate-800/50 rounded text-xs text-slate-400",children:l.nivel||"B√°sico"}),e.jsxs("span",{className:"px-2 py-1 bg-slate-800/50 rounded text-xs text-slate-400",children:[l.duracion_horas,"h"]}),e.jsx("span",{className:"px-2 py-1 bg-slate-800/50 rounded text-xs text-slate-400",children:l.modalidad||"presencial"})]})]}),e.jsxs("div",{className:"flex lg:flex-col gap-2",children:[e.jsxs("button",{onClick:()=>d(l),className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg transition-colors text-sm",children:[e.jsx(Nt,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Editar"})]}),e.jsxs("button",{onClick:()=>D(l.id),className:"flex items-center gap-2 bg-red-600/80 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors text-sm",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Eliminar"})]})]})]})},l.id))}),e.jsx(se,{isOpen:!!w,onClose:()=>S(null),onConfirm:I,title:"Eliminar Capacitaci√≥n",message:"¬øEst√°s seguro de que deseas eliminar esta capacitaci√≥n? Esta acci√≥n no se puede deshacer.",confirmText:"Eliminar",variant:"danger"}),y&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 overflow-y-auto",children:e.jsxs("div",{className:"bg-gradient-to-br from-slate-800 to-slate-900 border border-slate-700/50 rounded-xl max-w-3xl w-full p-6 shadow-2xl my-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl text-white font-semibold",children:m?"Editar Capacitaci√≥n":"Nueva Capacitaci√≥n"}),e.jsx("button",{onClick:u,className:"text-slate-400 hover:text-white transition-colors",children:e.jsx(X,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:k,className:"space-y-4 max-h-[70vh] overflow-y-auto pr-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-slate-300 mb-2",children:["T√≠tulo ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:b.titulo,onChange:l=>f({...b,titulo:l.target.value}),required:!0,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50",placeholder:"Ej: Introducci√≥n a Productos Premium 2026"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Descripci√≥n"}),e.jsx("textarea",{value:b.descripcion,onChange:l=>f({...b,descripcion:l.target.value}),rows:3,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50 resize-none",placeholder:"Descripci√≥n de la capacitaci√≥n..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Objetivo"}),e.jsx("textarea",{value:b.objetivo,onChange:l=>f({...b,objetivo:l.target.value}),rows:2,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50 resize-none",placeholder:"Objetivo de aprendizaje..."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Categor√≠a"}),e.jsxs("select",{value:b.categoria,onChange:l=>f({...b,categoria:l.target.value}),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50",children:[e.jsx("option",{value:"Producto",children:"Producto"}),e.jsx("option",{value:"Ventas",children:"Ventas"}),e.jsx("option",{value:"Trade Marketing",children:"Trade Marketing"}),e.jsx("option",{value:"T√©cnica",children:"T√©cnica"}),e.jsx("option",{value:"Seguridad",children:"Seguridad"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Tipo"}),e.jsxs("select",{value:b.tipo,onChange:l=>f({...b,tipo:l.target.value}),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50",children:[e.jsx("option",{value:"Presencial",children:"Presencial"}),e.jsx("option",{value:"Virtual",children:"Virtual"}),e.jsx("option",{value:"H√≠brida",children:"H√≠brida"}),e.jsx("option",{value:"E-learning",children:"E-learning"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Nivel"}),e.jsxs("select",{value:b.nivel,onChange:l=>f({...b,nivel:l.target.value}),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50",children:[e.jsx("option",{value:"B√°sico",children:"B√°sico"}),e.jsx("option",{value:"Intermedio",children:"Intermedio"}),e.jsx("option",{value:"Avanzado",children:"Avanzado"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-slate-300 mb-2",children:["Fecha Inicio ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"datetime-local",value:b.fecha_inicio,onChange:l=>f({...b,fecha_inicio:l.target.value}),required:!0,className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Fecha Fin"}),e.jsx("input",{type:"datetime-local",value:b.fecha_fin,onChange:l=>f({...b,fecha_fin:l.target.value}),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Duraci√≥n (horas)"}),e.jsx("input",{type:"number",step:"0.5",min:"0",value:b.duracion_horas,onChange:l=>f({...b,duracion_horas:parseFloat(l.target.value)}),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Modalidad"}),e.jsxs("select",{value:b.modalidad,onChange:l=>f({...b,modalidad:l.target.value}),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50",children:[e.jsx("option",{value:"presencial",children:"Presencial"}),e.jsx("option",{value:"virtual",children:"Virtual"}),e.jsx("option",{value:"hibrida",children:"H√≠brida"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Ubicaci√≥n"}),e.jsx("input",{type:"text",value:b.ubicacion,onChange:l=>f({...b,ubicacion:l.target.value}),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50",placeholder:"Ej: Oficina Central - Sala A"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Instructor"}),e.jsx("input",{type:"text",value:b.instructor_nombre,onChange:l=>f({...b,instructor_nombre:l.target.value}),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50",placeholder:"Nombre del instructor"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Cupo M√°ximo"}),e.jsx("input",{type:"number",min:"1",value:b.cupo_maximo,onChange:l=>f({...b,cupo_maximo:parseInt(l.target.value)}),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Asistencia Esperada"}),e.jsx("input",{type:"number",min:"0",value:b.asistencia_esperada,onChange:l=>f({...b,asistencia_esperada:parseInt(l.target.value)}),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-300 mb-2",children:"Estado"}),e.jsxs("select",{value:b.estado,onChange:l=>f({...b,estado:l.target.value}),className:"w-full bg-slate-900/50 border border-slate-700 text-white px-4 py-2.5 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50",children:[e.jsx("option",{value:"programada",children:"Programada"}),e.jsx("option",{value:"en_curso",children:"En Curso"}),e.jsx("option",{value:"completada",children:"Completada"}),e.jsx("option",{value:"cancelada",children:"Cancelada"}),e.jsx("option",{value:"pospuesta",children:"Pospuesta"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:u,className:"flex-1 bg-slate-700 hover:bg-slate-600 text-white px-6 py-3 rounded-lg transition-colors",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"flex-1 bg-purple-600 hover:bg-purple-500 text-white px-6 py-3 rounded-lg transition-colors flex items-center justify-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5"}),m?"Guardar Cambios":"Crear Capacitaci√≥n"]})]})]})]})})]})}function Pa({session:t}){const[r,s]=g.useState([]),[a,n]=g.useState(!0),[o,i]=g.useState(!1),[c,h]=g.useState({}),[y,v]=g.useState(!1),[m,p]=g.useState(null);g.useEffect(()=>{w()},[]);const w=async()=>{n(!0);try{const{data:d,error:u}=await T.from("btl_regiones").select("*").order("nombre",{ascending:!0});if(u)throw u;s(d||[])}catch(d){console.error("Error loading regions:",d),d.code==="PGRST205"||d.code==="42P01"?E.error("La tabla de regiones no est√° configurada. Ejecuta el script de migraci√≥n."):E.error("Error al cargar regiones")}finally{n(!1)}},S=async()=>{if(!c.nombre){E.error("El nombre de la regi√≥n es obligatorio");return}try{if(c.id){const{error:d}=await T.from("btl_regiones").update({nombre:c.nombre,descripcion:c.descripcion}).eq("id",c.id);if(d)throw d;E.success("Regi√≥n actualizada exitosamente")}else{const{error:d}=await T.from("btl_regiones").insert([{nombre:c.nombre,descripcion:c.descripcion}]);if(d)throw d;E.success("Regi√≥n creada exitosamente")}v(!1),h({}),w()}catch(d){console.error("Error saving region:",d),E.error("Error al guardar la regi√≥n")}},b=d=>{p(d)},f=async()=>{if(!m)return;const d=m;try{const{error:u}=await T.from("btl_regiones").delete().eq("id",d);if(u)throw u;E.success("Regi√≥n eliminada"),w()}catch(u){console.error("Error deleting region:",u),E.error("Error al eliminar la regi√≥n")}finally{p(null)}},N=d=>{d?(h(d),i(!0)):(h({}),i(!1)),v(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl text-white font-bold flex items-center gap-2",children:[e.jsx(ue,{className:"w-6 h-6 text-amber-500"}),"Gesti√≥n de Regiones"]}),e.jsx("p",{className:"text-slate-400 mt-1",children:"Administra las zonas geogr√°ficas y territorios de venta."})]}),e.jsxs("button",{onClick:()=>N(),className:"flex items-center gap-2 bg-purple-600 hover:bg-purple-500 text-white px-4 py-2 rounded-lg transition-colors",children:[e.jsx(oe,{className:"w-4 h-4"}),"Nueva Regi√≥n"]})]}),a?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(V,{className:"w-8 h-8 text-amber-500 animate-spin"})}):r.length===0?e.jsxs("div",{className:"text-center py-12 bg-slate-800/30 rounded-xl border border-slate-700/50",children:[e.jsx(ue,{className:"w-12 h-12 text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"No hay regiones configuradas"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(d=>e.jsxs("div",{className:"bg-slate-800/40 backdrop-blur-sm border border-slate-700/50 rounded-xl p-6 hover:border-amber-500/30 transition-all group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-500/10 flex items-center justify-center text-amber-500",children:e.jsx(ue,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>N(d),className:"p-2 hover:bg-slate-700 rounded-lg text-slate-400 hover:text-white transition-colors",title:"Editar",children:e.jsx(He,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>b(d.id),className:"p-2 hover:bg-red-500/10 rounded-lg text-slate-400 hover:text-red-400 transition-colors",title:"Eliminar",children:e.jsx(te,{className:"w-4 h-4"})})]})]}),e.jsx("h3",{className:"text-lg text-white font-semibold mb-2",children:d.nombre}),e.jsx("p",{className:"text-slate-400 text-sm h-10 overflow-hidden text-ellipsis",children:d.descripcion||"Sin descripci√≥n"})]},d.id))}),e.jsx(se,{isOpen:!!m,onClose:()=>p(null),onConfirm:f,title:"Eliminar Regi√≥n",message:"¬øEst√°s seguro de eliminar esta regi√≥n? Esto podr√≠a afectar a los venues asignados.",confirmText:"Eliminar",variant:"danger"}),y&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-md shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-800",children:[e.jsx("h3",{className:"text-xl text-white font-bold",children:o?"Editar Regi√≥n":"Nueva Regi√≥n"}),e.jsx("button",{onClick:()=>v(!1),className:"text-slate-400 hover:text-white transition-colors",children:e.jsx(X,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:["Nombre de la Regi√≥n ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:c.nombre||"",onChange:d=>h({...c,nombre:d.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-amber-500 transition-colors",placeholder:"Ej: Zona Norte"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Descripci√≥n"}),e.jsx("textarea",{value:c.descripcion||"",onChange:d=>h({...c,descripcion:d.target.value}),className:"w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-amber-500 transition-colors h-24 resize-none",placeholder:"Descripci√≥n opcional del territorio..."})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-slate-800 bg-slate-900/50",children:[e.jsx("button",{onClick:()=>v(!1),className:"px-4 py-2 text-slate-400 hover:text-white transition-colors font-medium",children:"Cancelar"}),e.jsxs("button",{onClick:S,className:"flex items-center gap-2 bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-500 hover:to-amber-400 text-white px-6 py-2 rounded-lg font-medium shadow-lg shadow-amber-500/20 transition-all hover:scale-105",children:[e.jsx(St,{className:"w-4 h-4"}),"Guardar"]})]})]})})]})}function Fa({session:t,onViewChange:r,initialTicketId:s}){const[a,n]=g.useState(s?"tickets":"stats"),[o,i]=g.useState("catalog"),[c,h]=g.useState(null),[y,v]=g.useState(!0),[m,p]=g.useState(null),[w,S]=g.useState(0);g.useEffect(()=>{b(),f()},[]);const b=async()=>{v(!0),p(null);try{if(console.log("üìä Loading admin stats..."),console.log("üîë User ID:",t?.user?.id),console.log("üîë User role:",t?.user?.user_metadata?.role),t?.user?.user_metadata?.role!=="admin"){p("No tienes permisos de administrador");return}console.log("üìä Loading real stats from Supabase...");const{data:N,error:d}=await T.from("btl_usuarios").select("id, rol");d&&console.error("‚ùå Error loading users:",d);const{data:u,error:k}=await T.from("btl_puntos_venta").select("id");k&&console.error("‚ùå Error loading venues:",k);const{data:D,error:I}=await T.from("btl_inspecciones").select("id");I&&console.error("‚ùå Error loading inspections:",I);const{data:M,error:j}=await T.from("btl_reportes").select("id, estado");j&&console.error("‚ùå Error loading tickets:",j);const _=N?.length||0,O=u?.length||0,l=D?.length||0,P=M?.length||0,R={inspector:N?.filter(x=>x.rol==="inspector").length||0,client:N?.filter(x=>x.rol==="client").length||0,admin:N?.filter(x=>x.rol==="admin").length||0},U={open:M?.filter(x=>x.estado==="abierto").length||0,"in-progress":M?.filter(x=>x.estado==="en_progreso").length||0,resolved:M?.filter(x=>x.estado==="resuelto").length||0},C=U.open;h({totalUsers:_,totalInspections:l,totalTickets:P,totalVenues:O,openTickets:C,usersByRole:R,ticketsByStatus:U}),console.log("‚úÖ Stats loaded:",{totalUsers:_,totalVenues:O,totalInspections:l,totalTickets:P,usersByRole:R,ticketsByStatus:U})}catch(N){console.error("‚ùå Error loading stats:",N),h({totalUsers:0,totalInspections:0,totalTickets:0,totalVenues:0,openTickets:0,usersByRole:{inspector:0,client:0,admin:0},ticketsByStatus:{open:0,"in-progress":0,resolved:0}})}finally{v(!1)}},f=async()=>{try{const{data:N,error:d}=await T.from("btl_usuarios").select("id").eq("estado_aprobacion","pending");d?(console.error("‚ùå Error loading pending users count:",d),S(0)):S(N?.length||0)}catch(N){console.error("‚ùå Error loading pending users count:",N),S(0)}};return e.jsxs("main",{className:"max-w-[1600px] mx-auto px-4 sm:px-8 py-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center gap-4 mb-8",children:[e.jsx("div",{className:"flex-1 w-full overflow-x-auto pb-2 lg:pb-0 custom-scrollbar",children:e.jsxs("div",{className:"flex gap-2 min-w-max",children:[e.jsxs("button",{onClick:()=>n("stats"),className:`flex items-center gap-2 px-5 py-3 rounded-lg font-medium transition-all ${a==="stats"?"bg-purple-600 text-white shadow-lg shadow-purple-500/20":"bg-slate-800/50 text-slate-400 hover:bg-slate-800"}`,children:[e.jsx(Jt,{className:"w-5 h-5"}),e.jsx("span",{children:"Estad√≠sticas"})]}),e.jsxs("button",{onClick:()=>n("users"),className:`flex items-center gap-2 px-5 py-3 rounded-lg font-medium transition-all ${a==="users"?"bg-purple-600 text-white shadow-lg shadow-purple-500/20":"bg-slate-800/50 text-slate-400 hover:bg-slate-800"}`,children:[e.jsx(qe,{className:"w-5 h-5"}),e.jsx("span",{children:"Usuarios"}),c&&e.jsx("span",{className:"ml-1 px-2 py-0.5 rounded-full bg-white/20 text-xs",children:c.totalUsers})]}),e.jsxs("button",{onClick:()=>n("tickets"),className:`flex items-center gap-2 px-5 py-3 rounded-lg font-medium transition-all ${a==="tickets"?"bg-purple-600 text-white shadow-lg shadow-purple-500/20":"bg-slate-800/50 text-slate-400 hover:bg-slate-800"}`,children:[e.jsx(rr,{className:"w-5 h-5"}),e.jsx("span",{children:"Tickets"}),c&&e.jsx("span",{className:"ml-1 px-2 py-0.5 rounded-full bg-white/20 text-xs",children:c.openTickets})]}),e.jsxs("button",{onClick:()=>n("venues"),className:`flex items-center gap-2 px-5 py-3 rounded-lg font-medium transition-all ${a==="venues"?"bg-purple-600 text-white shadow-lg shadow-purple-500/20":"bg-slate-800/50 text-slate-400 hover:bg-slate-800"}`,children:[e.jsx(xe,{className:"w-5 h-5"}),e.jsx("span",{children:"Lugares"}),c&&e.jsx("span",{className:"ml-1 px-2 py-0.5 rounded-full bg-white/20 text-xs",children:c.totalVenues})]}),e.jsxs("button",{onClick:()=>n("regions"),className:`flex items-center gap-2 px-5 py-3 rounded-lg font-medium transition-all ${a==="regions"?"bg-purple-600 text-white shadow-lg shadow-purple-500/20":"bg-slate-800/50 text-slate-400 hover:bg-slate-800"}`,children:[e.jsx(ue,{className:"w-5 h-5"}),e.jsx("span",{children:"Regiones"})]}),e.jsxs("button",{onClick:()=>n("products"),className:`flex items-center gap-2 px-5 py-3 rounded-lg font-medium transition-all ${a==="products"?"bg-purple-600 text-white shadow-lg shadow-purple-500/20":"bg-slate-800/50 text-slate-400 hover:bg-slate-800"}`,children:[e.jsx(Me,{className:"w-5 h-5"}),e.jsx("span",{children:"Productos"})]}),e.jsxs("button",{onClick:()=>n("pending"),className:`flex items-center gap-2 px-5 py-3 rounded-lg font-medium transition-all ${a==="pending"?"bg-purple-600 text-white shadow-lg shadow-purple-500/20":"bg-slate-800/50 text-slate-400 hover:bg-slate-800"}`,children:[e.jsx(Ct,{className:"w-5 h-5"}),e.jsx("span",{children:"Usuarios Pendientes"}),w>0&&e.jsx("span",{className:"ml-1 px-2 py-0.5 rounded-full bg-white/20 text-xs",children:w})]}),e.jsxs("button",{onClick:()=>n("trainings"),className:`flex items-center gap-2 px-5 py-3 rounded-lg font-medium transition-all ${a==="trainings"?"bg-purple-600 text-white shadow-lg shadow-purple-500/20":"bg-slate-800/50 text-slate-400 hover:bg-slate-800"}`,children:[e.jsx(Gt,{className:"w-5 h-5"}),e.jsx("span",{children:"Capacitaciones"})]})]})}),e.jsxs("button",{onClick:b,className:"flex-shrink-0 flex items-center gap-2 px-4 py-3 rounded-lg bg-slate-800/50 hover:bg-slate-800 text-slate-400 hover:text-white transition-colors ml-auto lg:ml-0",children:[e.jsx(Qt,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Actualizar"})]})]}),y?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(V,{className:"w-12 h-12 text-purple-500 animate-spin"})}):m?e.jsxs("div",{className:"rounded-xl bg-red-500/10 border border-red-500/30 p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl bg-red-500/20 flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-4xl",children:"‚ö†Ô∏è"})}),e.jsx("h3",{className:"text-xl text-white font-bold mb-2",children:"Error de Autenticaci√≥n"}),e.jsx("p",{className:"text-slate-300 mb-6",children:m}),e.jsx("button",{onClick:()=>window.location.reload(),className:"bg-purple-600 hover:bg-purple-500 text-white px-6 py-3 rounded-lg transition-colors",children:"Reintentar"})]}):e.jsxs(e.Fragment,{children:[a==="stats"&&e.jsx(dr,{stats:c,session:t}),a==="users"&&e.jsx(nr,{session:t,onUpdate:b}),a==="tickets"&&e.jsx(cr,{session:t,onUpdate:b,initialTicketId:s}),a==="venues"&&e.jsx(Na,{session:t}),a==="regions"&&e.jsx(Pa,{session:t}),a==="products"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex p-1 bg-slate-800/50 rounded-lg w-fit border border-slate-700/50",children:[e.jsx("button",{onClick:()=>i("catalog"),className:`px-4 py-2 rounded-md text-sm font-medium transition-all ${o==="catalog"?"bg-amber-600 text-white shadow-lg":"text-slate-400 hover:text-white hover:bg-slate-700/50"}`,children:"Cat√°logo y Objetivos"}),e.jsx("button",{onClick:()=>i("assignment"),className:`px-4 py-2 rounded-md text-sm font-medium transition-all ${o==="assignment"?"bg-amber-600 text-white shadow-lg":"text-slate-400 hover:text-white hover:bg-slate-700/50"}`,children:"Asignaci√≥n por Cliente"})]}),o==="catalog"?e.jsx(Ca,{}):e.jsx(Sa,{session:t})]}),a==="pending"&&e.jsx(_a,{session:t,onUpdate:()=>{b(),f()}}),a==="trainings"&&e.jsx(Ea,{session:t})]})]})}export{Fa as AdminDashboard};
